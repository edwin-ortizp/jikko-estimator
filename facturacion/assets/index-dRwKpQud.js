import{r as x,j as e,d as As,R as Rs}from"./react-vendor-DPK0UGtp.js";import{t as Is,e as Ts,g as Pt,L as de,i as ut,j as xt,k as Lt,m as Ps,n as Ls}from"./vendor-jsVd20pH.js";import{L as Ms,C as Os,B as he,a as H,T as Ne,H as wt,b as Ge,c as q,S as ht,F as Pe,X as se,d as Mt,E as Ve,e as ne,f as me,g as He,h as we,R as $e,P as ge,i as $s,j as ke,k as Fs,D as Oe,l as Ye,m as Ot,n as rt,o as te,p as nt,q as Vs,U as ze,Z as qe,M as zs,r as Bs,s as lt,t as gt,u as it,v as oe,A as Ys,w as $t,I as Ft,x as Ct,y as Vt,z as Us,G as Ws,J as qs,K as Gs,N as Hs,O as je,Q as zt,V as Js,W as Qs,Y as Xs,_ as Zs,$ as pt,a0 as ft,a1 as Ks,a2 as ea,a3 as ta,a4 as sa}from"./icons-D1TlQ8x7.js";import{T as Bt,I as aa,S as Yt,a as Ut,P as ra,C as Wt,V as na,L as qt,b as Gt,c as la,d as ia,e as Ht,R as oa,f as ca,g as Jt,h as da,i as ma,j as ua}from"./radix-CW1r7YKp.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function s(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=s(n);fetch(n.href,a)}})();function W(...l){return Is(Ts(l))}const xa=[{name:"Dashboard",href:"/",icon:Ms,description:"Vista matriz de facturaci√≥n"},{name:"Pendientes",href:"/pendientes",icon:Os,description:"Solicitudes pendientes"},{name:"Reportes",href:"/reportes",icon:he,description:"An√°lisis y reportes"},{name:"Empresas",href:"/empresas",icon:H,description:"Directorio de empresas de energ√≠a"},{name:"An√°lisis",href:"/analisis-demanda",icon:Ne,description:"An√°lisis de demanda temporal"}],ha=[{name:"Alcald√≠a de Palmira",slug:"alcaldia-palmira"},{name:"Alcald√≠a de Tulu√°",slug:"alcaldia-tulua"},{name:"Gobernaci√≥n del Valle",slug:"gobernacion-valle"},{name:"Infibagu√©",slug:"infibague"}];function pe({children:l}){const t=Pt(),[s,r]=x.useState(!1),[n,a]=x.useState(null),i=x.useRef(null);return x.useEffect(()=>{const o=c=>{i.current&&!i.current.contains(c.target)&&r(!1)};return document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[]),x.useEffect(()=>{let o=!0;return fetch("/jikko-estimator/facturacion/build-info.json",{cache:"no-store"}).then(m=>m.ok?m.json():null).then(m=>{o&&a(m?.updatedAt??null)}).catch(()=>{o&&a(null)}),()=>{o=!1}},[]),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-gradient-to-r from-blue-600 to-blue-700 shadow-lg border-b border-blue-800",children:e.jsx("div",{className:"px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h1",{className:"text-xl font-bold text-white",children:"Control de Facturaci√≥n - Jikkosoft"}),e.jsxs("span",{className:"ml-3 text-blue-200 text-xs",children:["√öltima actualizaci√≥n: ",n??"‚Äî"]}),e.jsx("span",{className:"ml-3 text-blue-200 text-sm hidden md:inline",children:"Gesti√≥n de solicitudes por empresa y mes"})]}),e.jsxs("nav",{className:"flex space-x-2",children:[xa.map(o=>{const c=t.pathname===o.href,m=o.icon;return e.jsxs(de,{to:o.href,className:W("flex items-center px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200",c?"bg-white/20 text-white border border-white/30 shadow-sm":"text-blue-100 hover:text-white hover:bg-white/10 border border-transparent"),title:o.description,children:[e.jsx(m,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:o.name}),e.jsx("span",{className:"sm:hidden",children:o.name.charAt(0)})]},o.name)}),e.jsxs("div",{className:"relative",ref:i,children:[e.jsxs("button",{onClick:()=>r(!s),className:W("flex items-center px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200",s||t.pathname.includes("/entidad/")?"bg-white/20 text-white border border-white/30 shadow-sm":"text-blue-100 hover:text-white hover:bg-white/10 border border-transparent"),title:"Vistas hist√≥ricas por entidad",children:[e.jsx(wt,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Hist√≥rico"}),e.jsx("span",{className:"sm:hidden",children:"H"}),e.jsx(Ge,{className:"h-3 w-3 ml-1"})]}),s&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50",children:[e.jsx("div",{className:"px-4 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-100",children:"Vistas Hist√≥ricas"}),ha.map(o=>{const c=t.pathname===`/entidad/${o.slug}/historico`;return e.jsx(de,{to:`/entidad/${o.slug}/historico`,className:W("block px-4 py-3 text-sm transition-colors",c?"bg-blue-50 text-blue-700 font-medium":"text-gray-700 hover:bg-gray-50"),onClick:()=>r(!1),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(wt,{className:"h-4 w-4 mr-3 text-gray-400"}),o.name]})},o.slug)})]})]})]})]})})}),e.jsx("main",{className:"w-full px-2 sm:px-4 lg:px-6",children:l})]})}function ga(){return x.useEffect(()=>{const l="/jikko-estimator/facturacion",t=window.location.pathname,s=window.location.hash,r=window.location.search;if(t===l||t===l+"/")return void 0;if(!s&&t.startsWith(l)){let n=t.substring(l.length);n.startsWith("/")||(n="/"+n);const a=l+"/#"+n+r;console.log("LegacyUrlRedirect: Redirigiendo de",t,"a",a),window.location.replace(a)}},[]),null}const pa="modulepreload",fa=function(l){return"/jikko-estimator/facturacion/"+l},Dt={},N=function(t,s,r){let n=Promise.resolve();if(s&&s.length>0){let c=function(m){return Promise.all(m.map(u=>Promise.resolve(u).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),o=i?.nonce||i?.getAttribute("nonce");n=c(s.map(m=>{if(m=fa(m),m in Dt)return;Dt[m]=!0;const u=m.endsWith(".css"),g=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${g}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":pa,u||(d.as="script"),d.crossOrigin="",d.href=m,o&&d.setAttribute("nonce",o),document.head.appendChild(d),u)return new Promise((h,y)=>{d.addEventListener("load",h),d.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${m}`)))})}))}function a(i){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i}return n.then(i=>{for(const o of i||[])o.status==="rejected"&&a(o.reason);return t().catch(a)})},Be=(l,t,s)=>{const r=l[t];return r?typeof r=="function"?r():Promise.resolve(r):new Promise((n,a)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+t+(t.split("/").length!==s?". Note that variables only represent file names one level deep.":""))))})};class B{static apiBaseUrl="http://localhost:3001/api";static async loadDataForEntityYear(t,s){try{const r=await this.loadDataFromJsonFiles(t,s.toString());if(r)return r}catch(r){console.warn(`JSON loading failed for ${t} ${s}:`,r);try{const n=await fetch(`${this.apiBaseUrl}/billing/${encodeURIComponent(t)}/${s}`);if(!n.ok)throw new Error(`La API no pudo cargar los datos: ${n.status}`);return await n.json()}catch{throw r}}throw new Error(`No se pudo cargar los datos para ${t} ${s}`)}static async loadDataFromJsonFiles(t,s){try{const n={"Alcald√≠a de Palmira":"alcaldia-palmira","Alcald√≠a de Tulu√°":"alcaldia-tulua","Gobernaci√≥n del Valle del Cauca":"gobernacion-valle",Infibagu√©:"infibague"}[t];if(!n)throw new Error(`Entidad "${t}" no est√° configurada en el sistema`);try{const i=(await Be(Object.assign({"../data/alcaldia-palmira/2017.json":()=>N(()=>import("./2017-BVOP-Wl2.js"),[]),"../data/alcaldia-palmira/2018.json":()=>N(()=>import("./2018-DZ1DG_5X.js"),[]),"../data/alcaldia-palmira/2019.json":()=>N(()=>import("./2019-CsKsMAR0.js"),[]),"../data/alcaldia-palmira/2020.json":()=>N(()=>import("./2020-BRZ26RQl.js"),[]),"../data/alcaldia-palmira/2021.json":()=>N(()=>import("./2021-DVztz28N.js"),[]),"../data/alcaldia-palmira/2022.json":()=>N(()=>import("./2022-C7X1vzRC.js"),[]),"../data/alcaldia-palmira/2023.json":()=>N(()=>import("./2023-3iXhSLrf.js"),[]),"../data/alcaldia-palmira/2024.json":()=>N(()=>import("./2024-C1DwArZ3.js"),[]),"../data/alcaldia-palmira/2025.json":()=>N(()=>import("./2025-ChyOB8kX.js"),[]),"../data/alcaldia-tulua/2017.json":()=>N(()=>import("./2017-BECROcFg.js"),[]),"../data/alcaldia-tulua/2018.json":()=>N(()=>import("./2018-0eCO8QOx.js"),[]),"../data/alcaldia-tulua/2019.json":()=>N(()=>import("./2019-C49KecLc.js"),[]),"../data/alcaldia-tulua/2020.json":()=>N(()=>import("./2020-DMf6FYnd.js"),[]),"../data/alcaldia-tulua/2021.json":()=>N(()=>import("./2021-DvqTzZPh.js"),[]),"../data/alcaldia-tulua/2022.json":()=>N(()=>import("./2022-CIvs88wj.js"),[]),"../data/alcaldia-tulua/2023.json":()=>N(()=>import("./2023-BeRqBxTJ.js"),[]),"../data/alcaldia-tulua/2024.json":()=>N(()=>import("./2024-V3Ks7LuK.js"),[]),"../data/alcaldia-tulua/2025.json":()=>N(()=>import("./2025-BlBWJeCc.js"),[]),"../data/gobernacion-valle/2017.json":()=>N(()=>import("./2017-RHIzOR10.js"),[]),"../data/gobernacion-valle/2018.json":()=>N(()=>import("./2018-DAcL6WxD.js"),[]),"../data/gobernacion-valle/2019.json":()=>N(()=>import("./2019-KKyEHg-1.js"),[]),"../data/gobernacion-valle/2020.json":()=>N(()=>import("./2020-DLSyYBua.js"),[]),"../data/gobernacion-valle/2021.json":()=>N(()=>import("./2021-CTNt0CSD.js"),[]),"../data/gobernacion-valle/2022.json":()=>N(()=>import("./2022-CO3HVyE6.js"),[]),"../data/gobernacion-valle/2023.json":()=>N(()=>import("./2023-DpQun6Of.js"),[]),"../data/gobernacion-valle/2024.json":()=>N(()=>import("./2024-C85h5RGw.js"),[]),"../data/gobernacion-valle/2025.json":()=>N(()=>import("./2025-HUFIYlkh.js"),[]),"../data/infibague/2021.json":()=>N(()=>import("./2021-B9Xfz2lF.js"),[]),"../data/infibague/2022.json":()=>N(()=>import("./2022-D-GZ4eF1.js"),[]),"../data/infibague/2023.json":()=>N(()=>import("./2023-DyQgsWQS.js"),[]),"../data/infibague/2024.json":()=>N(()=>import("./2024-DLtBQgoW.js"),[]),"../data/infibague/2025.json":()=>N(()=>import("./2025-Ad051HOY.js"),[])}),`../data/${n}/${s}.json`,4)).default;return this.normalizeDataStructure(i)}catch(a){throw a.message?.includes("Unknown variable dynamic import")?new Error(`No existe el archivo JSON para ${t} del a√±o ${s}`):a}}catch(r){throw console.error("Error loading data from JSON files:",r),r}}static async saveDataForEntityYear(t,s,r){try{const n=this.normalizeDataStructure(r),a=await fetch(`${this.apiBaseUrl}/billing/${encodeURIComponent(t)}/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!a.ok)throw new Error(`API request failed: ${a.status} ${a.statusText}`);const i=await a.json();console.log(`Data saved for ${t} ${s}:`,i.message)}catch(n){throw console.error(`Error saving data for ${t} ${s}:`,n),n}}static async getAvailableEntities(){try{const t=await fetch(`${this.apiBaseUrl}/entities`);if(!t.ok)throw new Error(`API request failed: ${t.status}`);return await t.json()}catch(t){return console.error("Error getting entities:",t),["Alcald√≠a de Palmira","Alcald√≠a de Tulu√°","Gobernaci√≥n del Valle del Cauca","Infibagu√©"]}}static async getAvailableYears(){try{const t=await fetch(`${this.apiBaseUrl}/years`);if(!t.ok)throw new Error(`API request failed: ${t.status}`);return await t.json()}catch(t){return console.error("Error getting years:",t),[2017,2018,2019,2020,2021,2022,2023,2024,2025]}}static normalizeDataStructure(t){const s={};for(const[r,n]of Object.entries(t))if(typeof n=="object"&&n!==null){const a={};for(const[i,o]of Object.entries(n))i==="_metadata"?a._metadata=o:typeof o=="object"&&o!==null&&(a[i]=o);a._metadata||(a._metadata={usuariosCount:null,esIncumbente:!1,tipoEmpresa:null,email:null,nit:null,esAutoconsumidora:!1,esOperadorRed:!1,recauda:!1}),s[r]=a}return s}static getCompanyMetadata(t){return t._metadata||{usuariosCount:null,esIncumbente:!1,tipoEmpresa:null,email:null,nit:null,esAutoconsumidora:!1,esOperadorRed:!1,recauda:!1}}static updateCompanyMetadata(t,s){return{...t,_metadata:s}}static getMonthlyBillingData(t,s){const r=t[s];return r&&typeof r=="object"?r:null}static validateCompanyData(t){try{return!(!t._metadata||typeof t._metadata.esIncumbente!="boolean")}catch(s){return console.error("Error validating company data:",s),!1}}static createDataBackup(t){return JSON.parse(JSON.stringify(t))}static validateCompanyRename(t,s,r){return t[s]?t[r]&&s!==r?{isValid:!1,error:`Ya existe una empresa con el nombre "${r}"`}:r.trim()?{isValid:!0}:{isValid:!1,error:"El nombre de la empresa no puede estar vac√≠o"}:{isValid:!1,error:`La empresa "${s}" no existe`}}static loadDataFromLocalStorage(t,s){try{const r=`billing_${t}_${s}`,n=localStorage.getItem(r);return n?this.normalizeDataStructure(JSON.parse(n)):null}catch(r){return console.error(`Error loading from localStorage for ${t} ${s}:`,r),null}}}class K{static MONTH_NAMES=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"];static formatHumanDate(t){if(!t)return"Sin fecha";const s=t.split("-");if(s.length===3&&s[0].length===4){const o=parseInt(s[0]),c=parseInt(s[1])-1,m=parseInt(s[2]);if(!isNaN(o)&&!isNaN(c)&&!isNaN(m)&&c>=0&&c<=11&&m>=1&&m<=31){const u=new Date(o,c,m),g=u.getDate(),d=this.MONTH_NAMES[u.getMonth()],h=u.getFullYear();return`${d} ${g} de ${h}`}}const r=new Date(t),n=r.getDate(),a=this.MONTH_NAMES[r.getMonth()],i=r.getFullYear();return`${a} ${n} de ${i}`}static calculateElapsedDays(t){if(!t)return null;const s=t.split("-");if(s.length===3&&s[0].length===4){const i=parseInt(s[0]),o=parseInt(s[1])-1,c=parseInt(s[2]);if(!isNaN(i)&&!isNaN(o)&&!isNaN(c)&&o>=0&&o<=11&&c>=1&&c<=31){const m=new Date(i,o,c),g=new Date().getTime()-m.getTime();return Math.floor(g/(1e3*3600*24))}}const r=new Date(t),a=new Date().getTime()-r.getTime();return Math.floor(a/(1e3*3600*24))}static shouldShowElapsedDays(t){return t!=="Sin Solicitud"&&t!=="Closed"&&t!=="Removed"}static getElapsedDaysColor(t){return t>30?"text-red-600":t>15?"text-orange-600":"text-gray-600"}static calculateClosedDays(t,s,r){if(r!=null&&r>=0)return r;if(!t||!s)return null;const n=c=>{const m=c.split("-");if(m.length===3&&m[0].length===4){const u=parseInt(m[0]),g=parseInt(m[1])-1,d=parseInt(m[2]);if(!isNaN(u)&&!isNaN(g)&&!isNaN(d)&&g>=0&&g<=11&&d>=1&&d<=31)return new Date(u,g,d)}return null},a=n(t),i=n(s);if(!a||!i)try{const c=new Date(t),u=new Date(s).getTime()-c.getTime();return Math.floor(u/(1e3*3600*24))}catch{return null}const o=i.getTime()-a.getTime();return Math.floor(o/(1e3*3600*24))}static shouldShowClosedDays(t){return t==="Closed"}static getClosedDaysColor(){return"text-gray-600"}static calculateProcessingDaysForStorage(t,s){if(!t||!s)return null;const r=c=>{const m=c.split("-");if(m.length===3&&m[0].length===4){const u=parseInt(m[0]),g=parseInt(m[1])-1,d=parseInt(m[2]);if(!isNaN(u)&&!isNaN(g)&&!isNaN(d)&&g>=0&&g<=11&&d>=1&&d<=31)return new Date(u,g,d)}return null},n=r(t),a=r(s);if(!n||!a)try{const c=new Date(t),u=new Date(s).getTime()-c.getTime(),g=Math.floor(u/(1e3*3600*24));return g>=0?g:null}catch{return null}const i=a.getTime()-n.getTime(),o=Math.floor(i/(1e3*3600*24));return o>=0?o:null}static shouldCalculateAndStoreDays(t,s,r){return t==="Closed"&&!!s&&!!r}}const U=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];async function ba(l,t){const r={"Alcald√≠a de Palmira":"alcaldia-palmira","Alcald√≠a de Tulu√°":"alcaldia-tulua","Gobernaci√≥n del Valle del Cauca":"gobernacion-valle",Infibagu√©:"infibague"}[l];if(!r)throw new Error(`Entity ${l} not found`);try{const a=(await Be(Object.assign({"../data/alcaldia-palmira/2017.json":()=>N(()=>import("./2017-BVOP-Wl2.js"),[]),"../data/alcaldia-palmira/2018.json":()=>N(()=>import("./2018-DZ1DG_5X.js"),[]),"../data/alcaldia-palmira/2019.json":()=>N(()=>import("./2019-CsKsMAR0.js"),[]),"../data/alcaldia-palmira/2020.json":()=>N(()=>import("./2020-BRZ26RQl.js"),[]),"../data/alcaldia-palmira/2021.json":()=>N(()=>import("./2021-DVztz28N.js"),[]),"../data/alcaldia-palmira/2022.json":()=>N(()=>import("./2022-C7X1vzRC.js"),[]),"../data/alcaldia-palmira/2023.json":()=>N(()=>import("./2023-3iXhSLrf.js"),[]),"../data/alcaldia-palmira/2024.json":()=>N(()=>import("./2024-C1DwArZ3.js"),[]),"../data/alcaldia-palmira/2025.json":()=>N(()=>import("./2025-ChyOB8kX.js"),[]),"../data/alcaldia-tulua/2017.json":()=>N(()=>import("./2017-BECROcFg.js"),[]),"../data/alcaldia-tulua/2018.json":()=>N(()=>import("./2018-0eCO8QOx.js"),[]),"../data/alcaldia-tulua/2019.json":()=>N(()=>import("./2019-C49KecLc.js"),[]),"../data/alcaldia-tulua/2020.json":()=>N(()=>import("./2020-DMf6FYnd.js"),[]),"../data/alcaldia-tulua/2021.json":()=>N(()=>import("./2021-DvqTzZPh.js"),[]),"../data/alcaldia-tulua/2022.json":()=>N(()=>import("./2022-CIvs88wj.js"),[]),"../data/alcaldia-tulua/2023.json":()=>N(()=>import("./2023-BeRqBxTJ.js"),[]),"../data/alcaldia-tulua/2024.json":()=>N(()=>import("./2024-V3Ks7LuK.js"),[]),"../data/alcaldia-tulua/2025.json":()=>N(()=>import("./2025-BlBWJeCc.js"),[]),"../data/gobernacion-valle/2017.json":()=>N(()=>import("./2017-RHIzOR10.js"),[]),"../data/gobernacion-valle/2018.json":()=>N(()=>import("./2018-DAcL6WxD.js"),[]),"../data/gobernacion-valle/2019.json":()=>N(()=>import("./2019-KKyEHg-1.js"),[]),"../data/gobernacion-valle/2020.json":()=>N(()=>import("./2020-DLSyYBua.js"),[]),"../data/gobernacion-valle/2021.json":()=>N(()=>import("./2021-CTNt0CSD.js"),[]),"../data/gobernacion-valle/2022.json":()=>N(()=>import("./2022-CO3HVyE6.js"),[]),"../data/gobernacion-valle/2023.json":()=>N(()=>import("./2023-DpQun6Of.js"),[]),"../data/gobernacion-valle/2024.json":()=>N(()=>import("./2024-C85h5RGw.js"),[]),"../data/gobernacion-valle/2025.json":()=>N(()=>import("./2025-HUFIYlkh.js"),[]),"../data/infibague/2021.json":()=>N(()=>import("./2021-B9Xfz2lF.js"),[]),"../data/infibague/2022.json":()=>N(()=>import("./2022-D-GZ4eF1.js"),[]),"../data/infibague/2023.json":()=>N(()=>import("./2023-DyQgsWQS.js"),[]),"../data/infibague/2024.json":()=>N(()=>import("./2024-DLtBQgoW.js"),[]),"../data/infibague/2025.json":()=>N(()=>import("./2025-Ad051HOY.js"),[])}),`../data/${r}/${t}.json`,4)).default;return Object.keys(a)}catch{throw new Error(`Failed to load data for ${l} ${t}`)}}const ce=["Alcald√≠a de Palmira","Alcald√≠a de Tulu√°","Gobernaci√≥n del Valle del Cauca","Infibagu√©"],bt={"Sin Solicitud":"Sin Solicitud",New:"Nuevo",Refinement:"Refinamiento",Ready:"Listo",Active:"Activo","Validaci√≥n y aprobaci√≥n de Tributaria - Anal√≠tica":"Validaci√≥n y Aprobaci√≥n de Tributaria - Anal√≠tica","Cargue Archivo Staging":"Cargue Archivo Staging","Validaci√≥n Tributaria Staging":"Validaci√≥n Tributaria Staging","Cargue Archivo PROD":"Cargue Archivo PROD","Validaci√≥n y Aprobaci√≥n de Tributaria - PROD":"Validaci√≥n y Aprobaci√≥n de Tributaria - PROD","Facturaci√≥n en PROD":"Facturaci√≥n en PROD","Generar Reportes":"Generar Reportes","QA Certification":"Certificaci√≥n QA","Gestion Tributaria":"Gesti√≥n Tributaria",Impediment:"Impedimento",Paused:"Pausado","Peer Review":"Revisi√≥n por Pares","Third Party":"Terceros",Staging:"Pre-producci√≥n",Production:"Producci√≥n",Closed:"Cerrado",Removed:"Removido"};function ye(l){switch(l){case"Cargado en PEE":return{bg:"bg-rose-100",text:"text-rose-700"};case"Sin Solicitud":return{bg:"bg-black-100",text:"text-gray-600"};case"New":return{bg:"bg-blue-100",text:"text-blue-800"};case"Refinement":return{bg:"bg-purple-100",text:"text-purple-800"};case"Ready":return{bg:"bg-blue-100",text:"text-blue-800"};case"Active":return{bg:"bg-blue-100",text:"text-blue-800"};case"QA Certification":return{bg:"bg-yellow-100",text:"text-yellow-800"};case"Gestion Tributaria":return{bg:"bg-orange-100",text:"text-orange-800"};case"Impediment":return{bg:"bg-red-100",text:"text-red-800"};case"Paused":return{bg:"bg-gray-100",text:"text-gray-800"};case"Peer Review":return{bg:"bg-indigo-100",text:"text-indigo-800"};case"Third Party":return{bg:"bg-pink-100",text:"text-pink-800"};case"Staging":return{bg:"bg-cyan-100",text:"text-cyan-800"};case"Production":return{bg:"bg-blue-100",text:"text-green-800"};case"Closed":return{bg:"bg-green-100",text:"text-green-800"};case"Removed":return{bg:"bg-red-100",text:"text-red-800"};case"Validaci√≥n y aprobaci√≥n de Tributaria - Anal√≠tica":return{bg:"bg-blue-100",text:"text-gray-800"};case"Cargue Archivo Staging":return{bg:"bg-orange-100",text:"text-gray-800"};case"Validaci√≥n Tributaria Staging":return{bg:"bg-orange-100",text:"text-gray-800"};case"Cargue Archivo PROD":return{bg:"bg-blue-100",text:"text-gray-800"};case"Validaci√≥n y Aprobaci√≥n de Tributaria - PROD":return{bg:"bg-green-100",text:"text-gray-800"};case"Facturaci√≥n en PROD":return{bg:"bg-blue-100",text:"text-gray-800"};case"Validaci√≥n Tributaria de Facturaci√≥n":return{bg:"bg-green-100",text:"text-gray-800"};case"Dispersi√≥n en BD":return{bg:"bg-blue-100",text:"text-gray-800"};case"Pendiente por facturar":return{bg:"bg-amber-100",text:"text-amber-700"};case"Generar Reportes":return{bg:"bg-blue-100",text:"text-gray-800"};default:return{bg:"bg-gray-50",text:"text-gray-500"}}}function ja(l){return{"Alcald√≠a de Palmira":"alcaldia-palmira","Alcald√≠a de Tulu√°":"alcaldia-tulua","Gobernaci√≥n del Valle del Cauca":"gobernacion-valle",Infibagu√©:"infibague"}[l]||""}function Te(l){switch(l){case"Sin Solicitud":return"üìù";case"New":return"üÜï";case"Refinement":return"üîç";case"Ready":return"üÜï";case"Active":return"‚ö°";case"Limpieza y Transformaci√≥n":return"üßπ";case"Validaci√≥n y aprobaci√≥n de Tributaria - Anal√≠tica":return"üîçüßπ";case"Cargue Archivo Staging":return"üì§";case"Validaci√≥n Tributaria Staging":return"üîçüì§";case"Cargue Archivo PROD":return"üì¶";case"Validaci√≥n y Aprobaci√≥n de Tributaria - PROD":return"üîçüì¶";case"Facturaci√≥n en PROD":return"üí∞";case"Validaci√≥n Tributaria de Facturaci√≥n":return"üîçüí∞";case"Dispersi√≥n en BD":return"üìäüíæ";case"Generar Reportes":return"üìä";case"QA Certification":return"üîç";case"Gestion Tributaria":return"üí∞";case"Impediment":return"üö´";case"Paused":return"‚è∏Ô∏è";case"Peer Review":return"üë•";case"Third Party":return"ü§ù";case"Staging":return"üé≠";case"Production":return"üöÄ";case"Pendiente por facturar":return"üìã";case"Closed":return"‚úÖ";case"Removed":return"üóëÔ∏è";default:return"‚ùì"}}async function ya(l,t){const s={};try{(await ba(l,t)).forEach(n=>{s[n]={},U.forEach(a=>{s[n][a]={estado:"Sin Solicitud",entidad:"",fechaRecibido:"",fechaCerrado:"",notas:"",workItemId:null}})})}catch(r){throw console.error("Error generating blank data:",r),new Error(`No se pudo generar datos para ${l} ${t}: ${r instanceof Error?r.message:"Error desconocido"}`)}return s}class Fe{static renameCompany(t,s,r){if(s===r)return t;const n=B.validateCompanyRename(t,s,r);if(!n.isValid)throw new Error(n.error);const a=B.createDataBackup(t),i={};try{for(const[o,c]of Object.entries(t))o===s?(B.validateCompanyData(c)||console.warn(`Company data validation failed for ${s}, proceeding anyway`),i[r]=c):i[o]=c;return i}catch(o){return console.error("Error during company rename, restoring backup:",o),a}}static addNewCompany(t,s,r){const n=s.trim();if(!n)throw new Error("El nombre de la empresa no puede estar vac√≠o");if(t[n])throw new Error(`Ya existe una empresa con el nombre "${n}"`);const a={_metadata:r};if(!B.validateCompanyData(a))throw new Error("Los datos de la nueva empresa no son v√°lidos");return{...t,[n]:a}}static getCompanyNames(t){return Object.keys(t)}static validateCompanyName(t,s,r){const n=t.trim();return n?n!==r&&s.includes(n)?{isValid:!1,error:"Ya existe una empresa con este nombre"}:{isValid:!0}:{isValid:!1,error:"El nombre de la empresa es requerido"}}static hasAnyBillingData(t){for(const[s,r]of Object.entries(t))if(s!=="_metadata"&&r&&typeof r=="object")return!0;return!1}static sortCompanies(t,s,r=!1){return t.sort((n,a)=>{if(r){const i=this.hasAnyBillingData(s[n]||{}),o=this.hasAnyBillingData(s[a]||{});if(i&&!o)return-1;if(!i&&o)return 1}return n.localeCompare(a,"es")})}static async validateCompanyMultiYear(t,s,r,n){const a=t.trim(),i=[],o={};for(const d of s)try{const h=await B.loadDataForEntityYear(r,d);o[d]=h}catch{o[d]={}}for(const d of s){const h=o[d];if(!!h[a])i.push({year:d,exists:!0,canCreate:!1,message:"Ya existe empresa con este nombre"});else{const C=this.calculateAlphabeticalPosition(a,Object.keys(h));i.push({year:d,exists:!1,canCreate:!0,message:`Se crear√° en posici√≥n alfab√©tica #${C}`,position:C})}}const c=i.filter(d=>d.canCreate),m=i.filter(d=>!d.canCreate),u=[],g=c.length>0&&c[0].position||1;return{companyName:a,successYears:c,skippedYears:m,errors:u,alphabeticalPosition:g,totalChanges:c.length}}static async createCompanyMultiYear(t,s,r){const{companyName:n,successYears:a}=t;for(const i of a)try{let o;try{o=await B.loadDataForEntityYear(r,i.year)}catch{o={}}const c={_metadata:s},m={...o,[n]:c},u=this.sortBillingDataAlphabetically(m);await B.saveDataForEntityYear(r,i.year,u)}catch(o){throw console.error(`Error creating company in year ${i.year}:`,o),new Error(`Failed to create company in year ${i.year}: ${o}`)}}static calculateAlphabeticalPosition(t,s){return[...s,t].sort((n,a)=>n.localeCompare(a,"es")).indexOf(t)+1}static sortBillingDataAlphabetically(t){const s=Object.entries(t).sort(([r],[n])=>r.localeCompare(n,"es"));return Object.fromEntries(s)}static async checkCompanyExistsInYear(t,s,r){try{return!!(await B.loadDataForEntityYear(r,s))[t.trim()]}catch{return!1}}}function Ce(l){const s={"Sin Solicitud":"Sin Solicitud","Cargado en PEE":"Cargado en PEE",New:"New",Refinement:"Refinement",Ready:"Ready",Active:"Active","QA Certification":"QA Certification","Gestion Tributaria":"Gestion Tributaria",Impediment:"Impediment",Paused:"Paused","Peer Review":"Peer Review","Third Party":"Third Party",Staging:"Staging",Production:"Production",Closed:"Closed",Removed:"Removed","Validaci√≥n y aprobaci√≥n de Tributaria - Anal√≠tica":"Validaci√≥n y aprobaci√≥n de Tributaria - Anal√≠tica","Cargue Archivo Staging":"Cargue Archivo Staging","Validaci√≥n Tributaria Staging":"Validaci√≥n Tributaria Staging","Cargue Archivo PROD":"Cargue Archivo PROD","Validaci√≥n y Aprobaci√≥n de Tributaria - PROD":"Validaci√≥n y Aprobaci√≥n de Tributaria - PROD","Facturaci√≥n en PROD":"Facturaci√≥n en PROD","Validaci√≥n Tributaria de Facturaci√≥n":"Validaci√≥n Tributaria de Facturaci√≥n","Dispersi√≥n en BD":"Dispersi√≥n en BD","Pendiente por facturar":"Pendiente por facturar","Generar Reportes":"Generar Reportes","Validaci√≥n y Aprobaci√≥n de Tributaria - BD":"Validaci√≥n y aprobaci√≥n de Tributaria - Anal√≠tica","Cargue del Archivo en BD":"Cargue Archivo Staging","Facturacion PROD":"Facturaci√≥n en PROD","Validaci√≥n Tributaria PROD":"Validaci√≥n y Aprobaci√≥n de Tributaria - PROD","En Validaci√≥n":"Peer Review","Pendiente Aprobaci√≥n":"Ready","En Proceso":"Active",Finalizado:"Closed",Cancelado:"Removed","Limpieza y Transformacion":"Active"}[l];return s||(["Sin Solicitud","New","Refinement","Ready","Active","QA Certification","Gestion Tributaria","Impediment","Paused","Peer Review","Third Party","Staging","Production","Closed","Removed","Limpieza y Transformaci√≥n","Validaci√≥n y aprobaci√≥n de Tributaria - Anal√≠tica","Cargue Archivo Staging","Validaci√≥n Tributaria Staging","Cargue Archivo PROD","Validaci√≥n y Aprobaci√≥n de Tributaria - PROD","Facturaci√≥n en PROD","Validaci√≥n Tributaria de Facturaci√≥n","Dispersi√≥n en BD","Pendiente por facturar","Generar Reportes"].includes(l)?l:(console.warn(`[State Mapper] Unrecognized state value: "${l}". Mapping to 'Sin Solicitud'.`),"Valor no reconocido en Azure"))}function ee(l,t){const[s,r]=x.useState({}),[n,a]=x.useState(!0),[i,o]=x.useState(null),c=x.useRef(null);x.useEffect(()=>{if(!t)return;(async()=>{a(!0),o(null);try{const b=await B.loadDataForEntityYear(t,l);r(b)}catch(b){console.error("Error loading data:",b),o(`No se pudo cargar los datos para ${t} ${l}`),r({})}finally{a(!1)}})()},[t,l]);const m=x.useCallback(async()=>{if(!(!t||n))try{return await B.saveDataForEntityYear(t,l,s),console.log("Data saved successfully for",t,l),!0}catch(v){return console.error("Error saving data:",v),!1}},[t,l,s,n]),u=x.useCallback(v=>{!t||n||(c.current&&clearTimeout(c.current),c.current=setTimeout(async()=>{try{const b=v||s;await B.saveDataForEntityYear(t,l,b),console.log("Data auto-saved after user change:",t,l)}catch(b){console.error("Error auto-saving after user change:",b)}},2e3))},[t,l,s,n]),g=x.useCallback((v,b,S,D)=>{r(w=>{const A=w[v]?.[b],T={...A,[S]:D};let M=T;S==="estado"&&D==="Closed"?K.shouldCalculateAndStoreDays("Closed",T.fechaRecibido,T.fechaCerrado)&&(M={...T,diasProcesamiento:K.calculateProcessingDaysForStorage(T.fechaRecibido,T.fechaCerrado)}):(S==="fechaRecibido"||S==="fechaCerrado")&&A?.estado==="Closed"?K.shouldCalculateAndStoreDays("Closed",S==="fechaRecibido"?D:T.fechaRecibido,S==="fechaCerrado"?D:T.fechaCerrado)&&(M={...T,diasProcesamiento:K.calculateProcessingDaysForStorage(S==="fechaRecibido"?D:T.fechaRecibido,S==="fechaCerrado"?D:T.fechaCerrado)}):S==="estado"&&D!=="Closed"&&A?.diasProcesamiento!==void 0&&(M={...T,diasProcesamiento:null});const z={...w,[v]:{...w[v],[b]:M}};return u(z),z})},[u]),d=x.useCallback((v,b,S)=>{r(D=>{const w=D[v]?.[b];let A={...w,estado:S};S==="Closed"&&w?K.shouldCalculateAndStoreDays("Closed",w.fechaRecibido,w.fechaCerrado)&&(A={...A,diasProcesamiento:K.calculateProcessingDaysForStorage(w.fechaRecibido,w.fechaCerrado)}):S!=="Closed"&&w?.diasProcesamiento!==void 0&&(A={...A,diasProcesamiento:null});const T={...D,[v]:{...D[v],[b]:A}};return u(T),T})},[u]),h=x.useCallback((v,b)=>{const S=s[v];return S?B.getMonthlyBillingData(S,b):null},[s]),y=x.useCallback((v,b)=>{r(S=>{const D=S[v]||{},w=B.updateCompanyMetadata(D,b);return{...S,[v]:w}})},[]),C=x.useCallback(v=>{const b=s[v];return B.getCompanyMetadata(b||{})},[s]),p=x.useCallback((v,b)=>{r(S=>{try{return Fe.renameCompany(S,v,b)}catch(D){throw console.error("Error renaming company:",D),D}})},[]),f=x.useCallback((v,b)=>{r(S=>{try{return Fe.addNewCompany(S,v,b)}catch(D){throw console.error("Error adding new company:",D),D}})},[]),j=x.useCallback(()=>Fe.getCompanyNames(s),[s]),_=x.useCallback(v=>{r(b=>{const S={...b};return v.forEach(D=>{delete S[D]}),S})},[]),R=x.useCallback(async()=>{try{r(await ya(t,l.toString())),o(null)}catch(v){console.error("Error regenerating data:",v),o(`No se pudo generar datos para ${t} ${l}`),r({})}},[t,l]),E=x.useCallback(async(v,b,S)=>{const D=[],w=new Map,A=v.allYears?[2017,2018,2019,2020,2021,2022,2023,2024,2025]:[l],T=[t],M={};let z=0;for(const L of A)for(const F of T)try{const I=await B.loadDataForEntityYear(F,L);M[`${F}-${L}`]=I;const V=v.allCompanies?Object.keys(I):v.companies.filter(Z=>I[Z]);for(const Z of V)for(const G of U){const $=I[Z]?.[G];if($?.workItemId&&$.estado!=="Closed"){const ae={company:Z,month:G,year:L,entity:F},re=w.get($.workItemId)||[];w.set($.workItemId,[...re,ae]),z++}}}catch(I){console.warn(`Could not load data for ${F} ${L}:`,I)}if(w.size===0)throw new Error("No se encontraron work items para sincronizar");let k=0;try{const L=Array.from(w.keys()),F=await b.syncMultipleWorkItemsWithDates(L);for(const[I,V]of F){const Z=w.get(I);if(Z)for(const G of Z){k++,S?.(k,z,`${G.company} - ${G.month}`);const{company:$,month:ae,year:re,entity:le}=G,ie=M[`${le}-${re}`][$]?.[ae];if(ie){const ue=ie.estado,xe=Ce(V.state),Ae=ue!==xe||ie.fechaRecibido!==V.fechaRecibido||ie.fechaCerrado!==V.fechaCerrado||ie.workItemType!==V.workItemType;if(D.push({company:$,month:ae,oldState:ue,newState:xe,fechaRecibido:V.fechaRecibido,fechaCerrado:V.fechaCerrado,success:!0,noChanges:!Ae}),re===l&&le===t&&Ae&&(d($,ae,xe),g($,ae,"fechaRecibido",V.fechaRecibido),g($,ae,"fechaCerrado",V.fechaCerrado),g($,ae,"workItemType",V.workItemType)),re!==l||le!==t)try{const De=V.fechaRecibido||ie.fechaRecibido,Le=V.fechaCerrado||ie.fechaCerrado;let Me=ie.diasProcesamiento;xe==="Closed"&&K.shouldCalculateAndStoreDays("Closed",De,Le)?Me=K.calculateProcessingDaysForStorage(De,Le):xe!=="Closed"&&(Me=null),M[`${le}-${re}`][$][ae]={...ie,estado:xe,fechaRecibido:De,fechaCerrado:Le,diasProcesamiento:Me,workItemType:V.workItemType},await B.saveDataForEntityYear(le,re,M[`${le}-${re}`])}catch(De){console.error(`Error saving data for ${le} ${re}:`,De)}}}}return D}catch(L){throw console.error("Error during advanced sync:",L),L}},[l,t,g,d]);return{billingData:s,isLoading:n,error:i,updateField:g,updateStatusFromAzure:d,getCellData:h,updateCompanyMetadata:y,getCompanyMetadata:C,renameCompany:p,addNewCompany:f,getCompanyNames:j,deleteCompanies:_,regenerateDataForEntityYear:R,performAdvancedSync:E,saveData:m}}const Na={FT01:{type:"FT01",name:"FT01 - Consumos",description:"Archivo de consumos de energ√≠a el√©ctrica"},FT03:{type:"FT03",name:"FT03 - Recaudos",description:"Archivo de recaudos reportados por comercializadora"},FT06:{type:"FT06",name:"FT06 - Excluidos",description:"Archivo de usuarios excluidos (pagan directo a alcald√≠a)"}};function va(l){return`${l.ft01}${l.ft03}${l.ft06}`}function Qt(l){const t={ft01:"-",ft03:"-",ft06:"-"};if(!l||l.length!==3)return t;const[s,r,n]=l.split(""),a=["P","N","-"];return!a.includes(s)||!a.includes(r)||!a.includes(n)?t:{ft01:s,ft03:r,ft06:n}}function wa(l){const t=[l.ft01,l.ft03,l.ft06],s=t.filter(a=>a==="P").length,r=t.filter(a=>a==="N").length;return t.filter(a=>a==="-").length===0?"complete":s>0||r>0?"partial":"pending"}function Xt(l){const t=[l.ft01,l.ft03,l.ft06],s=t.filter(i=>i==="P").length,r=t.filter(i=>i==="N").length,n=t.filter(i=>i==="-").length;return{overallStatus:wa(l),processed:s,noApply:r,pending:n,details:l}}function ot(l){const t=Qt(l);return Xt(t)}function Xe(l){switch(l){case"complete":return{bg:"bg-green-100",text:"text-green-800",border:"border-green-200"};case"partial":return{bg:"bg-yellow-100",text:"text-yellow-800",border:"border-yellow-200"};case"pending":return{bg:"bg-red-100",text:"text-red-800",border:"border-red-200"};default:return{bg:"bg-gray-100",text:"text-gray-800",border:"border-gray-200"}}}function Zt(l){switch(l){case"complete":return"Completo";case"partial":return"Parcial";case"pending":return"Pendiente";default:return"Desconocido"}}function Ca(l){switch(l){case"P":return"Procesado";case"N":return"No Aplica";case"-":return"Pendiente";default:return"Desconocido"}}function jt(l){switch(l){case"complete":return"‚úÖ";case"partial":return"üü°";case"pending":return"üî¥";default:return"‚ùì"}}function Da(l){switch(l){case"-":return"P";case"P":return"N";case"N":return"-";default:return"-"}}function Sa(l){const[t,s]=x.useState(2025),[r,n]=x.useState(""),[a,i]=x.useState(""),[o,c]=x.useState([]),[m,u]=x.useState(null),g=x.useMemo(()=>Object.keys(l),[l]),d=x.useMemo(()=>g.filter(b=>{const S=b.toLowerCase().includes(r.toLowerCase()),D=a===""||U.some(T=>B.getMonthlyBillingData(l[b]||{},T)?.entidad===a);let w=!0;if(m&&(w=U.some(T=>{const M=B.getMonthlyBillingData(l[b]||{},T);return M?ot(M.ft).overallStatus===m:!1})),o.length===0)return S&&D&&w;const A=U.some(T=>{const M=B.getMonthlyBillingData(l[b]||{},T);if(!M)return o.includes("Sin Solicitud");const z=Ce(M.estado);return o.includes(M.estado)||o.includes(z)});return S&&D&&A&&w}),[g,r,a,o,m,l]),h=x.useMemo(()=>{const b={"Sin Solicitud":0,New:0,Refinement:0,Ready:0,Active:0,"Validaci√≥n y aprobaci√≥n de Tributaria - Anal√≠tica":0,"Cargue Archivo Staging":0,"Validaci√≥n Tributaria Staging":0,"Cargue Archivo PROD":0,"Validaci√≥n y Aprobaci√≥n de Tributaria - PROD":0,"Facturaci√≥n en PROD":0,"Validaci√≥n Tributaria de Facturaci√≥n":0,"Dispersi√≥n en BD":0,"Generar Reportes":0,"QA Certification":0,"Gestion Tributaria":0,Impediment:0,Paused:0,"Peer Review":0,"Third Party":0,Staging:0,Production:0,Closed:0,Removed:0,conWorkItems:0};return d.forEach(S=>{U.forEach(D=>{const w=B.getMonthlyBillingData(l[S]||{},D);if(w){const A=Ce(w.estado);b[A]=(b[A]??0)+1,w.workItemId&&b.conWorkItems++}})}),b},[d,l]),y=x.useMemo(()=>{const b={conWorkItems:0};return d.forEach(S=>{U.forEach(D=>{const w=B.getMonthlyBillingData(l[S]||{},D);if(w){const A=w.estado;b[A]?b[A]++:b[A]=1,w.workItemId&&b.conWorkItems++}})}),b},[d,l]),C=x.useCallback(b=>{c(S=>S.includes(b)?S.filter(D=>D!==b):[...S,b])},[]),p=x.useCallback(()=>{c([]),u(null)},[]),f=o.length>0||m!==null,j=x.useMemo(()=>({selectedStatuses:o,toggleStatus:C,clearFilters:p,isFilterActive:f}),[o,C,p,f]),_=x.useMemo(()=>{const b={complete:0,partial:0,pending:0,total:0};return d.forEach(S=>{U.forEach(D=>{const w=B.getMonthlyBillingData(l[S]||{},D);if(w&&w.estado!=="Sin Solicitud"){const A=ot(w.ft);b[A.overallStatus]++,b.total++}})}),b},[d,l]),R=x.useCallback(b=>{n(b)},[]),E=x.useCallback(b=>{i(b)},[]),v=x.useCallback(b=>{u(b)},[]);return{selectedYear:t,setSelectedYear:s,searchTerm:r,setSearchTerm:R,selectedEntity:a,setSelectedEntity:E,filteredCompanies:d,statistics:h,realStateStatistics:y,statusFilters:j,selectedFTStatus:m,setSelectedFTStatus:v,ftStatistics:_}}class ve{static convertAzureDate(t){if(!t)return"";try{return new Date(t).toISOString().split("T")[0]}catch(s){return console.error("Error converting Azure date:",s),""}}static calculateDuration(t,s){if(!t||!s)return null;try{const r=this.parseLocalDate(t),a=this.parseLocalDate(s).getTime()-r.getTime();return Math.ceil(a/(1e3*60*60*24))}catch(r){return console.error("Error calculating duration:",r),null}}static parseLocalDate(t){const s=t.split("-");if(s.length===3&&s[0].length===4){const r=parseInt(s[0]),n=parseInt(s[1])-1,a=parseInt(s[2]);if(!isNaN(r)&&!isNaN(n)&&!isNaN(a)&&n>=0&&n<=11&&a>=1&&a<=31)return new Date(r,n,a)}return new Date(t)}static calculateRequestDuration(t,s){return!t||!s?null:this.calculateDuration(t,s)}static calculateDaysSinceCreation(t){if(!t)return null;const s=new Date,r=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`;return this.calculateDuration(t,r)}static formatDisplayDate(t){if(!t)return"Sin fecha";try{return this.parseLocalDate(t).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})}catch(s){return console.error("Error formatting date:",s),"Fecha inv√°lida"}}static getDurationColor(t){return t>30?"text-red-600":t>15?"text-orange-600":t>7?"text-yellow-600":"text-green-600"}static formatDurationText(t){return t===null?"Sin calcular":t===0?"Mismo d√≠a":t===1?"1 d√≠a":`${t} d√≠as`}}class Ea{config;constructor(t){this.config=t}updateConfig(t){this.config=t}isEnabled(){return this.config.enabled&&!!this.config.pat&&!!this.config.organization&&!!this.config.project}async getWorkItem(t){if(!this.isEnabled()||!t)return null;try{const s=`https://dev.azure.com/${this.config.organization}/${this.config.project}/_apis/wit/workitems/${t}?api-version=7.0`,r=await fetch(s,{headers:{Authorization:`Basic ${btoa(`:${this.config.pat}`)}`}});if(r.ok){const n=await r.json(),a=n.fields["System.BoardColumn"],i=n.fields["System.State"];let o;return a&&a.trim()!==""?o=a:o=i||"Sin Solicitud",{state:o,title:n.fields["System.Title"],url:n._links.html.href,createdDate:n.fields["System.CreatedDate"]||"",changedDate:n.fields["System.ChangedDate"]||"",closedDate:n.fields["Microsoft.VSTS.Common.ClosedDate"]||null,workItemType:n.fields["System.WorkItemType"]||"Unknown"}}}catch(s){console.error("Error fetching work item:",s)}return null}async createWorkItem(t,s,r,n){if(!this.isEnabled())return null;try{const a=`https://dev.azure.com/${this.config.organization}/${this.config.project}/_apis/wit/workitems/$Task?api-version=7.0`,i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json-patch+json",Authorization:`Basic ${btoa(`:${this.config.pat}`)}`},body:JSON.stringify([{op:"add",path:"/fields/System.Title",value:`Facturaci√≥n ${t} - ${s} ${r}`},{op:"add",path:"/fields/System.Description",value:`Solicitud de facturaci√≥n para ${t} correspondiente a ${s} ${r}. Entidad solicitante: ${n}`},{op:"add",path:"/fields/System.Tags",value:`Facturaci√≥n; ${t}; ${s}; ${r}`}])});if(i.ok)return(await i.json()).id}catch(a){console.error("Error creating work item:",a)}return null}async syncFromAzure(t){const s=await this.getWorkItem(t);return s?Ce(s.state):null}async syncWorkItemData(t){const s=await this.getWorkItem(t);return s?{state:Ce(s.state),fechaRecibido:ve.convertAzureDate(s.createdDate),fechaCerrado:s.closedDate?ve.convertAzureDate(s.closedDate):"",workItemType:s.workItemType}:null}async syncMultipleWorkItems(t){const s=new Map;if(!this.isEnabled()||t.length===0)return s;const r=10;for(let n=0;n<t.length;n+=r){const i=t.slice(n,n+r).map(async o=>{try{const c=await this.syncFromAzure(o);c&&s.set(o,c)}catch(c){console.error(`Error syncing work item ${o}:`,c)}});await Promise.all(i),n+r<t.length&&await new Promise(o=>setTimeout(o,100))}return s}async syncMultipleWorkItemsWithDates(t){const s=new Map;if(!this.isEnabled()||t.length===0)return s;const r=10;for(let n=0;n<t.length;n+=r){const i=t.slice(n,n+r).map(async o=>{try{const c=await this.syncWorkItemData(o);c&&s.set(o,c)}catch(c){console.error(`Error syncing work item ${o}:`,c)}});await Promise.all(i),n+r<t.length&&await new Promise(o=>setTimeout(o,100))}return s}getWorkItemUrl(t){return`https://dev.azure.com/${this.config.organization}/${this.config.project}/_workitems/edit/${t}`}}const _a=()=>{try{const l=localStorage.getItem("azure-devops-config");if(l)return JSON.parse(l)}catch(l){console.warn("Error loading Azure DevOps config from localStorage:",l)}return{organization:"",project:"",pat:"",enabled:!1}},ka=l=>{try{localStorage.setItem("azure-devops-config",JSON.stringify(l))}catch(t){console.warn("Error saving Azure DevOps config to localStorage:",t)}};function Aa(){const[l,t]=x.useState(_a),[s,r]=x.useState(!1),[n]=x.useState(()=>new Ea(l)),a=x.useCallback(h=>{t(h),n.updateConfig(h),ka(h)},[n]),i=x.useCallback(async(h,y,C,p)=>{if(!n.isEnabled())return null;r(!0);try{return await n.createWorkItem(h,y,C,p)}finally{r(!1)}},[n]),o=x.useCallback(async h=>{if(!n.isEnabled()||!h)return null;r(!0);try{return await n.syncFromAzure(h)}finally{r(!1)}},[n]),c=x.useCallback(h=>n.getWorkItemUrl(h),[n]),m=x.useCallback(async h=>{if(!n.isEnabled()||h.length===0)return new Map;r(!0);try{return await n.syncMultipleWorkItems(h)}finally{r(!1)}},[n]),u=x.useCallback(async h=>{if(!n.isEnabled()||h.length===0)return new Map;r(!0);try{return await n.syncMultipleWorkItemsWithDates(h)}finally{r(!1)}},[n]),g=x.useCallback(async h=>{if(!n.isEnabled()||!h)return null;r(!0);try{return await n.syncWorkItemData(h)}finally{r(!1)}},[n]),d=x.useCallback(()=>n.isEnabled(),[n]);return{azureConfig:l,updateConfig:a,syncing:s,createWorkItem:i,syncFromAzure:o,syncMultipleWorkItems:m,syncMultipleWorkItemsWithDates:u,syncWorkItemData:g,getWorkItemUrl:c,isEnabled:d}}class Y{static calculateDaysRemaining(t){if(!t)return null;const s=new Date;s.setHours(0,0,0,0);const r=new Date(t);r.setHours(0,0,0,0);const n=r.getTime()-s.getTime();return Math.ceil(n/(1e3*60*60*24))}static getUrgencyLevel(t){return t===null?"none":t<0||t<=3?"critical":t<=7?"warning":"normal"}static getUrgencyColor(t){switch(t){case"critical":return{bg:"bg-red-100",text:"text-red-800",border:"border-red-300"};case"warning":return{bg:"bg-yellow-100",text:"text-yellow-800",border:"border-yellow-300"};case"normal":return{bg:"bg-green-100",text:"text-green-800",border:"border-green-300"};default:return{bg:"bg-gray-100",text:"text-gray-600",border:"border-gray-300"}}}static getUrgencyIcon(t){switch(t){case"critical":return"üî¥";case"warning":return"üü°";case"normal":return"üü¢";default:return"‚ö´"}}static formatDaysRemaining(t){return t===null?"Sin plazo":t<0?`Vencido (${Math.abs(t)}d)`:t===0?"Vence hoy":t===1?"Vence ma√±ana":`${t} d√≠as`}static calculateDaysElapsed(t){if(!t)return null;const s=new Date;s.setHours(0,0,0,0);const r=new Date(t);r.setHours(0,0,0,0);const n=s.getTime()-r.getTime();return Math.floor(n/(1e3*60*60*24))}static formatDaysElapsed(t){return t===null?"":t===0?"Hoy":t===1?"Hace 1 d√≠a":`Hace ${t} d√≠as`}static applyBulkDeadline(t,s){const{month:r,deadlines:n,scope:a,selectedCompanies:i}=s,o=this.getCompaniesToApply(t,r,a,i),c=JSON.parse(JSON.stringify(t));return o.forEach(m=>{c[m]||(c[m]={}),c[m][r]||(c[m][r]={estado:"Sin Solicitud",entidad:"",fechaRecibido:"",fechaCerrado:"",notas:"",workItemId:null}),c[m][r]={...c[m][r],fechaLimiteEmpresa:n.fechaLimiteEmpresa,fechaLimiteSLA:n.fechaLimiteSLA}}),c}static getCompaniesToApply(t,s,r,n){const a=Object.keys(t).filter(i=>i!=="_metadata");switch(r){case"all":return a;case"withRequests":return a.filter(i=>{const o=t[i][s];return o&&o.estado&&o.estado!=="Sin Solicitud"});case"withoutDeadline":return a.filter(i=>{const o=t[i][s];return!o||!o.fechaLimiteEmpresa||!o.fechaLimiteSLA});case"manual":return n||[];default:return[]}}static generateMonthlySummary(t,s){const r=Object.keys(t).filter(c=>c!=="_metadata");let n=0,a=null;r.forEach(c=>{const m=t[c][s],u=m?.fechaLimiteEmpresa,g=m?.fechaLimiteSLA;u&&g&&(n++,a||(a={fechaLimiteEmpresa:u,fechaLimiteSLA:g}))});const i=a?this.calculateDaysRemaining(a.fechaLimiteEmpresa):null,o=a?this.calculateDaysRemaining(a.fechaLimiteSLA):null;return{month:s,deadlines:a,companiesCount:r.length,companiesWithDeadline:n,daysUntilCompanyDeadline:i,daysUntilSLADeadline:o,companyDeadlineUrgency:this.getUrgencyLevel(i),slaDeadlineUrgency:this.getUrgencyLevel(o)}}static getCompaniesDeadlineInfo(t,s){return Object.keys(t).filter(n=>n!=="_metadata").map(n=>{const a=t[n][s],o=a?.fechaLimiteEmpresa&&a?.fechaLimiteSLA?{fechaLimiteEmpresa:a.fechaLimiteEmpresa,fechaLimiteSLA:a.fechaLimiteSLA}:null,c=o?this.calculateDaysRemaining(o.fechaLimiteEmpresa):null,m=o?this.calculateDaysRemaining(o.fechaLimiteSLA):null;return{company:n,month:s,deadlines:o,daysUntilCompanyDeadline:c,daysUntilSLADeadline:m,hasActiveRequest:a?.estado!=="Sin Solicitud"&&!!a?.estado,estado:a?.estado||"Sin Solicitud",fechaRecibido:a?.fechaRecibido||""}}).filter(n=>n.deadlines!==null)}static getUpcomingDeadlines(t,s=10){const r=[];return U.forEach(i=>{const o=this.getCompaniesDeadlineInfo(t,i);r.push(...o)}),r.filter(i=>i.estado!=="Closed"&&i.estado!=="Removed").sort((i,o)=>{const c=i.daysUntilSLADeadline??Number.MAX_VALUE,m=o.daysUntilSLADeadline??Number.MAX_VALUE;return c-m}).slice(0,s)}static getCompaniesWithoutDeadline(t,s){return Object.keys(t).filter(n=>n!=="_metadata").filter(n=>{const a=t[n][s];return!a||!a.fechaLimiteEmpresa||!a.fechaLimiteSLA})}static validateDeadlines(t){if(!t.fechaLimiteEmpresa||!t.fechaLimiteSLA)return{valid:!1,error:"Ambas fechas l√≠mite son requeridas"};const s=new Date(t.fechaLimiteEmpresa);return new Date(t.fechaLimiteSLA)<s?{valid:!1,error:"La fecha l√≠mite SLA debe ser igual o posterior a la fecha l√≠mite de la empresa"}:{valid:!0}}static shouldShowDeadline(t){return!t||t==="Sin Solicitud"?!0:!["Closed","Removed","Production"].includes(t)}}function Ra({billingData:l,onUpdateData:t}){const s=x.useCallback(u=>{const{month:g,deadlines:d,scope:h,selectedCompanies:y}=u,C=Y.validateDeadlines(d);if(!C.valid)throw new Error(C.error);let p=[];switch(h){case"all":p=Object.keys(l).filter(f=>f!=="_metadata");break;case"withRequests":p=Object.keys(l).filter(f=>f!=="_metadata").filter(f=>{const j=l[f]?.[g];return j&&j.estado&&j.estado!=="Sin Solicitud"});break;case"withoutDeadline":p=Y.getCompaniesWithoutDeadline(l,g);break;case"manual":p=y||[];break}return p.forEach(f=>{t(f,g,"fechaLimiteEmpresa",d.fechaLimiteEmpresa),t(f,g,"fechaLimiteSLA",d.fechaLimiteSLA)}),{appliedCount:p.length,companies:p}},[l,t]),r=x.useCallback((u,g,d)=>{const h=Y.validateDeadlines(d);if(!h.valid)throw new Error(h.error);t(u,g,"fechaLimiteEmpresa",d.fechaLimiteEmpresa),t(u,g,"fechaLimiteSLA",d.fechaLimiteSLA)},[t]),n=x.useCallback((u,g)=>{t(u,g,"fechaLimiteEmpresa",null),t(u,g,"fechaLimiteSLA",null)},[t]),a=x.useCallback((u,g)=>{const d=l[u]?.[g];return!d?.fechaLimiteEmpresa||!d?.fechaLimiteSLA?null:{fechaLimiteEmpresa:d.fechaLimiteEmpresa,fechaLimiteSLA:d.fechaLimiteSLA}},[l]),i=x.useCallback(u=>Y.generateMonthlySummary(l,u),[l]),o=x.useCallback(u=>Y.getCompaniesWithoutDeadline(l,u),[l]),c=x.useCallback(u=>Y.getCompaniesDeadlineInfo(l,u),[l]),m=x.useCallback(u=>{const g=Object.keys(l).filter(C=>C!=="_metadata"),d=g.filter(C=>{const p=l[C]?.[u];return p&&p.estado&&p.estado!=="Sin Solicitud"}),h=Y.getCompaniesWithoutDeadline(l,u),y=g.filter(C=>{const p=l[C]?.[u];return p?.fechaLimiteEmpresa&&p?.fechaLimiteSLA});return{all:g.length,withRequests:d.length,withoutDeadline:h.length,withDeadline:y.length}},[l]);return{applyDeadlinesToMonth:s,setDeadline:r,removeDeadline:n,getDeadline:a,getDeadlineSummaryByMonth:i,getCompaniesWithoutDeadline:o,getCompaniesDeadlineInfo:c,getCompaniesCount:m}}function Ia({selectedYear:l,onYearChange:t,searchTerm:s,onSearchChange:r,selectedEntity:n,onEntityChange:a,realStateStatistics:i,statusFilters:o,selectedFTStatus:c,onFTStatusChange:m,ftStatistics:u,deadlineBadge:g}){const[d,h]=x.useState(!1),y=p=>{switch(Ce(p)){case"Sin Solicitud":return"bg-gray-100 text-gray-600 border-gray-200";case"New":return"bg-blue-100 text-blue-800 border-blue-200";case"Refinement":return"bg-purple-100 text-purple-800 border-purple-200";case"Ready":return"bg-green-100 text-green-800 border-green-200";case"Active":return"bg-blue-100 text-blue-800 border-blue-200";case"QA Certification":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"Gestion Tributaria":return"bg-orange-100 text-orange-800 border-orange-200";case"Impediment":return"bg-red-100 text-red-800 border-red-200";case"Paused":return"bg-gray-100 text-gray-800 border-gray-200";case"Peer Review":return"bg-indigo-100 text-indigo-800 border-indigo-200";case"Third Party":return"bg-pink-100 text-pink-800 border-pink-200";case"Staging":return"bg-cyan-100 text-cyan-800 border-cyan-200";case"Production":return"bg-green-100 text-green-800 border-green-200";case"Closed":return"bg-gray-100 text-gray-800 border-gray-200";case"Removed":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-50 text-gray-500 border-gray-100"}},C=p=>{const f=Ce(p);return y(f)};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border mb-6 p-4 lg:p-6",children:[e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-6 h-6 text-blue-600"}),e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:n})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:["A√±o ",l]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[g&&g,e.jsx("div",{className:"text-sm text-gray-500 hidden sm:block",children:"Dashboard de Control"})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 rounded-lg px-3 py-2 border border-blue-200 flex-1",children:[e.jsx(q,{className:"w-4 h-4 text-blue-600"}),e.jsxs("select",{value:l,onChange:p=>t(parseInt(p.target.value)),className:"bg-transparent border-none outline-none font-medium text-blue-800 w-full",children:[e.jsx("option",{value:2017,children:"2017"}),e.jsx("option",{value:2018,children:"2018"}),e.jsx("option",{value:2019,children:"2019"}),e.jsx("option",{value:2020,children:"2020"}),e.jsx("option",{value:2021,children:"2021"}),e.jsx("option",{value:2022,children:"2022"}),e.jsx("option",{value:2023,children:"2023"}),e.jsx("option",{value:2024,children:"2024"}),e.jsx("option",{value:2025,children:"2025"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 rounded-lg px-3 py-2 border border-gray-200 flex-1",children:[e.jsx(H,{className:"w-4 h-4 text-gray-600"}),e.jsx("select",{value:n,onChange:p=>a(p.target.value),className:"bg-transparent border-none outline-none font-medium text-gray-800 w-full text-sm",children:ce.map(p=>e.jsx("option",{value:p,children:p.length>20?p.substring(0,20)+"...":p},p))})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ht,{className:"w-4 h-4 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"}),e.jsx("input",{type:"text",placeholder:"Buscar empresa...",value:s,onChange:p=>r(p.target.value),className:"pl-9 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 w-full"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>h(!d),className:`w-full flex items-center justify-center gap-2 px-3 py-2 border rounded-lg transition-colors ${o.isFilterActive?"bg-blue-50 text-blue-700 border-blue-200 hover:bg-blue-100":"bg-gray-50 text-gray-700 border-gray-200 hover:bg-gray-100"}`,children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{children:"Filtros"}),o.isFilterActive&&e.jsx("span",{className:"bg-blue-600 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:o.selectedStatuses.length+(c?1:0)}),e.jsx(Ge,{className:`w-4 h-4 transition-transform ${d?"rotate-180":""}`})]}),d&&e.jsxs("div",{className:"absolute right-0 top-full mt-2 bg-white border border-gray-200 rounded-lg shadow-lg p-4 min-w-80 z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Filtros Avanzados"}),o.isFilterActive&&e.jsxs("button",{onClick:o.clearFilters,className:"text-gray-500 hover:text-gray-700 flex items-center gap-1 text-sm",children:[e.jsx(se,{className:"w-3 h-3"}),"Limpiar Todo"]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"font-medium text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(Mt,{className:"w-4 h-4 text-purple-600"}),"Estado de Archivos FT"]}),e.jsxs("div",{className:"space-y-2",children:[["complete","partial","pending"].map(p=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[e.jsx("input",{type:"radio",name:"ftStatus",checked:c===p,onChange:()=>m(c===p?null:p),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:jt(p)}),e.jsx("span",{className:"text-sm font-medium",children:Zt(p)}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",p==="complete"?u.complete:p==="partial"?u.partial:u.pending,")"]})]})]},p)),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[e.jsx("input",{type:"radio",name:"ftStatus",checked:c===null,onChange:()=>m(null),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Todos"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Filtrar por Estado"}),e.jsx("div",{className:"space-y-2",children:["Sin Solicitud","New","Ready","Active","Gestion Tributaria","Validaci√≥n y aprobaci√≥n de Tributaria - Anal√≠tica","Cargue Archivo Staging","Validaci√≥n Tributaria Staging","Cargue Archivo PROD","Validaci√≥n y Aprobaci√≥n de Tributaria - PROD","Facturaci√≥n en PROD","Validaci√≥n Tributaria de Facturaci√≥n","Dispersi√≥n en BD","Generar Reportes","QA Certification","Impediment","Paused","Closed"].map(p=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:o.selectedStatuses.includes(p),onChange:()=>o.toggleStatus(p),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:Te(p)}),e.jsx("span",{className:"text-sm font-medium",children:p})]})]},p))})]})]})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4 mt-6",children:[Object.entries(i).filter(([p])=>p!=="conWorkItems").filter(([,p])=>p>0).map(([p,f])=>e.jsx("div",{className:`p-3 rounded-lg border ${C(p)}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:Te(p)}),e.jsx("span",{className:"font-medium text-sm truncate",title:p,children:p.length>15?p.slice(-15):p})]}),e.jsx("span",{className:"text-lg font-bold",children:f})]})},p)),e.jsx("div",{className:"p-3 rounded-lg border bg-purple-100 text-purple-800 border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium text-sm",children:"Con Work Items"})]}),e.jsx("span",{className:"text-lg font-bold",children:i.conWorkItems})]})}),u.total>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-3 rounded-lg border bg-green-100 text-green-800 border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"‚úÖ"}),e.jsx("span",{className:"font-medium text-sm",children:"FT Completos"})]}),e.jsx("span",{className:"text-lg font-bold",children:u.complete})]})}),e.jsx("div",{className:"p-3 rounded-lg border bg-yellow-100 text-yellow-800 border-yellow-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"üü°"}),e.jsx("span",{className:"font-medium text-sm",children:"FT Parciales"})]}),e.jsx("span",{className:"text-lg font-bold",children:u.partial})]})}),e.jsx("div",{className:"p-3 rounded-lg border bg-red-100 text-red-800 border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"üî¥"}),e.jsx("span",{className:"font-medium text-sm",children:"FT Pendientes"})]}),e.jsx("span",{className:"text-lg font-bold",children:u.pending})]})})]})]})]})}function Ta(l,t=20){return l?l.length<=t?l:"..."+l.slice(-t):""}function yt(l){if(!l)return"";const t={"Sin Solicitud":"Sin Solicitud","Validaci√≥n y aprobaci√≥n de Tributaria - Anal√≠tica":"...Tributaria - Anal√≠tica","Limpieza y Transformaci√≥n":"...Limpieza y Transformaci√≥n","Cargue Archivo Staging":"...Cargue Archivo Staging","QA Certification":"QA Certification"};return t[l]?t[l]:Ta(l,20)}function Pa({data:l,onCellClick:t}){const s=Ce(l.estado),r=ot(l.ft),n=jt(r.overallStatus),a=ye(l.estado),i=y=>{const C=y.match(/bg-(\w+)-(\d+)/);if(C){const p=C[1],j=parseInt(C[2])+100;return`border-${p}-${j}`}return"border-gray-200"},o=`${a.bg} ${a.text} ${i(a.bg)}`,c=K.shouldShowElapsedDays(s)?K.calculateElapsedDays(l.fechaRecibido):null,m=K.shouldShowClosedDays(s)?K.calculateClosedDays(l.fechaRecibido,l.fechaCerrado,l.diasProcesamiento):null,g=Y.shouldShowDeadline(l.estado)&&(l.fechaLimiteEmpresa||l.fechaLimiteSLA),d=l.fechaLimiteSLA?Y.calculateDaysRemaining(l.fechaLimiteSLA):null,h=Y.getUrgencyLevel(d);return e.jsx("button",{onClick:t,className:`w-full h-8 rounded border ${o}
        hover:shadow-sm transition-all duration-150 hover:brightness-95
        focus:outline-none focus:ring-1 focus:ring-blue-500 relative text-left`,children:e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 h-full relative",children:[e.jsx("div",{className:"flex items-center gap-1 min-w-0 flex-1",children:e.jsx("span",{className:"text-xs font-medium truncate",title:l.estado,children:yt(l.estado)})}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[c!==null&&e.jsxs("span",{className:`text-xs font-bold ${K.getElapsedDaysColor(c)}`,children:[c,"d"]}),m!==null&&e.jsxs("span",{className:`text-xs font-bold ${K.getClosedDaysColor()}`,children:[m,"d"]}),g&&d!==null&&e.jsxs("span",{className:`text-xs inline-flex items-center gap-0.5 ${h==="critical"?"text-red-700":h==="warning"?"text-yellow-700":"text-green-700"}`,title:`Deadline SLA: ${Y.formatDaysRemaining(d)}`,children:[h==="critical"?e.jsx(ne,{className:"w-2.5 h-2.5"}):e.jsx(me,{className:"w-2.5 h-2.5"}),e.jsxs("span",{className:"font-bold",children:[d,"d"]})]}),l.workItemId&&e.jsx("div",{className:"w-1.5 h-1.5 bg-purple-600 rounded-full"}),l.ft&&e.jsx("span",{className:"text-xs leading-none",title:`FT Status: Procesados ${r.processed}, No Aplican ${r.noApply}, Pendientes ${r.pending}`,children:n})]})]})})}function La({filteredCompanies:l,billingData:t,onCellClick:s,onCompanyClick:r}){return e.jsx("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full min-w-max",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-3 py-2 font-semibold text-gray-900 sticky left-0 bg-gray-50 z-10 min-w-48 text-sm",children:"Empresa de Energ√≠a"}),U.map(n=>e.jsx("th",{className:"text-center px-2 py-2 font-semibold text-gray-900 min-w-24 text-sm",children:n},n))]})}),e.jsx("tbody",{children:l.map((n,a)=>{const i=t[n],o=B.getCompanyMetadata(i||{});return e.jsxs("tr",{className:a%2===0?"bg-white hover:bg-gray-50":"bg-gray-50 hover:bg-gray-100",children:[e.jsx("td",{className:"px-3 py-1 font-medium text-gray-900 sticky left-0 bg-inherit z-10 border-r border-gray-200",children:e.jsxs("button",{onClick:c=>r(n,c),className:"flex items-center gap-2 truncate max-w-44 hover:text-blue-600 transition-colors text-left text-sm",title:`${n} - Click para editar informaci√≥n, Ctrl+Click para ver perfil`,children:[e.jsx("span",{className:"truncate",children:n}),o.esIncumbente&&e.jsx(He,{className:"w-3 h-3 text-yellow-500 flex-shrink-0",fill:"currentColor"})]})}),U.map(c=>{const m=B.getMonthlyBillingData(i||{},c);return m?e.jsx("td",{className:"p-1",children:e.jsx(Pa,{data:m,onCellClick:()=>s(n,c)})},c):e.jsx("td",{className:"p-1"},c)})]},n)})})]})})})}function Re(l){return l==null||isNaN(l)?"":new Intl.NumberFormat("es-CO",{minimumFractionDigits:0,maximumFractionDigits:0}).format(l)}function Ze(l){if(!l||l.trim()==="")return null;const t=l.replace(/\./g,"").replace(/,/g,""),s=parseInt(t,10);return isNaN(s)?null:s}function Ma({selectedCell:l,currentData:t,selectedYear:s,azureConfig:r,syncing:n,onClose:a,onUpdateData:i,onCreateWorkItem:o,onSyncFromAzure:c,getWorkItemUrl:m}){const[u,g]=x.useState(null),d=Qt(t?.ft),h=Xt(d),y=p=>{const f=Da(d[p]),j={...d,[p]:f},_=va(j);i(l.empresa,l.mes,"ft",_)};if(!l||!t)return null;const C=p=>{const f=ye(p),j={"bg-gray-100":"border-gray-200","bg-gray-50":"border-gray-100","bg-red-100":"border-red-200","bg-orange-100":"border-orange-200","bg-amber-100":"border-amber-200","bg-yellow-100":"border-yellow-200","bg-lime-100":"border-lime-200","bg-green-100":"border-green-200","bg-emerald-100":"border-emerald-200","bg-teal-100":"border-teal-200","bg-cyan-100":"border-cyan-200","bg-sky-100":"border-sky-200","bg-blue-100":"border-blue-200","bg-indigo-100":"border-indigo-200","bg-violet-100":"border-violet-200","bg-purple-100":"border-purple-200","bg-fuchsia-100":"border-fuchsia-200","bg-pink-100":"border-pink-200","bg-rose-100":"border-rose-200","bg-black-100":"border-gray-200"},_=f.bg.match(/bg-(\w+)-(\d+)/);let R="border-gray-200";if(_){const E=_[0];j[E]?R=j[E]:R=`border-${_[1]}-200`}return`${f.bg} ${f.text} ${R}`};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-7xl max-h-[95vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:l.empresa}),e.jsxs("p",{className:"text-blue-100 text-sm",children:[l.mes," ",s]})]})]}),e.jsx("button",{onClick:a,className:"text-blue-100 hover:text-white transition-colors p-2 hover:bg-blue-800 rounded-lg",children:e.jsx(se,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6 p-6 max-h-[calc(95vh-120px)] overflow-y-auto",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-5",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5 text-blue-600"}),"Estado y Progreso"]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Estado Actual"}),t.workItemId&&r.enabled&&e.jsxs("button",{onClick:()=>t.workItemId&&c(l.empresa,l.mes,t.workItemId),disabled:n,className:"flex items-center gap-1 text-blue-600 hover:text-blue-800 transition-colors text-xs disabled:opacity-50 bg-blue-50 px-2 py-1 rounded-lg",children:[e.jsx($e,{className:`w-3 h-3 ${n?"animate-spin":""}`}),"Sync Azure"]})]}),t.workItemId?e.jsxs("div",{children:[e.jsxs("div",{className:`inline-flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium ${C(t.estado)}`,children:[e.jsx("span",{className:"text-lg",children:Te(t.estado)}),e.jsx("span",{children:t.estado})]}),t.estado==="Closed"&&e.jsx("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:e.jsx("p",{className:"text-xs text-blue-700",children:'üí° Este item est√° cerrado localmente. Si fue reabierto en Azure DevOps, usa "Sync Azure" para actualizar su estado.'})})]}):e.jsxs("div",{children:[e.jsx("input",{type:"text",value:t.estado,onChange:p=>i(l.empresa,l.mes,"estado",p.target.value),placeholder:"Escribe un estado personalizado...",className:"w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all text-sm font-medium"}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Sin Work Item - Estado editable manualmente"})]}),K.shouldShowElapsedDays(t.estado)&&e.jsx("div",{className:"mt-3 p-3 bg-amber-50 rounded-lg border border-amber-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-amber-600"}),e.jsxs("span",{className:"text-sm text-amber-800",children:["D√≠as transcurridos:",e.jsxs("span",{className:`ml-1 font-bold ${K.getElapsedDaysColor(K.calculateElapsedDays(t.fechaRecibido)||0)}`,children:[K.calculateElapsedDays(t.fechaRecibido)||0," d√≠as"]})]})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4 text-purple-600"}),"Azure DevOps Work Item"]}),e.jsx("button",{onClick:()=>g(u==="workItemId"?null:"workItemId"),className:"text-blue-600 hover:text-blue-800 transition-colors p-1 hover:bg-blue-50 rounded",children:e.jsx(ge,{className:"w-4 h-4"})})]}),u==="workItemId"?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:t.workItemId||"",onChange:p=>i(l.empresa,l.mes,"workItemId",p.target.value?parseInt(p.target.value):null),placeholder:"ID del Work Item",className:"flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",autoFocus:!0}),e.jsx("button",{onClick:()=>g(null),className:"px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:e.jsx($s,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-gray-200 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:t.workItemId?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"font-medium",children:["#",t.workItemId]}),e.jsx("a",{href:m(t.workItemId),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 transition-colors",children:e.jsx(Ve,{className:"w-4 h-4"})})]}):e.jsx("span",{className:"text-gray-500 italic",children:"Sin Work Item"})}),r.enabled&&!t.workItemId&&e.jsx("button",{onClick:()=>o(l.empresa,l.mes,t.entidad),disabled:n,className:"bg-purple-600 text-white px-3 py-1 rounded-lg hover:bg-purple-700 disabled:opacity-50 transition-colors text-sm font-medium",children:"Crear Work Item"})]})]})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-5",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-green-600"}),"Entidad P√∫blica"]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-3 block",children:"Entidad Asignada"}),e.jsx("div",{className:"p-3 bg-white rounded-lg border border-gray-200",children:e.jsx("span",{className:t.entidad?"text-gray-900 font-medium":"text-gray-500 italic",children:t.entidad||"Sin asignar"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4 text-green-600"}),"Notas y Comentarios"]}),e.jsx("button",{onClick:()=>g(u==="notas"?null:"notas"),className:"text-green-600 hover:text-green-800 transition-colors p-1 hover:bg-green-100 rounded",children:e.jsx(ge,{className:"w-4 h-4"})})]}),u==="notas"?e.jsx("textarea",{value:t.notas,onChange:p=>i(l.empresa,l.mes,"notas",p.target.value),onBlur:()=>g(null),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 resize-none bg-white",rows:6,placeholder:"Agregar notas, observaciones o comentarios sobre esta solicitud...",autoFocus:!0}):e.jsx("div",{className:"p-3 bg-white rounded-lg border border-gray-200 min-h-32",children:e.jsx("span",{className:t.notas?"text-gray-900 whitespace-pre-wrap":"text-gray-500 italic",children:t.notas||"Sin notas o comentarios"})})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-purple-50 rounded-xl p-5",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Mt,{className:"w-5 h-5 text-purple-600"}),"Control de Archivos FT"]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Estado General"}),e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${Xe(h.overallStatus).bg} ${Xe(h.overallStatus).text} ${Xe(h.overallStatus).border}`,children:[jt(h.overallStatus)," ",Zt(h.overallStatus)]})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Procesados: ",h.processed," ‚Ä¢ No Aplican: ",h.noApply," ‚Ä¢ Pendientes: ",h.pending]})]}),e.jsx("div",{className:"space-y-3",children:Object.entries(Na).map(([p,f])=>{const j=p.toLowerCase(),_=d[j],R=Ca(_),E=v=>{switch(v){case"P":return"bg-green-100 text-green-800 border-green-200 hover:bg-green-200";case"N":return"bg-gray-100 text-gray-800 border-gray-200 hover:bg-gray-200";case"-":return"bg-red-100 text-red-800 border-red-200 hover:bg-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200 hover:bg-gray-200"}};return e.jsx("div",{className:"bg-white rounded-lg border border-purple-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:f.name}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:f.description})]}),e.jsx("button",{onClick:()=>y(j),className:`px-3 py-2 rounded-lg border text-sm font-medium transition-colors ${E(_)}`,title:`Click para cambiar estado. Actual: ${R}`,children:R})]})},j)})}),e.jsxs("div",{className:"mt-4 p-3 bg-purple-100 rounded-lg",children:[e.jsxs("div",{className:"text-xs text-purple-800",children:[e.jsx("strong",{children:"Estados:"})," Pendiente ‚Üí Procesado ‚Üí No Aplica ‚Üí Pendiente"]}),e.jsx("div",{className:"text-xs text-purple-700 mt-1",children:"Haz click en cada bot√≥n para cambiar el estado del archivo FT correspondiente."})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-xl p-5",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-blue-600"}),"Fechas Importantes"]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Fecha Recibido"}),e.jsx("button",{onClick:()=>g(u==="fechaRecibido"?null:"fechaRecibido"),className:"text-blue-600 hover:text-blue-800 transition-colors p-1 hover:bg-blue-100 rounded",children:e.jsx(ge,{className:"w-4 h-4"})})]}),u==="fechaRecibido"?e.jsx("input",{type:"date",value:t.fechaRecibido,onChange:p=>i(l.empresa,l.mes,"fechaRecibido",p.target.value),onBlur:()=>g(null),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white",autoFocus:!0}):e.jsx("div",{className:"p-3 bg-white rounded-lg border border-gray-200",children:e.jsx("span",{className:t.fechaRecibido?"text-gray-900 font-medium":"text-gray-500 italic",children:K.formatHumanDate(t.fechaRecibido)||"Sin fecha"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Fecha Cerrado"}),e.jsx("button",{onClick:()=>g(u==="fechaCerrado"?null:"fechaCerrado"),className:"text-blue-600 hover:text-blue-800 transition-colors p-1 hover:bg-blue-100 rounded",children:e.jsx(ge,{className:"w-4 h-4"})})]}),u==="fechaCerrado"?e.jsx("input",{type:"date",value:t.fechaCerrado,onChange:p=>i(l.empresa,l.mes,"fechaCerrado",p.target.value),onBlur:()=>g(null),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white",autoFocus:!0}):e.jsx("div",{className:"p-3 bg-white rounded-lg border border-gray-200",children:e.jsx("span",{className:t.fechaCerrado?"text-gray-900 font-medium":"text-gray-500 italic",children:K.formatHumanDate(t.fechaCerrado)||"Sin fecha"})})]})]}),(t.fechaRecibido||t.fechaCerrado)&&e.jsxs("div",{className:"bg-indigo-50 rounded-xl p-5",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Fs,{className:"w-5 h-5 text-indigo-600"}),"Duraci√≥n y M√©tricas"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[t.fechaRecibido&&t.fechaCerrado&&e.jsxs("div",{className:"bg-white rounded-lg border border-indigo-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(me,{className:"w-4 h-4 text-indigo-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Duraci√≥n Total"})]}),e.jsx("div",{className:"text-lg font-bold text-indigo-900",children:ve.formatDurationText(ve.calculateDuration(t.fechaRecibido,t.fechaCerrado))}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Desde recepci√≥n hasta cierre"})]}),t.fechaRecibido&&!t.fechaCerrado&&e.jsxs("div",{className:"bg-white rounded-lg border border-indigo-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(q,{className:"w-4 h-4 text-indigo-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"D√≠as Transcurridos"})]}),e.jsx("div",{className:`text-lg font-bold ${ve.getDurationColor(ve.calculateDaysSinceCreation(t.fechaRecibido)||0)}`,children:ve.formatDurationText(ve.calculateDaysSinceCreation(t.fechaRecibido))}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Desde la recepci√≥n"})]})]})]})]}),e.jsx("div",{className:"xl:col-span-3 mt-6",children:e.jsxs("div",{className:"bg-green-50 rounded-xl p-5",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5 text-green-600"}),"Datos de Facturaci√≥n"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4"}),"Cantidad de Facturas"]}),e.jsx("button",{onClick:()=>g(u==="cantidadFacturas"?null:"cantidadFacturas"),className:"text-green-600 hover:text-green-800 transition-colors p-1 hover:bg-green-100 rounded",children:e.jsx(ge,{className:"w-4 h-4"})})]}),u==="cantidadFacturas"?e.jsx("input",{type:"number",value:t.cantidadFacturas||"",onChange:p=>i(l.empresa,l.mes,"cantidadFacturas",p.target.value?parseInt(p.target.value):null),onBlur:()=>g(null),placeholder:"N√∫mero de facturas generadas",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white",autoFocus:!0}):e.jsx("div",{className:"p-3 bg-white rounded-lg border border-gray-200 min-h-[52px] flex items-center",children:e.jsx("span",{className:t.cantidadFacturas?"text-gray-900 font-medium":"text-gray-500 italic",children:t.cantidadFacturas?t.cantidadFacturas.toLocaleString("es-CO"):"Sin especificar"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4"}),"Cantidad de Medidores"]}),e.jsx("button",{onClick:()=>g(u==="cantidadMedidores"?null:"cantidadMedidores"),className:"text-green-600 hover:text-green-800 transition-colors p-1 hover:bg-green-100 rounded",children:e.jsx(ge,{className:"w-4 h-4"})})]}),u==="cantidadMedidores"?e.jsx("input",{type:"number",value:t.cantidadMedidores||"",onChange:p=>i(l.empresa,l.mes,"cantidadMedidores",p.target.value?parseInt(p.target.value):null),onBlur:()=>g(null),placeholder:"N√∫mero de medidores reportados",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white",autoFocus:!0}):e.jsx("div",{className:"p-3 bg-white rounded-lg border border-gray-200 min-h-[52px] flex items-center",children:e.jsx("span",{className:t.cantidadMedidores?"text-gray-900 font-medium":"text-gray-500 italic",children:t.cantidadMedidores?t.cantidadMedidores.toLocaleString("es-CO"):"Sin especificar"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4"}),"Cantidad de Excluidos"]}),e.jsx("button",{onClick:()=>g(u==="cantidadExcluidos"?null:"cantidadExcluidos"),className:"text-green-600 hover:text-green-800 transition-colors p-1 hover:bg-green-100 rounded",children:e.jsx(ge,{className:"w-4 h-4"})})]}),u==="cantidadExcluidos"?e.jsx("input",{type:"number",value:t.cantidadExcluidos||"",onChange:p=>i(l.empresa,l.mes,"cantidadExcluidos",p.target.value?parseInt(p.target.value):null),onBlur:()=>g(null),placeholder:"N√∫mero de medidores excluidos",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white",autoFocus:!0}):e.jsx("div",{className:"p-3 bg-white rounded-lg border border-gray-200 min-h-[52px] flex items-center",children:e.jsx("span",{className:t.cantidadExcluidos?"text-gray-900 font-medium":"text-gray-500 italic",children:t.cantidadExcluidos?t.cantidadExcluidos.toLocaleString("es-CO"):"Sin especificar"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Valor FT01 (Consumos kWh)"]}),e.jsx("button",{onClick:()=>g(u==="valorFT01"?null:"valorFT01"),className:"text-green-600 hover:text-green-800 transition-colors p-1 hover:bg-green-100 rounded",children:e.jsx(ge,{className:"w-4 h-4"})})]}),u==="valorFT01"?e.jsx("input",{type:"text",value:t.valorFT01?Re(t.valorFT01):"",onChange:p=>{const f=Ze(p.target.value);i(l.empresa,l.mes,"valorFT01",f)},onBlur:()=>g(null),placeholder:"Valor en pesos (ej: 1.234.567)",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white",autoFocus:!0}):e.jsx("div",{className:"p-3 bg-white rounded-lg border border-gray-200 min-h-[52px] flex items-center",children:e.jsx("span",{className:t.valorFT01?"text-gray-900 font-medium":"text-gray-500 italic",children:t.valorFT01?`$${Re(t.valorFT01)}`:"Sin especificar"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Valor FT03 (Recaudado)"]}),e.jsx("button",{onClick:()=>g(u==="valorFT03"?null:"valorFT03"),className:"text-green-600 hover:text-green-800 transition-colors p-1 hover:bg-green-100 rounded",children:e.jsx(ge,{className:"w-4 h-4"})})]}),u==="valorFT03"?e.jsx("input",{type:"text",value:t.valorFT03?Re(t.valorFT03):"",onChange:p=>{const f=Ze(p.target.value);i(l.empresa,l.mes,"valorFT03",f)},onBlur:()=>g(null),placeholder:"Valor en pesos (ej: 1.234.567)",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white",autoFocus:!0}):e.jsx("div",{className:"p-3 bg-white rounded-lg border border-gray-200 min-h-[52px] flex items-center",children:e.jsx("span",{className:t.valorFT03?"text-gray-900 font-medium":"text-gray-500 italic",children:t.valorFT03?`$${Re(t.valorFT03)}`:"Sin especificar"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Valor FT06 (Medidores Excluidos)"]}),e.jsx("button",{onClick:()=>g(u==="valorFT06"?null:"valorFT06"),className:"text-green-600 hover:text-green-800 transition-colors p-1 hover:bg-green-100 rounded",children:e.jsx(ge,{className:"w-4 h-4"})})]}),u==="valorFT06"?e.jsx("input",{type:"text",value:t.valorFT06?Re(t.valorFT06):"",onChange:p=>{const f=Ze(p.target.value);i(l.empresa,l.mes,"valorFT06",f)},onBlur:()=>g(null),placeholder:"Valor en pesos (ej: 1.234.567)",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white",autoFocus:!0}):e.jsx("div",{className:"p-3 bg-white rounded-lg border border-gray-200 min-h-[52px] flex items-center",children:e.jsx("span",{className:t.valorFT06?"text-gray-900 font-medium":"text-gray-500 italic",children:t.valorFT06?`$${Re(t.valorFT06)}`:"Sin especificar"})})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-green-100 rounded-lg",children:[e.jsxs("div",{className:"text-xs text-green-800",children:[e.jsx("strong",{children:"Informaci√≥n de Facturaci√≥n:"})," Complete estos campos cuando tenga datos disponibles."]}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"Los valores monetarios se formatean autom√°ticamente con separador de miles."})]})]})})]}),e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:e.jsx("span",{children:"√öltima modificaci√≥n autom√°tica guardada"})}),e.jsxs("button",{onClick:a,className:"bg-blue-600 text-white py-2 px-6 rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),"Cerrar"]})]})})]})})}function Oa({isOpen:l,onClose:t,config:s,onUpdateConfig:r}){if(!l)return null;const n=()=>{t(),console.log("Azure DevOps configuration saved")};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ot,{className:"w-5 h-5 text-purple-600"}),"Configuraci√≥n Azure DevOps"]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(se,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Organizaci√≥n"}),e.jsx("input",{type:"text",value:s.organization,onChange:a=>r({...s,organization:a.target.value}),placeholder:"nombre-organizacion",className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Proyecto"}),e.jsx("input",{type:"text",value:s.project,onChange:a=>r({...s,project:a.target.value}),placeholder:"nombre-proyecto",className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Personal Access Token (PAT)"}),e.jsx("input",{type:"password",value:s.pat,onChange:a=>r({...s,pat:a.target.value}),placeholder:"tu-personal-access-token",className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Necesita permisos: Work Items (Read) + Work Items (Write para crear nuevos)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"enableAzure",checked:s.enabled,onChange:a=>r({...s,enabled:a.target.checked}),className:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"}),e.jsx("label",{htmlFor:"enableAzure",className:"text-sm font-medium text-gray-700",children:"Habilitar sincronizaci√≥n autom√°tica"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"Sincronizaci√≥n:"}),e.jsxs("div",{className:"text-xs text-blue-700 space-y-1",children:[e.jsxs("div",{children:["‚Ä¢ ",e.jsx("strong",{children:"Estados:"})," Solo lectura desde Azure DevOps"]}),e.jsxs("div",{children:["‚Ä¢ ",e.jsx("strong",{children:"Work Items:"})," Se crean autom√°ticamente"]}),e.jsxs("div",{children:["‚Ä¢ ",e.jsx("strong",{children:"Mapeo:"})," New‚ÜíSin Solicitud, Active‚ÜíEn Progreso, Resolved‚ÜíCon Impedimento, Closed‚ÜíTerminado"]})]})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx("button",{onClick:t,className:"flex-1 bg-gray-100 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-200 transition-colors font-medium",children:"Cancelar"}),e.jsx("button",{onClick:n,className:"flex-1 bg-purple-600 text-white py-2 px-4 rounded-lg hover:bg-purple-700 transition-colors font-medium",children:"Guardar"})]})]})})})}function $a({isOpen:l,onClose:t,billingData:s,selectedEntity:r,selectedYear:n,azureConfig:a,onCreateRequest:i}){const[o,c]=x.useState(""),[m,u]=x.useState([]),[g,d]=x.useState(""),[h,y]=x.useState(""),[C,p]=x.useState(!1),[f,j]=x.useState([]),_=Object.keys(s);x.useEffect(()=>{l&&(c(""),u([]),d(""),y(""),j([]))},[l]);const R=D=>{u(w=>w.includes(D)?w.filter(A=>A!==D):[...w,D])},E=()=>{const D=[];if(o||D.push("Debe seleccionar una empresa de energ√≠a"),m.length===0&&D.push("Debe seleccionar al menos un mes"),o&&m.length>0){const w=m.filter(A=>{const T=s[o]?.[A];return T&&T.estado!=="Sin Solicitud"});w.length>0&&D.push(`Los siguientes meses ya tienen solicitudes: ${w.join(", ")}`)}return j(D),D.length===0},v=async()=>{if(E()){p(!0);try{await i(o,m,g,h),t()}catch(D){console.error("Error creating request:",D),j(["Error al crear la solicitud. Por favor, int√©ntalo nuevamente."])}finally{p(!1)}}},b=D=>{if(!o)return"available";const w=s[o]?.[D];return!w||w.estado==="Sin Solicitud"?"available":w.estado},S=D=>{switch(D){case"available":return"bg-green-100 text-green-800 border-green-200";case"New":return"bg-blue-100 text-blue-800 border-blue-200";case"Refinement":return"bg-purple-100 text-purple-800 border-purple-200";case"Ready":return"bg-green-100 text-green-800 border-green-200";case"Active":return"bg-blue-100 text-blue-800 border-blue-200";case"QA Certification":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"Gestion Tributaria":return"bg-orange-100 text-orange-800 border-orange-200";case"Impediment":return"bg-red-100 text-red-800 border-red-200";case"Paused":return"bg-gray-100 text-gray-800 border-gray-200";case"Peer Review":return"bg-indigo-100 text-indigo-800 border-indigo-200";case"Third Party":return"bg-pink-100 text-pink-800 border-pink-200";case"Staging":return"bg-cyan-100 text-cyan-800 border-cyan-200";case"Production":return"bg-green-100 text-green-800 border-green-200";case"Closed":return"bg-gray-100 text-gray-800 border-gray-200";case"Removed":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-600 border-gray-200"}};return l?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:e.jsx(rt,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Nueva Solicitud de Facturaci√≥n"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r," - ",n]})]})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 p-1",children:e.jsx(se,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[f.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(ne,{className:"w-5 h-5 text-red-600"}),e.jsx("h3",{className:"font-medium text-red-800",children:"Errores de validaci√≥n"})]}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-red-700",children:f.map((D,w)=>e.jsx("li",{children:D},w))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-5 h-5 text-gray-600"}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Empresa de Energ√≠a"})]}),e.jsxs("select",{value:o,onChange:D=>c(D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Seleccionar empresa..."}),_.map(D=>e.jsx("option",{value:D,children:D},D))]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{className:"w-5 h-5 text-gray-600"}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Meses a solicitar"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:U.map(D=>{const w=b(D),A=w==="available",T=m.includes(D);return e.jsxs("button",{onClick:()=>A&&R(D),disabled:!A,className:`
                      p-3 rounded-md border text-sm font-medium transition-all
                      ${T?"bg-blue-600 text-white border-blue-600":A?"bg-white text-gray-700 border-gray-300 hover:bg-gray-50":`${S(w)} cursor-not-allowed opacity-60`}
                    `,children:[e.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[e.jsx("span",{children:D}),T&&e.jsx(we,{className:"w-4 h-4"})]}),!A&&e.jsx("div",{className:"text-xs mt-1 opacity-75",children:w})]},D)})}),e.jsx("p",{className:"text-sm text-gray-600",children:"Selecciona los meses para los cuales quieres crear solicitudes. Los meses en gris ya tienen solicitudes existentes."})]}),a.organization&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ve,{className:"w-5 h-5 text-gray-600"}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"ID del Work Item en Azure DevOps (opcional)"})]}),e.jsx("input",{type:"text",value:h,onChange:D=>y(D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Ej: 12345"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Si ya tienes un work item en Azure DevOps relacionado con esta solicitud, ingresa su ID aqu√≠."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ke,{className:"w-5 h-5 text-gray-600"}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Notas (opcional)"})]}),e.jsx("textarea",{value:g,onChange:D=>d(D.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Agregar notas sobre la solicitud..."})]}),a.organization&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Integraci√≥n con Azure DevOps"})]}),e.jsx("p",{className:"text-sm text-blue-700",children:h?`Se asociar√° el work item #${h} con todas las solicitudes creadas. El estado actual del work item se sincronizar√° autom√°ticamente.`:"Las solicitudes se crear√°n sin work item asociado. Puedes agregar uno m√°s tarde."})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t bg-gray-50",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"Cancelar"}),e.jsx("button",{onClick:v,disabled:C||!o||m.length===0,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Creando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(rt,{className:"w-4 h-4"}),e.jsx("span",{children:"Crear Solicitud"})]})})]})]})}):null}function Fa({isOpen:l,onClose:t,azureConfig:s,filteredCompanies:r,selectedYear:n,onSync:a}){const[i,o]=x.useState("config"),[c,m]=x.useState(!1),[u,g]=x.useState(!0),[d,h]=x.useState([]),[y,C]=x.useState({current:0,total:0,currentItem:""}),[p,f]=x.useState(!1);if(!l)return null;const j=async()=>{o("syncing"),C({current:0,total:0,currentItem:"Iniciando sincronizaci√≥n..."});const b={allYears:c,allCompanies:u,companies:u?[]:r,years:c?[2017,2018,2019,2020,2021,2022,2023,2024,2025]:[n]};try{const S=await a(b);h(S),o("results")}catch(S){console.error("Sync failed:",S),o("config")}},_=()=>{const b=R();navigator.clipboard.writeText(b).then(()=>{f(!0),setTimeout(()=>f(!1),2e3)})},R=()=>{const b=d.filter(A=>A.success&&!A.noChanges),S=d.filter(A=>A.noChanges),D=d.filter(A=>!A.success);let w=`=== RESUMEN DE SINCRONIZACI√ìN AZURE DEVOPS ===

`;return w+=`Fecha: ${new Date().toLocaleString("es-ES")}
`,w+=`Alcance: ${c?"Todos los a√±os":`A√±o ${n}`} | ${u?"Todos los clientes":"Clientes filtrados"}

`,w+=`üìä ESTAD√çSTICAS:
`,w+=`‚úÖ Actualizados: ${b.length}
`,w+=`‚ûñ Sin cambios: ${S.length}
`,w+=`‚ùå Errores: ${D.length}

`,b.length>0&&(w+=`üìã CAMBIOS REALIZADOS:
`,b.forEach(A=>{w+=`${A.company} - ${A.month}: "${A.oldState}" ‚Üí "${A.newState}"
`}),w+=`
`),D.length>0&&(w+=`‚ö†Ô∏è ERRORES:
`,D.forEach(A=>{w+=`${A.company} - ${A.month}: ${A.error}
`})),w},E=()=>({updated:d.filter(b=>b.success&&!b.noChanges).length,noChanges:d.filter(b=>b.noChanges).length,errors:d.filter(b=>!b.success).length}),v=()=>{o("config"),h([]),C({current:0,total:0,currentItem:""}),f(!1),t()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx($e,{className:"w-5 h-5 text-blue-600"}),"Sincronizaci√≥n con Azure DevOps"]}),e.jsx("button",{onClick:v,disabled:i==="syncing",className:"text-gray-400 hover:text-gray-600 transition-colors disabled:opacity-50",children:e.jsx(se,{className:"w-5 h-5"})})]}),i==="config"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"¬øQu√© har√° esta sincronizaci√≥n?"}),e.jsx("p",{className:"text-blue-800 text-sm",children:"Esta opci√≥n actualizar√° los estados de las solicitudes desde Azure DevOps para los clientes y a√±os seleccionados. Se sincronizar√°n los estados, fechas de recibido y fechas de cierre de todos los work items configurados."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Alcance Temporal"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:!c,onChange:()=>m(!1),className:"text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-700",children:"Solo a√±o actual"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Sincronizar √∫nicamente ",n]})]})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:c,onChange:()=>m(!0),className:"text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-700",children:"Todos los a√±os"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Sincronizar desde 2017 hasta 2025"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Alcance de Clientes"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:u,onChange:()=>g(!0),className:"text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-700",children:"Todos los clientes"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Sincronizar todas las empresas"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:!u,onChange:()=>g(!1),className:"text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-700",children:"Solo clientes filtrados"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Sincronizar √∫nicamente los ",r.length," clientes actualmente visibles"]})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{onClick:v,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cancelar"}),e.jsxs("button",{onClick:j,disabled:!s.enabled,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx($e,{className:"w-4 h-4"}),"Iniciar Sincronizaci√≥n"]})]})]}),i==="syncing"&&e.jsxs("div",{className:"text-center py-12 space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx($e,{className:"w-12 h-12 text-blue-600 animate-spin"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Sincronizando con Azure DevOps..."}),e.jsx("p",{className:"text-gray-600 mb-4",children:y.currentItem}),y.total>0&&e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-500 mb-1",children:[e.jsx("span",{children:"Progreso"}),e.jsxs("span",{children:[y.current," de ",y.total]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${y.current/y.total*100}%`}})})]})]})]}),i==="results"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-3 gap-4",children:(()=>{const b=E();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[e.jsx(te,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-green-800",children:b.updated}),e.jsx("div",{className:"text-sm text-green-700",children:"Actualizados"})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center",children:[e.jsx(me,{className:"w-8 h-8 text-gray-600 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:b.noChanges}),e.jsx("div",{className:"text-sm text-gray-700",children:"Sin cambios"})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-center",children:[e.jsx(nt,{className:"w-8 h-8 text-red-600 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-red-800",children:b.errors}),e.jsx("div",{className:"text-sm text-red-700",children:"Errores"})]})]})})()}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 max-h-96 overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Detalle de Sincronizaci√≥n"}),e.jsxs("button",{onClick:_,className:"flex items-center gap-2 text-sm text-blue-600 hover:text-blue-700 transition-colors",children:[e.jsx(Vs,{className:"w-4 h-4"}),p?"¬°Copiado!":"Copiar al portapapeles"]})]}),e.jsx("div",{className:"space-y-2",children:d.map((b,S)=>e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg ${b.success?b.noChanges?"bg-gray-50 border border-gray-200":"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[e.jsx("div",{className:"flex-shrink-0",children:b.success?b.noChanges?e.jsx(me,{className:"w-5 h-5 text-gray-600"}):e.jsx(te,{className:"w-5 h-5 text-green-600"}):e.jsx(nt,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:b.company}),e.jsx("span",{className:"text-gray-500",children:"‚Äî"}),e.jsx("span",{className:"font-medium",children:b.month})]}),b.success?b.noChanges?e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Sin cambios detectados"}):e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:['"',b.oldState,'" ‚Üí "',b.newState,'"']}):e.jsx("div",{className:"text-sm text-red-700 mt-1",children:b.error})]})]},S))})]}),e.jsx("div",{className:"flex justify-end gap-3 pt-4 border-t",children:e.jsx("button",{onClick:v,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Cerrar"})})]})]})})})}function Va({isOpen:l,onClose:t,companyName:s,currentMetadata:r,existingCompanies:n,isNewCompany:a=!1,onSave:i}){const[o,c]=x.useState(s),[m,u]=x.useState(null),[g,d]=x.useState(!1),[h,y]=x.useState(null),[C,p]=x.useState(null),[f,j]=x.useState(null),[_,R]=x.useState(!1),[E,v]=x.useState(!1),[b,S]=x.useState(!1),[D,w]=x.useState(null);x.useEffect(()=>{l&&(c(s),w(null),r?(u(r.usuariosCount),d(r.esIncumbente),y(r.tipoEmpresa),p(r.email||null),j(r.nit||null),R(r.esAutoconsumidora||!1),v(r.esOperadorRed||!1),S(r.recauda||!1)):(u(null),d(!1),y(null),p(null),j(null),R(!1),v(!1),S(!1)))},[r,l,s]);const A=k=>k.trim()?k.trim()!==s&&n.includes(k.trim())?"Ya existe una empresa con este nombre":null:"El nombre de la empresa es requerido",T=k=>{c(k),w(A(k))},M=()=>{const k=o.trim(),L=A(k);if(L){w(L);return}i({usuariosCount:m,esIncumbente:g,tipoEmpresa:h,email:C,nit:f,esAutoconsumidora:_,esOperadorRed:E,recauda:b},k!==s?k:void 0),t()},z=k=>{const L=parseInt(k);u(isNaN(L)?null:L)};return l?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-blue-600"}),a?"Nueva Empresa":"Informaci√≥n de Empresa"]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:e.jsx(se,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre de la Empresa"}),e.jsx("input",{type:"text",value:o,onChange:k=>T(k.target.value),placeholder:"Ingrese el nombre de la empresa",className:`w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${D?"border-red-500":"border-gray-300"}`}),D&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:D})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(ze,{className:"w-4 h-4 inline mr-1"}),"Cantidad de Usuarios"]}),e.jsx("input",{type:"number",value:m||"",onChange:k=>z(k.target.value),placeholder:"Ingrese el n√∫mero de usuarios",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(qe,{className:"w-4 h-4 inline mr-1"}),"Tipo de Empresa"]}),e.jsxs("select",{value:h||"",onChange:k=>y(k.target.value||null),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Seleccione un tipo"}),e.jsx("option",{value:"Generadora",children:"Generadora"}),e.jsx("option",{value:"Comercializadora",children:"Comercializadora"}),e.jsx("option",{value:"Ambas",children:"Ambas"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(zs,{className:"w-4 h-4 inline mr-1"}),"Email de la Empresa"]}),e.jsx("input",{type:"email",value:C||"",onChange:k=>p(k.target.value||null),placeholder:"ejemplo@empresa.com",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(ke,{className:"w-4 h-4 inline mr-1"}),"NIT (incluye d√≠gito de verificaci√≥n)"]}),e.jsx("input",{type:"text",value:f||"",onChange:k=>j(k.target.value||null),placeholder:"900123456-7",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:k=>d(k.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx(He,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Es empresa incumbente del municipio"})]})}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Propiedades Adicionales"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:k=>R(k.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx(qe,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Es Autoconsumidora"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:E,onChange:k=>v(k.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx(Bs,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Es Operador de Red"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:k=>S(k.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx(Oe,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Recauda"})]})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:t,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:M,disabled:!!D||!o.trim(),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:a?"Crear Empresa":"Guardar"})]})]})}):null}class Ke{static getEntityFolder(t){return{"Alcald√≠a de Palmira":"alcaldia-palmira","Alcald√≠a de Tulu√°":"alcaldia-tulua","Gobernaci√≥n del Valle del Cauca":"gobernacion-valle",Infibagu√©:"infibague"}[t]||""}static async loadCompaniesForYear(t,s){try{const r=this.getEntityFolder(t);if(!r)throw new Error(`Entidad no encontrada: ${t}`);const a=(await Be(Object.assign({"../data/alcaldia-palmira/2017.json":()=>N(()=>import("./2017-BVOP-Wl2.js"),[]),"../data/alcaldia-palmira/2018.json":()=>N(()=>import("./2018-DZ1DG_5X.js"),[]),"../data/alcaldia-palmira/2019.json":()=>N(()=>import("./2019-CsKsMAR0.js"),[]),"../data/alcaldia-palmira/2020.json":()=>N(()=>import("./2020-BRZ26RQl.js"),[]),"../data/alcaldia-palmira/2021.json":()=>N(()=>import("./2021-DVztz28N.js"),[]),"../data/alcaldia-palmira/2022.json":()=>N(()=>import("./2022-C7X1vzRC.js"),[]),"../data/alcaldia-palmira/2023.json":()=>N(()=>import("./2023-3iXhSLrf.js"),[]),"../data/alcaldia-palmira/2024.json":()=>N(()=>import("./2024-C1DwArZ3.js"),[]),"../data/alcaldia-palmira/2025.json":()=>N(()=>import("./2025-ChyOB8kX.js"),[]),"../data/alcaldia-tulua/2017.json":()=>N(()=>import("./2017-BECROcFg.js"),[]),"../data/alcaldia-tulua/2018.json":()=>N(()=>import("./2018-0eCO8QOx.js"),[]),"../data/alcaldia-tulua/2019.json":()=>N(()=>import("./2019-C49KecLc.js"),[]),"../data/alcaldia-tulua/2020.json":()=>N(()=>import("./2020-DMf6FYnd.js"),[]),"../data/alcaldia-tulua/2021.json":()=>N(()=>import("./2021-DvqTzZPh.js"),[]),"../data/alcaldia-tulua/2022.json":()=>N(()=>import("./2022-CIvs88wj.js"),[]),"../data/alcaldia-tulua/2023.json":()=>N(()=>import("./2023-BeRqBxTJ.js"),[]),"../data/alcaldia-tulua/2024.json":()=>N(()=>import("./2024-V3Ks7LuK.js"),[]),"../data/alcaldia-tulua/2025.json":()=>N(()=>import("./2025-BlBWJeCc.js"),[]),"../data/gobernacion-valle/2017.json":()=>N(()=>import("./2017-RHIzOR10.js"),[]),"../data/gobernacion-valle/2018.json":()=>N(()=>import("./2018-DAcL6WxD.js"),[]),"../data/gobernacion-valle/2019.json":()=>N(()=>import("./2019-KKyEHg-1.js"),[]),"../data/gobernacion-valle/2020.json":()=>N(()=>import("./2020-DLSyYBua.js"),[]),"../data/gobernacion-valle/2021.json":()=>N(()=>import("./2021-CTNt0CSD.js"),[]),"../data/gobernacion-valle/2022.json":()=>N(()=>import("./2022-CO3HVyE6.js"),[]),"../data/gobernacion-valle/2023.json":()=>N(()=>import("./2023-DpQun6Of.js"),[]),"../data/gobernacion-valle/2024.json":()=>N(()=>import("./2024-C85h5RGw.js"),[]),"../data/gobernacion-valle/2025.json":()=>N(()=>import("./2025-HUFIYlkh.js"),[]),"../data/infibague/2021.json":()=>N(()=>import("./2021-B9Xfz2lF.js"),[]),"../data/infibague/2022.json":()=>N(()=>import("./2022-D-GZ4eF1.js"),[]),"../data/infibague/2023.json":()=>N(()=>import("./2023-DyQgsWQS.js"),[]),"../data/infibague/2024.json":()=>N(()=>import("./2024-DLtBQgoW.js"),[]),"../data/infibague/2025.json":()=>N(()=>import("./2025-Ad051HOY.js"),[])}),`../data/${r}/${s}.json`,4)).default;return Object.keys(a)}catch(r){return console.warn(`Error loading companies for ${t} ${s}:`,r),[]}}static async generateComparisonData(t){const{entity:s,years:r}=t,n={};for(const c of r)n[c]=await this.loadCompaniesForYear(s,c);const a=new Set;Object.values(n).forEach(c=>{c.forEach(m=>a.add(m))});const i=Array.from(a).sort().map(c=>{const m={name:c};return r.forEach(u=>{m[u.toString()]=n[u].includes(c)}),m}),o={};return r.forEach(c=>{o[c.toString()]=n[c].length}),{entity:s,years:r,companies:i,summary:o}}static exportToJSON(t){const s=JSON.stringify(t,null,2),r=new Blob([s],{type:"application/json"}),n=URL.createObjectURL(r),a=document.createElement("a");a.href=n,a.download=`comparativa-empresas-${t.entity.replace(/\s+/g,"-").toLowerCase()}-${t.years.join("-")}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}static exportToCSV(t){const r=[["Empresa",...t.years.map(m=>m.toString())].join(",")];t.companies.forEach(m=>{const u=[`"${m.name}"`,...t.years.map(g=>m[g.toString()]?"S√≠":"No")];r.push(u.join(","))}),r.push(""),r.push("RESUMEN");const n=["Total de empresas",...t.years.map(m=>t.summary[m.toString()].toString())];r.push(n.join(","));const a=r.join(`
`),i=new Blob([a],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(i),c=document.createElement("a");c.href=o,c.download=`comparativa-empresas-${t.entity.replace(/\s+/g,"-").toLowerCase()}-${t.years.join("-")}.csv`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(o)}}function za({isOpen:l,onClose:t,defaultEntity:s="Alcald√≠a de Palmira"}){const[r,n]=x.useState({entity:s,years:[2024,2025]}),[a,i]=x.useState(null),[o,c]=x.useState(!1),[m,u]=x.useState(null),g=[2017,2018,2019,2020,2021,2022,2023,2024,2025],d=p=>{n(f=>({...f,years:f.years.includes(p)?f.years.filter(j=>j!==p):[...f.years,p].sort()}))},h=async()=>{if(r.years.length<2){u("Selecciona al menos 2 a√±os para comparar");return}c(!0),u(null);try{const p=await Ke.generateComparisonData(r);i(p)}catch(p){u(p instanceof Error?p.message:"Error al generar comparaci√≥n")}finally{c(!1)}},y=()=>{a&&Ke.exportToJSON(a)},C=()=>{a&&Ke.exportToCSV(a)};return x.useEffect(()=>{l&&!a&&h()},[l]),l?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-blue-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(lt,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Comparativa de Empresas"})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white/50 rounded-lg transition-colors",children:e.jsx(se,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(H,{className:"w-4 h-4"}),"Entidad"]}),e.jsx("select",{value:r.entity,onChange:p=>n(f=>({...f,entity:p.target.value})),className:"w-full p-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:ce.map(p=>e.jsx("option",{value:p,children:p},p))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(q,{className:"w-4 h-4"}),"A√±os a Comparar"]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:g.map(p=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:r.years.includes(p),onChange:()=>d(p),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium",children:p})]},p))})]})]}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("button",{onClick:h,disabled:o||r.years.length<2,className:"flex items-center gap-2 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:[o?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(lt,{className:"w-4 h-4"}),o?"Generando...":"Generar Comparaci√≥n"]})}),m&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-600 text-sm",children:m})}),a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Resumen"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:a.years.map(p=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:a.summary[p.toString()]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Empresas en ",p]})]},p))})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 justify-center",children:[e.jsxs("button",{onClick:y,className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(ke,{className:"w-4 h-4"}),"Exportar JSON"]}),e.jsxs("button",{onClick:C,className:"flex items-center gap-2 bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors",children:[e.jsx(gt,{className:"w-4 h-4"}),"Exportar CSV"]})]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border-r",children:"Empresa"}),a.years.map(p=>e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-700 border-r last:border-r-0",children:p},p))]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:a.companies.map((p,f)=>e.jsxs("tr",{className:f%2===0?"bg-white":"bg-gray-50/50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 border-r font-medium",children:p.name}),a.years.map(j=>e.jsx("td",{className:"px-4 py-3 text-center border-r last:border-r-0",children:p[j.toString()]?e.jsx(te,{className:"w-5 h-5 text-green-600 mx-auto"}):e.jsx(nt,{className:"w-5 h-5 text-red-400 mx-auto"})},j))]},p.name))})]})})})]})]}),e.jsx("div",{className:"border-t bg-gray-50 px-6 py-4",children:e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cerrar"})})})]})}):null}function Ba({isOpen:l,onClose:t,onImport:s,selectedEntity:r,selectedYear:n}){const[a,i]=x.useState(""),[o,c]=x.useState(!1),[m,u]=x.useState(null),g=async()=>{if(a.trim()){c(!0),u(null);try{const y=await s(a.trim());u(y)}catch(y){u({total:0,imported:[],skipped:[],errors:[{company:"",month:"",status:"error",message:y instanceof Error?y.message:"Error desconocido al procesar"}]})}finally{c(!1)}}},d=()=>{i(""),u(null),t()},h=(y,C)=>{const p=()=>{switch(y.status){case"success":return e.jsx(te,{className:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"});case"skipped":return e.jsx(me,{className:"w-4 h-4 text-yellow-600 flex-shrink-0 mt-0.5"});case"error":return e.jsx(ne,{className:"w-4 h-4 text-red-600 flex-shrink-0 mt-0.5"})}},f=()=>{switch(y.status){case"success":return"bg-green-50 border-green-200";case"skipped":return"bg-yellow-50 border-yellow-200";case"error":return"bg-red-50 border-red-200"}};return e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg border ${f()}`,children:[p(),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[y.company&&e.jsx("span",{className:"text-gray-900",children:y.company}),y.month&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"-"}),e.jsx("span",{className:"text-gray-700",children:y.month})]}),y.workItemId&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"-"}),e.jsxs("span",{className:"text-blue-600",children:["#",y.workItemId]})]})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:y.message})]})]},C)};return l?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-blue-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(it,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Importar Datos"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Contexto actual: ",r," - ",n]}),e.jsx("p",{className:"text-xs text-blue-600",children:"‚ú® Soporte multi-a√±o: Puede importar datos de cualquier a√±o y entidad"})]})]}),e.jsx("button",{onClick:d,className:"p-2 hover:bg-white/50 rounded-lg transition-colors",children:e.jsx(se,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"JSON de Importaci√≥n"}),e.jsx("textarea",{value:a,onChange:y=>i(y.target.value),placeholder:'{\\n  "EMGESA S.A. E.S.P.": {\\n    "Enero": {\\n      "entidad": "Alcald√≠a de Tulu√°",\\n      "workItemId": 26373,\\n      "anio": 2024\\n    }\\n  }\\n}',className:"w-full h-40 p-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm",disabled:o}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 space-y-1",children:[e.jsx("p",{children:"Pega aqu√≠ el JSON con los datos a importar. Se validar√° cada empresa y Work Item con Azure DevOps."}),e.jsx("p",{className:"text-blue-600",children:"üí° Los datos se guardar√°n autom√°ticamente en el archivo correspondiente seg√∫n el a√±o y entidad de cada registro."}),e.jsx("p",{className:"text-green-600",children:'üìù Ejemplo: Los registros con "anio": 2018 se guardar√°n en el archivo de 2018, independiente del a√±o actual.'})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:g,disabled:!a.trim()||o,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Procesando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(it,{className:"w-4 h-4"}),"Importar"]})}),a.trim()&&e.jsx("button",{onClick:()=>i(""),disabled:o,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors disabled:opacity-50",children:"Limpiar"})]})]}),m&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:m.total}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Procesados"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:m.imported.length}),e.jsx("div",{className:"text-sm text-green-700",children:"Importados"})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:m.skipped.length}),e.jsx("div",{className:"text-sm text-yellow-700",children:"Ya Exist√≠an"})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:m.errors.length}),e.jsx("div",{className:"text-sm text-red-700",children:"Errores"})]})]}),e.jsxs("div",{className:"space-y-4",children:[m.imported.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 text-lg font-semibold text-green-700 mb-3",children:[e.jsx(te,{className:"w-5 h-5"}),"Importados Exitosamente (",m.imported.length,")"]}),e.jsx("div",{className:"space-y-2",children:m.imported.map((y,C)=>h(y,C))})]}),m.skipped.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 text-lg font-semibold text-yellow-700 mb-3",children:[e.jsx(me,{className:"w-5 h-5"}),"Ya Exist√≠an (",m.skipped.length,")"]}),e.jsx("div",{className:"space-y-2",children:m.skipped.map((y,C)=>h(y,C))})]}),m.errors.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 text-lg font-semibold text-red-700 mb-3",children:[e.jsx(ne,{className:"w-5 h-5"}),"Errores (",m.errors.length,")"]}),e.jsx("div",{className:"space-y-2",children:m.errors.map((y,C)=>h(y,C))})]})]})]})]}),e.jsx("div",{className:"border-t bg-gray-50 px-6 py-4",children:e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:d,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cerrar"})})})]})}):null}const Ya=[2017,2018,2019,2020,2021,2022,2023,2024,2025];function Ua({isOpen:l,onClose:t,selectedEntity:s,onValidate:r,onConfirmCreation:n}){const[a,i]=x.useState("configure"),[o,c]=x.useState(""),[m,u]=x.useState([]),[g,d]=x.useState(null),[h,y]=x.useState(!1),[C,p]=x.useState(null),[f,j]=x.useState(!1),[_,R]=x.useState(null),[E,v]=x.useState(null),[b,S]=x.useState(!1);x.useEffect(()=>{l&&(i("configure"),c(""),u([]),d(null),y(!1),p(null),R(null),v(null),j(!1),S(!1))},[l]);const D=I=>I.trim()?I.trim().length<3?"El nombre debe tener al menos 3 caracteres":null:"El nombre de la empresa es requerido",w=I=>{c(I),v(D(I))},A=I=>{u(V=>V.includes(I)?V.filter(Z=>Z!==I):[...V,I].sort())},T=I=>{const V=parseInt(I);d(isNaN(V)?null:V)},M=()=>o.trim()&&m.length>0&&!E,z=async()=>{if(M()){j(!0);try{const I={usuariosCount:g,esIncumbente:h,tipoEmpresa:C,email:null,nit:null,esAutoconsumidora:!1,esOperadorRed:!1,recauda:!1},V=await r(o.trim(),m,I);R(V),i("preview")}catch(I){console.error("Error during validation:",I),alert("Error al validar la empresa. Por favor, int√©ntalo nuevamente.")}finally{j(!1)}}},k=async()=>{if(_){S(!0);try{await n(_,{usuariosCount:g,esIncumbente:h,tipoEmpresa:C,email:null,nit:null,esAutoconsumidora:!1,esOperadorRed:!1,recauda:!1}),i("completed")}catch(I){console.error("Error during company creation:",I),alert("Error al crear la empresa. Por favor, int√©ntalo nuevamente.")}finally{S(!1)}}},L=()=>{i("configure"),R(null)},F=()=>{i("configure"),R(null),t()};return l?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-blue-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:[a==="configure"&&"Nueva Empresa Multi-A√±o",a==="preview"&&"Previsualizaci√≥n de Cambios",a==="completed"&&"Empresa Creada Exitosamente"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a==="configure"&&`Entidad: ${s}`,a==="preview"&&"Revisa los cambios antes de confirmar",a==="completed"&&"La empresa ha sido creada en los a√±os seleccionados"]})]})]}),e.jsx("button",{onClick:F,className:"p-2 hover:bg-white/50 rounded-lg transition-colors",children:e.jsx(se,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[a==="configure"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre de la Empresa *"}),e.jsx("input",{type:"text",value:o,onChange:I=>w(I.target.value),placeholder:"Ej: EMGESA S.A. E.S.P.",className:`w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${E?"border-red-500":"border-gray-300"}`}),E&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:E})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(q,{className:"w-4 h-4 inline mr-1"}),"A√±os en los que crear la empresa *"]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Ya.map(I=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:m.includes(I),onChange:()=>A(I),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium",children:I})]},I))}),m.length===0&&e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Selecciona al menos un a√±o"}),m.length>0&&e.jsxs("p",{className:"text-blue-600 text-sm mt-1",children:["Seleccionados: ",m.join(", ")," (",m.length," a√±os)"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(ze,{className:"w-4 h-4 inline mr-1"}),"Cantidad de Usuarios"]}),e.jsx("input",{type:"number",value:g||"",onChange:I=>T(I.target.value),placeholder:"Opcional",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(qe,{className:"w-4 h-4 inline mr-1"}),"Tipo de Empresa"]}),e.jsxs("select",{value:C||"",onChange:I=>p(I.target.value||null),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Seleccione un tipo"}),e.jsx("option",{value:"Generadora",children:"Generadora"}),e.jsx("option",{value:"Comercializadora",children:"Comercializadora"}),e.jsx("option",{value:"Ambas",children:"Ambas"})]})]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:I=>y(I.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx(He,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Es empresa incumbente del municipio"})]})})]}),a==="preview"&&_&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"Resumen de Cambios"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:_.successYears.length}),e.jsx("div",{className:"text-green-700",children:"Se crear√°n"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:_.skippedYears.length}),e.jsx("div",{className:"text-yellow-700",children:"Se omitir√°n"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:_.errors.length}),e.jsx("div",{className:"text-red-700",children:"Errores"})]})]})]}),_.successYears.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"flex items-center gap-2 font-medium text-green-700 mb-3",children:[e.jsx(te,{className:"w-4 h-4"}),"Se crear√° en estos a√±os (",_.successYears.length,")"]}),e.jsx("div",{className:"space-y-2",children:_.successYears.map(I=>e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-green-800",children:I.year}),e.jsx("span",{className:"text-sm text-green-600",children:I.message})]})},I.year))})]}),_.skippedYears.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"flex items-center gap-2 font-medium text-yellow-700 mb-3",children:[e.jsx(oe,{className:"w-4 h-4"}),"Se omitir√°n estos a√±os (",_.skippedYears.length,")"]}),e.jsx("div",{className:"space-y-2",children:_.skippedYears.map(I=>e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-yellow-800",children:I.year}),e.jsx("span",{className:"text-sm text-yellow-600",children:I.message})]})},I.year))})]}),_.errors.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"flex items-center gap-2 font-medium text-red-700 mb-3",children:[e.jsx(se,{className:"w-4 h-4"}),"Errores encontrados (",_.errors.length,")"]}),e.jsx("div",{className:"space-y-2",children:_.errors.map(I=>e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-red-800",children:I.year}),e.jsx("span",{className:"text-sm text-red-600",children:I.message})]})},I.year))})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Posici√≥n Alfab√©tica"}),e.jsxs("p",{className:"text-sm text-gray-600",children:['La empresa "',_.companyName,'" se insertar√° en la posici√≥n #',_.alphabeticalPosition," del listado alfab√©tico."]})]})]}),a==="completed"&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(te,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"¬°Empresa Creada Exitosamente!"}),e.jsx("p",{className:"text-gray-600",children:"La empresa ha sido creada en los a√±os seleccionados y ordenada alfab√©ticamente en cada archivo."})]})]}),e.jsx("div",{className:"border-t bg-gray-50 px-6 py-4",children:e.jsxs("div",{className:"flex justify-between",children:[a==="configure"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:F,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:z,disabled:!M()||f,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Validando..."]}):e.jsxs(e.Fragment,{children:["Validar Empresa",e.jsx(Ys,{className:"w-4 h-4"})]})})]}),a==="preview"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:L,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"‚Üê Regresar"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:F,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:k,disabled:b||_?.successYears.length===0,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4"}),"Confirmar Creaci√≥n"]})})]})]}),a==="completed"&&e.jsx("button",{onClick:F,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Cerrar"})]})})]})}):null}function Wa({isOpen:l,onClose:t,emptyCompanies:s,onConfirmDelete:r}){const[n,a]=x.useState(new Set),[i,o]=x.useState(!1),[c,m]=x.useState(null);if(!l)return null;const u=f=>{const j=new Set(n);j.has(f)?j.delete(f):j.add(f),a(j)},g=()=>{a(new Set(s.map(f=>f.name)))},d=()=>{a(new Set)},h=async()=>{if(n.size!==0){o(!0);try{const f=await r(Array.from(n));m(f),a(new Set)}catch(f){console.error("Error deleting companies:",f),alert("Error al eliminar empresas: "+(f instanceof Error?f.message:"Error desconocido"))}finally{o(!1)}}},y=()=>{a(new Set),m(null),t()},C=f=>{switch(f){case"Generadora":return e.jsx(qe,{className:"w-4 h-4 text-blue-600"});case"Comercializadora":return e.jsx(ze,{className:"w-4 h-4 text-green-600"});case"Ambas":return e.jsx(H,{className:"w-4 h-4 text-purple-600"});default:return e.jsx(H,{className:"w-4 h-4 text-gray-400"})}},p=f=>f||"No especificado";return c?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"w-6 h-6 text-green-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Eliminaci√≥n Completada"})]}),e.jsx("button",{onClick:y,className:"text-gray-400 hover:text-gray-600 p-1",children:e.jsx(se,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-green-800 mb-2",children:"Resumen de la eliminaci√≥n"}),e.jsxs("p",{className:"text-green-700",children:["Se eliminaron exitosamente ",e.jsx("strong",{children:c.totalDeleted})," empresas sin solicitudes."]}),e.jsxs("p",{className:"text-green-700 text-sm mt-1",children:["Se preservaron ",e.jsx("strong",{children:c.preservedCompanies.length})," empresas con solicitudes activas."]})]})}),c.deletedCompanies.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3",children:["Empresas eliminadas (",c.deletedCompanies.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:c.deletedCompanies.map(f=>e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[C(f.metadata.tipoEmpresa),e.jsx("span",{className:"font-medium text-gray-900",children:f.name})]}),e.jsx("span",{className:"text-sm text-gray-500",children:p(f.metadata.tipoEmpresa)})]}),(f.metadata.usuariosCount||f.metadata.esIncumbente)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 space-y-1",children:[f.metadata.usuariosCount&&e.jsxs("p",{children:["Usuarios: ",f.metadata.usuariosCount.toLocaleString()]}),f.metadata.esIncumbente&&e.jsx("p",{children:"Empresa incumbente"})]})]},f.name))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:y,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Cerrar"})})]})]})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"w-6 h-6 text-orange-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Eliminar Empresas Sin Solicitudes"})]}),e.jsx("button",{onClick:y,className:"text-gray-400 hover:text-gray-600 p-1",children:e.jsx(se,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:s.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(te,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No hay empresas para eliminar"}),e.jsx("p",{className:"text-gray-600",children:"Todas las empresas en el sistema tienen al menos una solicitud activa."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4",children:[e.jsx("h3",{className:"font-semibold text-orange-800 mb-2",children:"‚ö†Ô∏è Confirmaci√≥n de eliminaci√≥n"}),e.jsxs("p",{className:"text-orange-700",children:["Se encontraron ",e.jsx("strong",{children:s.length})," empresas sin solicitudes activas. Esta acci√≥n eliminar√° permanentemente las empresas seleccionadas del sistema."]}),e.jsx("p",{className:"text-orange-700 text-sm mt-2",children:"Las empresas eliminadas no podr√°n ser recuperadas. Revisa cuidadosamente la lista antes de continuar."})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("button",{onClick:g,className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Seleccionar todas"}),e.jsx("button",{onClick:d,className:"px-3 py-1 text-sm bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",children:"Deseleccionar todas"}),e.jsxs("span",{className:"text-sm text-gray-600 flex items-center",children:[n.size," de ",s.length," seleccionadas"]})]})]}),e.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto mb-6",children:s.map(f=>e.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-colors ${n.has(f.name)?"bg-red-50 border-red-200":"bg-gray-50 border-gray-200 hover:bg-gray-100"}`,onClick:()=>u(f.name),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:n.has(f.name),onChange:()=>u(f.name),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[C(f.metadata.tipoEmpresa),e.jsx("span",{className:"font-semibold text-gray-900",children:f.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",p(f.metadata.tipoEmpresa),")"]})]}),(f.metadata.usuariosCount||f.metadata.esIncumbente)&&e.jsxs("div",{className:"text-sm text-gray-600 space-x-4",children:[f.metadata.usuariosCount&&e.jsxs("span",{children:["üë• ",f.metadata.usuariosCount.toLocaleString()," usuarios"]}),f.metadata.esIncumbente&&e.jsx("span",{children:"‚≠ê Incumbente"})]})]})]})},f.name))}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:y,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsxs("button",{onClick:h,disabled:n.size===0||i,className:"flex items-center gap-2 px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx($t,{className:"w-4 h-4"}),i?"Eliminando...":`Eliminar ${n.size} empresas`]})]})]})})]})})}function St(l){if(!l)return"Sin fecha";const t=new Date(l),s={day:"numeric",month:"long",year:"numeric"};return t.toLocaleDateString("es-ES",s)}function qa(l){switch(l){case"all":return"Todas las empresas";case"withRequests":return"Empresas con solicitudes activas";case"withoutDeadline":return"Empresas sin deadline definido";case"manual":return"Selecci√≥n manual de empresas";default:return"Scope desconocido"}}function Ga(l){switch(l){case"all":return"Aplicar a todas las empresas, tengan o no solicitud creada";case"withRequests":return"Solo empresas que tengan solicitudes activas en el mes";case"withoutDeadline":return"Solo empresas que no tengan deadline configurado";case"manual":return"Seleccionar manualmente las empresas";default:return""}}function Ha(l=1){const t=new Date,s=new Date(t);s.setMonth(s.getMonth()+l),s.setDate(15);const r=new Date(s);return r.setDate(r.getDate()+10),{fechaLimiteEmpresa:s.toISOString().split("T")[0],fechaLimiteSLA:r.toISOString().split("T")[0]}}function Ja({isOpen:l,onClose:t,billingData:s,onApplyDeadlines:r}){const[n,a]=x.useState("bulk"),[i,o]=x.useState(U[0]),[c,m]=x.useState(Ha()),[u,g]=x.useState("withRequests"),[d,h]=x.useState([]),[y,C]=x.useState(!1),[p,f]=x.useState(null),[j,_]=x.useState(null),R=x.useMemo(()=>Object.keys(s).filter(k=>k!=="_metadata").sort(),[s]),E=x.useMemo(()=>{const k={all:R.length,withRequests:0,withoutDeadline:0,manual:d.length};return k.withRequests=R.filter(L=>{const F=s[L]?.[i];return F&&F.estado&&F.estado!=="Sin Solicitud"}).length,k.withoutDeadline=Y.getCompaniesWithoutDeadline(s,i).length,k},[s,i,R,d]),v=x.useMemo(()=>Y.generateMonthlySummary(s,i),[s,i]),b=k=>{a(k),f(null),_(null)},S=k=>{o(k),f(null),_(null),v.deadlines&&m(v.deadlines)},D=k=>{g(k),C(k==="manual"),f(null)},w=k=>{h(L=>L.includes(k)?L.filter(F=>F!==k):[...L,k])},A=()=>{h(R)},T=()=>{h([])},M=()=>{const k=Y.validateDeadlines(c);if(!k.valid){f(k.error||"Error de validaci√≥n");return}const L=u==="manual"?E.manual:E[u];if(L===0){f("No hay empresas para aplicar con los criterios seleccionados");return}try{r(i,c,u,d),_(`Plazos aplicados exitosamente a ${L} empresa${L!==1?"s":""}`),f(null),setTimeout(()=>{t(),_(null)},2e3)}catch(F){f(F instanceof Error?F.message:"Error al aplicar plazos")}};if(!l)return null;const z=u==="manual"?E.manual:E[u];return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Gesti√≥n de Plazos"})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white/50 rounded-lg transition-colors",children:e.jsx(se,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"flex border-b bg-gray-50",children:[e.jsx("button",{onClick:()=>b("bulk"),className:`flex-1 px-6 py-3 font-medium transition-colors ${n==="bulk"?"bg-white text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:"Aplicaci√≥n Masiva"}),e.jsx("button",{onClick:()=>b("calendar"),className:`flex-1 px-6 py-3 font-medium transition-colors ${n==="calendar"?"bg-white text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:"Vista por Mes"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[n==="bulk"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Mes a configurar"}),e.jsx("select",{value:i,onChange:k=>S(k.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:U.map(k=>e.jsx("option",{value:k,children:k},k))})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Plazos a aplicar"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Fecha L√≠mite Empresa",e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(Cu√°ndo debe entregar la empresa)"})]}),e.jsx("input",{type:"date",value:c.fechaLimiteEmpresa,onChange:k=>m({...c,fechaLimiteEmpresa:k.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Fecha L√≠mite SLA",e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(Cu√°ndo debemos facturar)"})]}),e.jsx("input",{type:"date",value:c.fechaLimiteSLA,onChange:k=>m({...c,fechaLimiteSLA:k.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Aplicar a:"}),e.jsx("div",{className:"space-y-3",children:["all","withRequests","withoutDeadline","manual"].map(k=>e.jsxs("label",{className:"flex items-start gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:[e.jsx("input",{type:"radio",name:"scope",checked:u===k,onChange:()=>D(k),className:"mt-1 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[qa(k),e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",E[k]," empresa",E[k]!==1?"s":"",")"]})]}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:Ga(k)})]})]},k))})]}),y&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Seleccionar empresas"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:A,className:"text-xs text-blue-600 hover:text-blue-700",children:"Seleccionar todas"}),e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsx("button",{onClick:T,className:"text-xs text-gray-600 hover:text-gray-700",children:"Limpiar"})]})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2",children:R.map(k=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d.includes(k),onChange:()=>w(k),className:"text-blue-600 focus:ring-blue-500 rounded"}),e.jsx("span",{className:"text-sm text-gray-900",children:k})]},k))})]}),v.companiesWithDeadline>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(oe,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-yellow-900",children:"Este mes ya tiene plazos configurados"}),e.jsxs("div",{className:"text-sm text-yellow-700 mt-1",children:[v.companiesWithDeadline," empresa",v.companiesWithDeadline!==1?"s":""," con plazos existentes. Esta acci√≥n sobrescribir√° los plazos existentes."]})]})]})]}),n==="calendar"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ft,{className:"w-5 h-5 text-blue-600"}),e.jsxs("h3",{className:"font-semibold text-gray-900",children:["Resumen de ",i]})]}),v.deadlines?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Fecha L√≠mite Empresa"}),e.jsx("div",{className:"font-medium text-gray-900",children:St(v.deadlines.fechaLimiteEmpresa)}),v.daysUntilCompanyDeadline!==null&&e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:Y.formatDaysRemaining(v.daysUntilCompanyDeadline)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Fecha L√≠mite SLA"}),e.jsx("div",{className:"font-medium text-gray-900",children:St(v.deadlines.fechaLimiteSLA)}),v.daysUntilSLADeadline!==null&&e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:Y.formatDaysRemaining(v.daysUntilSLADeadline)})]})]}),e.jsx("div",{className:"pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-700",children:["Empresas con este plazo:"," ",e.jsx("span",{className:"font-medium",children:v.companiesWithDeadline})," ","de ",v.companiesCount]})})]}):e.jsxs("div",{className:"text-center py-6 text-gray-500",children:["No hay plazos configurados para ",i]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ver mes"}),e.jsx("select",{value:i,onChange:k=>S(k.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:U.map(k=>e.jsx("option",{value:k,children:k},k))})]}),e.jsx("button",{onClick:()=>a("bulk"),className:"w-full p-3 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors font-medium",children:"Configurar plazos para este mes"})]})]}),e.jsxs("div",{className:"border-t bg-gray-50 px-6 py-4",children:[p&&e.jsxs("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-lg p-3 flex items-center gap-2 text-red-700 text-sm",children:[e.jsx(oe,{className:"w-4 h-4 flex-shrink-0"}),p]}),j&&e.jsxs("div",{className:"mb-4 bg-green-50 border border-green-200 rounded-lg p-3 flex items-center gap-2 text-green-700 text-sm",children:[e.jsx(we,{className:"w-4 h-4 flex-shrink-0"}),j]}),e.jsx("div",{className:"flex justify-between items-center",children:n==="bulk"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Se aplicar√° a ",e.jsx("span",{className:"font-semibold",children:z})," empresa",z!==1?"s":""]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:M,disabled:z===0,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:"Aplicar Plazos"})]})]}):e.jsx("button",{onClick:t,className:"ml-auto px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Cerrar"})})]})]})})}function Qa({billingData:l}){const t=x.useMemo(()=>U.map(u=>Y.generateMonthlySummary(l,u)),[l]),s=x.useMemo(()=>Y.getUpcomingDeadlines(l,10),[l]),r=x.useMemo(()=>{const u={critical:0,warning:0,normal:0,none:0};return s.forEach(g=>{const d=Y.getUrgencyLevel(g.daysUntilSLADeadline);u[d]++}),u},[s]),n=x.useMemo(()=>r.critical>0,[r]),a=x.useMemo(()=>t.filter(u=>u.companiesWithDeadline>0&&(u.companyDeadlineUrgency!=="none"||u.slaDeadlineUrgency!=="none")),[t]),i=x.useMemo(()=>s.filter(u=>u.daysUntilSLADeadline!==null&&u.daysUntilSLADeadline<0||u.daysUntilCompanyDeadline!==null&&u.daysUntilCompanyDeadline<0),[s]),o=x.useMemo(()=>t.reduce((u,g)=>u+g.companiesWithDeadline,0),[t]),c=x.useMemo(()=>{const u={};return U.forEach(g=>{const d=Y.getCompaniesDeadlineInfo(l,g);d.length>0&&(u[g]=d)}),u},[l]),m=x.useMemo(()=>({totalDeadlines:s.length,criticalCount:r.critical,warningCount:r.warning,normalCount:r.normal,overdueCount:i.length,activeMonthsCount:a.length,companiesWithDeadlines:o}),[s,r,i,a,o]);return{monthlySummaries:t,upcomingDeadlines:s,urgencyCounts:r,hasCriticalAlerts:n,activeMonths:a,overdueDeadlines:i,deadlinesByMonth:c,statistics:m}}function Xa({billingData:l,onManageClick:t}){const[s,r]=x.useState(!1),n=x.useRef(null),a=ut(),i=Qa({billingData:l});if(i.upcomingDeadlines.length===0)return null;x.useEffect(()=>{const m=u=>{n.current&&!n.current.contains(u.target)&&r(!1)};return s&&document.addEventListener("mousedown",m),()=>{document.removeEventListener("mousedown",m)}},[s]);const o=i.upcomingDeadlines.slice(0,8),c=()=>{r(!1),t()};return e.jsxs("div",{className:"relative",ref:n,children:[e.jsxs("button",{onClick:()=>r(!s),className:`relative flex items-center gap-2 px-3 py-2 rounded-lg transition-all ${i.hasCriticalAlerts?"bg-red-100 hover:bg-red-200 text-red-700":i.urgencyCounts.warning>0?"bg-yellow-100 hover:bg-yellow-200 text-yellow-700":"bg-blue-100 hover:bg-blue-200 text-blue-700"}`,title:"Ver pr√≥ximos vencimientos",children:[e.jsx(Ct,{className:`w-4 h-4 ${i.hasCriticalAlerts?"animate-pulse":""}`}),i.hasCriticalAlerts&&e.jsx("span",{className:"absolute -top-1 -right-1 flex items-center justify-center w-5 h-5 bg-red-600 text-white text-xs font-bold rounded-full border-2 border-white",children:i.urgencyCounts.critical}),e.jsxs("span",{className:"text-sm font-medium hidden sm:inline",children:[i.statistics.totalDeadlines," ",i.statistics.totalDeadlines===1?"plazo":"plazos"]})]}),s&&e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-96 bg-white rounded-lg shadow-2xl border border-gray-200 z-50 overflow-hidden",children:[e.jsxs("div",{className:`px-4 py-3 border-b flex items-center justify-between ${i.hasCriticalAlerts?"bg-gradient-to-r from-red-50 to-orange-50 border-red-100":"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ct,{className:"w-5 h-5 text-gray-700"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Pr√≥ximos Vencimientos"})]}),e.jsx("button",{onClick:()=>r(!1),className:"text-gray-500 hover:text-gray-700 transition-colors",title:"Cerrar",children:e.jsx(se,{className:"w-4 h-4"})})]}),i.hasCriticalAlerts&&e.jsxs("div",{className:"px-4 py-2 bg-red-50 border-b border-red-100 flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-red-600"}),e.jsxs("span",{className:"text-sm font-medium text-red-700",children:[i.urgencyCounts.critical," ",i.urgencyCounts.critical===1?"plazo cr√≠tico":"plazos cr√≠ticos"]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:o.map((m,u)=>{const g=Y.getUrgencyLevel(m.daysUntilSLADeadline),d=Y.getUrgencyIcon(g),h=Y.formatDaysRemaining(m.daysUntilSLADeadline);return e.jsx("div",{className:`px-4 py-3 hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-b-0 ${g==="critical"?"bg-red-50/30":""}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("span",{className:"text-xl",title:`Urgencia: ${g}`,children:d}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate text-sm",title:m.company,children:m.company}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(q,{className:"w-3 h-3"}),e.jsx("span",{children:m.month})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(me,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:`font-bold ${g==="critical"?"text-red-700":g==="warning"?"text-yellow-700":"text-green-700"}`,children:h})]})]})},`${m.company}-${m.month}-${u}`)})}),e.jsxs("div",{className:"border-t border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[i.urgencyCounts.critical>0&&e.jsxs("span",{className:"text-red-700 font-medium",children:[i.urgencyCounts.critical," cr√≠ticos"]}),i.urgencyCounts.warning>0&&e.jsxs("span",{className:"text-yellow-700 font-medium",children:[i.urgencyCounts.warning," advertencia"]}),i.urgencyCounts.normal>0&&e.jsxs("span",{className:"text-green-700 font-medium",children:[i.urgencyCounts.normal," normales"]})]}),i.statistics.totalDeadlines>8&&e.jsxs("span",{className:"text-gray-500",children:["+",i.statistics.totalDeadlines-8," m√°s"]})]}),e.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 space-y-2",children:[e.jsxs("button",{onClick:c,className:"w-full flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2.5 rounded-lg transition-colors font-medium text-sm",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{children:"Gestionar Todos los Plazos"})]}),e.jsxs("button",{onClick:()=>{r(!1),a("/reportes/vencimientos")},className:"w-full flex items-center justify-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2.5 rounded-lg transition-colors font-medium text-sm",children:[e.jsx(Vt,{className:"w-4 h-4"}),e.jsx("span",{children:"Ver Reporte Completo"})]})]})]})]})]})}const Je={isProduction:()=>!0,isDevelopment:()=>!1,isFeatureEnabled:l=>{switch(l){case"actions":return!1;case"azure":return!1;case"protected":return!0;default:return!1}},getProtectionPassword:()=>"jikko",shouldProtectFeatures:()=>Je.isFeatureEnabled("protected")},Za=Je.isFeatureEnabled,Ka=Je.getProtectionPassword,er=Je.shouldProtectFeatures;function tr({children:l,featureName:t="esta funci√≥n"}){const[s,r]=x.useState(!1),[n,a]=x.useState(""),[i,o]=x.useState(""),[c,m]=x.useState(!0),u=`protected_feature_auth_${t.replace(/\s+/g,"_")}`;x.useEffect(()=>{sessionStorage.getItem(u)==="true"&&r(!0),m(!1)},[u]);const g=d=>{d.preventDefault();const h=Ka();n===h?(r(!0),sessionStorage.setItem(u,"true"),o("")):(o("Contrase√±a incorrecta"),a(""))};return c?null:s?e.jsx(e.Fragment,{children:l}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-purple-700 text-white p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Us,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Contenido Protegido"}),e.jsx("p",{className:"text-purple-100 text-sm",children:"Se requiere autenticaci√≥n"})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("p",{className:"text-gray-700 mb-2",children:["El acceso a ",e.jsx("strong",{children:t})," est√° protegido."]}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Por favor, ingresa la contrase√±a para continuar."})]}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Contrase√±a"}),e.jsx("input",{id:"password",type:"password",value:n,onChange:d=>a(d.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Ingresa la contrase√±a",autoFocus:!0})]}),i&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:[e.jsx(ne,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:i})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>window.history.back(),className:"flex-1 bg-gray-100 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-200 transition-colors font-medium",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 bg-purple-600 text-white py-3 px-4 rounded-lg hover:bg-purple-700 transition-colors font-medium",children:"Acceder"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-800",children:[e.jsx("strong",{children:"Nota:"})," La autenticaci√≥n se mantendr√° activa durante esta sesi√≥n del navegador."]})})]})]})})}function et({feature:l,children:t,fallback:s=null,requirePassword:r=!1,featureName:n}){if(!Za(l))return e.jsx(e.Fragment,{children:s});if(r&&er()){const i=n||sr(l);return e.jsx(tr,{featureName:i,children:t})}return e.jsx(e.Fragment,{children:t})}function sr(l){return{actions:"Acciones de Gesti√≥n",azure:"Configuraci√≥n de Azure DevOps",protected:"Funci√≥n Protegida"}[l]||"esta funci√≥n"}function ar({onCreateRequestClick:l,onNewCompanyClick:t,onNewCompanyMultiYearClick:s,onCompareCompaniesClick:r,onImportDataClick:n,onDeleteEmptyCompaniesClick:a,onManageDeadlinesClick:i,azureConfig:o,onConfigClick:c,onSyncClick:m,syncing:u}){const[g,d]=x.useState(!1),h=ut(),y=()=>d(!g),C=p=>{p(),d(!1)};return e.jsxs(e.Fragment,{children:[g&&e.jsx("div",{className:"fixed inset-0 bg-black/20 z-40 transition-opacity",onClick:()=>d(!1)}),e.jsxs("div",{className:"fixed bottom-6 right-6 z-50",children:[g&&e.jsxs("div",{className:"absolute bottom-16 right-0 bg-white rounded-lg shadow-2xl border border-gray-200 w-80 max-h-[80vh] overflow-y-auto mb-2",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-3 rounded-t-lg",children:e.jsx("h3",{className:"font-semibold",children:"Acciones R√°pidas"})}),e.jsxs("div",{className:"p-2",children:[e.jsx(et,{feature:"actions",fallback:null,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide px-2 py-1",children:"Solicitudes y Empresas"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("button",{onClick:()=>C(l),className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-green-50 transition-colors text-left group",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-green-100 rounded-lg group-hover:bg-green-200 transition-colors",children:e.jsx(rt,{className:"w-4 h-4 text-green-700"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Nueva Solicitud"})]}),e.jsxs("button",{onClick:()=>C(t),className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-blue-50 transition-colors text-left group",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-blue-100 rounded-lg group-hover:bg-blue-200 transition-colors",children:e.jsx(H,{className:"w-4 h-4 text-blue-700"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Nueva Empresa"})]}),e.jsxs("button",{onClick:()=>C(s),className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-purple-50 transition-colors text-left group",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-purple-100 rounded-lg group-hover:bg-purple-200 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(H,{className:"w-3.5 h-3.5 text-purple-700"}),e.jsx(q,{className:"w-3 h-3 text-purple-700"})]})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Empresa Multi-A√±o"})]})]})]})}),e.jsx(et,{feature:"actions",fallback:null,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide px-2 py-1",children:"Gesti√≥n de Datos"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("button",{onClick:()=>C(r),className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-gray-50 transition-colors text-left group",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-gray-100 rounded-lg group-hover:bg-gray-200 transition-colors",children:e.jsx(lt,{className:"w-4 h-4 text-gray-700"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Comparar Empresas"})]}),e.jsxs("button",{onClick:()=>C(n),className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-orange-50 transition-colors text-left group",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-orange-100 rounded-lg group-hover:bg-orange-200 transition-colors",children:e.jsx(it,{className:"w-4 h-4 text-orange-700"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Importar Datos"})]}),e.jsxs("button",{onClick:()=>C(a),className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-red-50 transition-colors text-left group",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-red-100 rounded-lg group-hover:bg-red-200 transition-colors",children:e.jsx($t,{className:"w-4 h-4 text-red-700"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Limpiar Empresas Vac√≠as"})]})]})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide px-2 py-1",children:"Plazos y Vencimientos"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("button",{onClick:()=>C(i),className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-amber-50 transition-colors text-left group",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-amber-100 rounded-lg group-hover:bg-amber-200 transition-colors",children:e.jsx(Ws,{className:"w-4 h-4 text-amber-700"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Gestionar Plazos"})]}),e.jsxs("button",{onClick:()=>{h("/reportes/vencimientos"),d(!1)},className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-blue-50 transition-colors text-left group",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-blue-100 rounded-lg group-hover:bg-blue-200 transition-colors",children:e.jsx(Vt,{className:"w-4 h-4 text-blue-700"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Reporte de Vencimientos"})]})]})]}),e.jsx(et,{feature:"azure",fallback:null,children:e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide px-2 py-1",children:"Azure DevOps"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("button",{onClick:()=>C(c),className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-purple-50 transition-colors text-left group",children:[e.jsxs("div",{className:"flex items-center justify-center w-8 h-8 bg-purple-100 rounded-lg group-hover:bg-purple-200 transition-colors relative",children:[e.jsx(Ot,{className:"w-4 h-4 text-purple-700"}),o.enabled&&e.jsx("div",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-green-500 rounded-full border border-white"})]}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Configurar Azure"})]}),o.enabled&&e.jsxs("button",{onClick:()=>C(m),disabled:u,className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-indigo-50 transition-colors text-left group disabled:opacity-50",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-indigo-100 rounded-lg group-hover:bg-indigo-200 transition-colors",children:e.jsx($e,{className:`w-4 h-4 text-indigo-700 ${u?"animate-spin":""}`})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:u?"Sincronizando...":"Sincronizar Azure"})]})]})]})})]})]}),e.jsx("button",{onClick:y,className:`flex items-center justify-center w-14 h-14 rounded-full shadow-lg transition-all duration-300 ${g?"bg-red-600 hover:bg-red-700 rotate-90":"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700"}`,title:g?"Cerrar men√∫":"Acciones r√°pidas",children:g?e.jsx(se,{className:"w-6 h-6 text-white"}):e.jsx(qs,{className:"w-6 h-6 text-white"})})]})]})}function rr(){const[l,t]=x.useState(!1),s=x.useCallback(()=>{t(!0)},[]),r=x.useCallback(()=>{t(!1)},[]);return{showComparisonModal:l,openComparisonModal:s,closeComparisonModal:r}}class nr{static normalizeCompanyName(t){return t.replace(/\s*\(\d{4}\)\s*$/,"").trim()}static async processImportData(t,s,r,n,a,i){const o=[];try{const c=JSON.parse(t);if(!c||typeof c!="object")throw new Error("JSON inv√°lido: debe ser un objeto con empresas");for(const[m,u]of Object.entries(c)){if(!u||typeof u!="object"){o.push({company:m,month:"",status:"error",message:"Datos de empresa inv√°lidos"});continue}for(const[g,d]of Object.entries(u))try{const h=this.normalizeCompanyName(m),y=await this.processCompanyMonthRecord(h,g,d,s,r,n,a,i);o.push(y)}catch(h){o.push({company:this.normalizeCompanyName(m),month:g,status:"error",message:h instanceof Error?h.message:"Error desconocido"})}}}catch(c){o.push({company:"",month:"",status:"error",message:c instanceof Error?`Error de formato JSON: ${c.message}`:"JSON inv√°lido"})}return this.createSummary(o)}static async processCompanyMonthRecord(t,s,r,n,a,i,o,c){if(!r||typeof r!="object")return{company:t,month:s,status:"error",message:"Datos de solicitud inv√°lidos"};const{entidad:m,workItemId:u,anio:g}=r;if(!m||!u||!g)return{company:t,month:s,status:"error",message:"Faltan campos requeridos: entidad, workItemId, anio"};const d=typeof u=="number"?u:parseInt(u);if(isNaN(d))return{company:t,month:s,status:"error",message:"workItemId debe ser un n√∫mero v√°lido"};const h=typeof g=="number"?g:parseInt(g);if(isNaN(h)||h<2017||h>2030)return{company:t,month:s,status:"error",message:`A√±o ${h} no es v√°lido (debe estar entre 2017 y 2030)`};if(!U.includes(s))return{company:t,month:s,status:"error",message:`Mes "${s}" no es v√°lido. Debe ser uno de: ${U.join(", ")}`};const y=`${m}-${h}`,C=c?.[y]||n;if(!C[t])return{company:t,month:s,status:"error",message:`Empresa "${t}" no encontrada en ${m} ${h}`};const p=C[t][s];if(p&&typeof p=="object"&&p.workItemId)return{company:t,month:s,status:"skipped",message:`Ya existe registro para ${m} ${h} con Work Item ${p.workItemId}`,workItemId:p.workItemId};try{const f=await o(d);return f?{company:t,month:s,status:"success",message:`Work Item ${d} validado para ${h} (Estado: ${f})`,workItemId:d}:{company:t,month:s,status:"error",message:`Work Item ${d} no existe o no es accesible en Azure DevOps`,workItemId:d}}catch(f){return{company:t,month:s,status:"error",message:`Error al validar Work Item ${d}: ${f instanceof Error?f.message:"Error desconocido"}`,workItemId:d}}}static createSummary(t){const s=t.filter(a=>a.status==="success"),r=t.filter(a=>a.status==="skipped"),n=t.filter(a=>a.status==="error");return{total:t.length,imported:s,skipped:r,errors:n}}}function lr({billingData:l,selectedYear:t,selectedEntity:s,updateField:r,updateStatusFromAzure:n,syncFromAzure:a,syncWorkItemData:i}){const[o,c]=x.useState(!1),m=x.useCallback(()=>{c(!0)},[]),u=x.useCallback(()=>{c(!1)},[]),g=x.useCallback(async d=>{let h={};try{h=JSON.parse(d)}catch{throw new Error("JSON inv√°lido")}const y=new Set;for(const[,f]of Object.entries(h))if(typeof f=="object"&&f)for(const[,j]of Object.entries(f))typeof j=="object"&&j&&j.anio&&j.entidad&&y.add(`${j.entidad}-${j.anio}`);const C={};for(const f of y){const[j,_]=f.split("-"),R=parseInt(_);try{const E=await B.loadDataForEntityYear(j,R);C[f]=E}catch(E){console.warn(`Could not load data for ${j} ${R}:`,E),C[f]={}}}const p=await nr.processImportData(d,l,t,s,a,C);for(const f of p.imported)if(f.workItemId&&f.message){const j=f.message.match(/validado para (\d{4})/),_=j?parseInt(j[1]):t,R=Object.keys(h).find(b=>b.replace(/\s*\(\d{4}\)\s*$/,"").trim()===f.company);let E=s;R&&h[R]?.[f.month]?.entidad&&(E=h[R][f.month].entidad);const v=`${E}-${_}`;try{const b=await i(f.workItemId),S=new Date().toISOString().split("T")[0],D={workItemId:f.workItemId,entidad:E,notas:"",estado:b?.state||"New",fechaRecibido:b?.fechaRecibido||S,fechaCerrado:b?.fechaCerrado||"",workItemType:b?.workItemType};C[v]&&(C[v][f.company]||(C[v][f.company]={}),C[v][f.company][f.month]=D,await B.saveDataForEntityYear(E,_,C[v])),_===t&&E===s&&(r(f.company,f.month,"workItemId",f.workItemId),r(f.company,f.month,"entidad",E),r(f.company,f.month,"notas",""),r(f.company,f.month,"fechaRecibido",D.fechaRecibido),r(f.company,f.month,"fechaCerrado",D.fechaCerrado),r(f.company,f.month,"workItemType",D.workItemType),n(f.company,f.month,D.estado))}catch(b){console.error(`Error syncing data for ${f.company} - ${f.month}:`,b)}}return p},[l,t,s,r,n,a,i]);return{showImportModal:o,openImportModal:m,closeImportModal:u,processImport:g}}function ir(){const l=x.useCallback(s=>{const r=[];for(const[n,a]of Object.entries(s)){let i=!1;for(const o of U){const c=B.getMonthlyBillingData(a,o);if(c&&c.estado!=="Sin Solicitud"){i=!0;break}}if(!i){const o=B.getCompanyMetadata(a);r.push({name:n,metadata:o,monthsChecked:[...U]})}}return r},[]),t=x.useCallback((s,r)=>{const n={...s},a=[],i=[];r.forEach(c=>{if(n[c]){const m=B.getCompanyMetadata(n[c]);a.push({name:c,metadata:m,monthsChecked:[...U]}),delete n[c]}}),Object.keys(s).forEach(c=>{r.includes(c)||i.push(c)});const o={deletedCompanies:a,totalDeleted:a.length,preservedCompanies:i};return{updatedData:n,result:o}},[]);return{findEmptyCompanies:l,deleteEmptyCompanies:t}}function Et(){const{year:l,entity:t}=xt(),s=ut(),r=Pt(),[n,a]=x.useState(null),[i,o]=x.useState(!1),[c,m]=x.useState(!1),[u,g]=x.useState(!1),[d,h]=x.useState(null),[y,C]=x.useState(!1),[p,f]=x.useState(!1),[j,_]=x.useState(!1),[R,E]=x.useState(!1),v=l?parseInt(l):2025,b=t?decodeURIComponent(t):"Alcald√≠a de Palmira",{billingData:S,isLoading:D,error:w,updateField:A,updateStatusFromAzure:T,getCellData:M,updateCompanyMetadata:z,getCompanyMetadata:k,renameCompany:L,addNewCompany:F,getCompanyNames:I,deleteCompanies:V,performAdvancedSync:Z}=ee(v,b),G=Sa(S),$=Aa(),ae=rr(),re=lr({billingData:S,selectedYear:v,selectedEntity:b,updateField:A,updateStatusFromAzure:T,syncFromAzure:$.syncFromAzure,syncWorkItemData:$.syncWorkItemData}),le=ir(),ie=Ra({billingData:S,onUpdateData:A});x.useEffect(()=>{const O=new URLSearchParams(r.search).get("search");O&&G.setSearchTerm(O)},[r.search,G.setSearchTerm]),x.useEffect(()=>{(!l||!t)&&r.pathname==="/"&&s(`/2025/${encodeURIComponent("Alcald√≠a de Palmira")}`,{replace:!0})},[l,t,r.pathname,s]);const ue=x.useCallback(P=>{s(`/${P}/${encodeURIComponent(b)}`,{replace:!0})},[s,b]),xe=x.useCallback(P=>{s(`/${v}/${encodeURIComponent(P)}`,{replace:!0})},[s,v]),Ae=x.useCallback((P,O)=>{a({empresa:P,mes:O})},[]),De=x.useCallback(()=>{a(null)},[]),Le=x.useCallback(async(P,O,J,Q)=>{if(J==="estado"&&M(P,O)?.workItemId||A(P,O,J,Q),J==="workItemId"&&Q&&!M(P,O)?.workItemId){const X=await $.createWorkItem(P,O,v,M(P,O)?.entidad||"");X&&A(P,O,"workItemId",X)}if(J==="workItemId"&&Q&&M(P,O)?.workItemId!==Q){const X=await $.syncFromAzure(Q);X&&T(P,O,X)}},[A,T,M,$,v]),Me=x.useCallback(async(P,O,J)=>{const Q=await $.createWorkItem(P,O,v,J);Q&&A(P,O,"workItemId",Q)},[$,A,v]),is=x.useCallback(async(P,O,J)=>{const Q=await $.syncFromAzure(J);Q&&T(P,O,Q)},[$,T]),os=x.useCallback(()=>{g(!0)},[]),cs=x.useCallback(async P=>await Z(P,$,(O,J,Q)=>{console.log(`Syncing ${O}/${J}: ${Q}`)}),[Z,$]),ds=x.useCallback((P,O)=>{O&&(O.ctrlKey||O.metaKey)?s(`/empresa/${encodeURIComponent(P)}`):(h(P),C(!1))},[s]),ms=x.useCallback(()=>{h("Nueva Empresa"),C(!0)},[]),us=x.useCallback(()=>{f(!0)},[]),xs=x.useCallback(async(P,O,J)=>await Fe.validateCompanyMultiYear(P,O,b,J),[b]),hs=x.useCallback(async(P,O)=>{await Fe.createCompanyMultiYear(P,O,b),P.successYears.some(Q=>Q.year===v)&&window.location.reload()},[b,v]),gs=x.useCallback((P,O)=>{try{if(y){if(!O)throw new Error("Se requiere el nombre de la empresa para crear una nueva empresa");F(O,P)}else d&&(O&&O!==d?L(d,O):z(d,P));h(null),C(!1)}catch(J){console.error("Error saving company info:",J),alert(J instanceof Error?J.message:"Error al guardar la informaci√≥n de la empresa")}},[y,d,F,L,z]),ps=x.useCallback(async(P,O,J,Q)=>{for(const X of O)if(A(P,X,"estado","New"),A(P,X,"entidad",b),A(P,X,"fechaRecibido",new Date().toISOString().split("T")[0]),A(P,X,"notas",J),Q&&Q.trim()){const Qe=parseInt(Q.trim());if(A(P,X,"workItemId",Qe),$.azureConfig.enabled)try{const Se=await $.syncWorkItemData(Qe);Se&&(T(P,X,Se.state),A(P,X,"fechaRecibido",Se.fechaRecibido),A(P,X,"fechaCerrado",Se.fechaCerrado),A(P,X,"workItemType",Se.workItemType))}catch(Se){console.error(`Error syncing Azure data for work item ${Qe}:`,Se)}}},[A,b,$,T]),fs=x.useCallback(()=>{_(!0)},[]),vt=x.useCallback(()=>{E(!0)},[]),bs=x.useCallback((P,O,J,Q)=>{try{const X=ie.applyDeadlinesToMonth({month:P,deadlines:O,scope:J,selectedCompanies:Q});console.log(`Deadlines aplicados a ${X.appliedCount} empresas`)}catch(X){throw console.error("Error aplicando deadlines:",X),X}},[ie]),js=x.useCallback(()=>o(!1),[]),ys=x.useCallback(()=>m(!1),[]),Ns=x.useCallback(()=>g(!1),[]),vs=x.useCallback(()=>f(!1),[]),ws=x.useCallback(()=>_(!1),[]),Cs=x.useCallback(()=>E(!1),[]),Ds=x.useCallback(()=>o(!0),[]),Ss=x.useCallback(()=>m(!0),[]),Es=x.useCallback(()=>{h(null),C(!1)},[]),_s=x.useCallback(async P=>{const{result:O}=le.deleteEmptyCompanies(S,P);return V(P),O},[S,le,V]),ks=n?M(n.empresa,n.mes):null;return D?e.jsx("div",{className:"min-h-screen bg-gray-50 p-4 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-600",children:["Cargando datos de ",b,"..."]})]})}):w?e.jsx("div",{className:"min-h-screen bg-gray-50 p-4 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:[e.jsx("h3",{className:"font-bold",children:"Error al cargar datos"}),e.jsx("p",{children:w})]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Por favor, verifica que existan los datos para esta entidad y a√±o."}),e.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Intentar nuevamente"})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-6",children:e.jsxs("div",{className:"w-full",children:[e.jsx(Ia,{selectedYear:v,onYearChange:ue,searchTerm:G.searchTerm,onSearchChange:G.setSearchTerm,selectedEntity:b,onEntityChange:xe,realStateStatistics:G.realStateStatistics,statusFilters:G.statusFilters,selectedFTStatus:G.selectedFTStatus,onFTStatusChange:G.setSelectedFTStatus,ftStatistics:G.ftStatistics,deadlineBadge:e.jsx(Xa,{billingData:S,onManageClick:vt})}),e.jsx(La,{filteredCompanies:G.filteredCompanies,billingData:S,onCellClick:Ae,onCompanyClick:ds}),e.jsx(ar,{onCreateRequestClick:Ss,onNewCompanyClick:ms,onNewCompanyMultiYearClick:us,onCompareCompaniesClick:ae.openComparisonModal,onImportDataClick:re.openImportModal,onDeleteEmptyCompaniesClick:fs,onManageDeadlinesClick:vt,azureConfig:$.azureConfig,onConfigClick:Ds,onSyncClick:os,syncing:$.syncing}),e.jsx(Ma,{selectedCell:n,currentData:ks,selectedYear:v,azureConfig:$.azureConfig,syncing:$.syncing,onClose:De,onUpdateData:Le,onCreateWorkItem:Me,onSyncFromAzure:is,getWorkItemUrl:$.getWorkItemUrl}),e.jsx(Oa,{isOpen:i,onClose:js,config:$.azureConfig,onUpdateConfig:$.updateConfig}),e.jsx($a,{isOpen:c,onClose:ys,billingData:S,selectedEntity:b,selectedYear:v,azureConfig:$.azureConfig,onCreateRequest:ps}),e.jsx(Fa,{isOpen:u,onClose:Ns,azureConfig:$.azureConfig,filteredCompanies:G.filteredCompanies,selectedYear:v,onSync:cs}),e.jsx(Va,{isOpen:!!d,onClose:Es,companyName:d||"",currentMetadata:d&&!y?k(d):void 0,existingCompanies:I(),isNewCompany:y,onSave:gs}),e.jsx(za,{isOpen:ae.showComparisonModal,onClose:ae.closeComparisonModal,defaultEntity:b}),e.jsx(Ba,{isOpen:re.showImportModal,onClose:re.closeImportModal,onImport:re.processImport,selectedEntity:b,selectedYear:v}),e.jsx(Ua,{isOpen:p,onClose:vs,selectedEntity:b,onValidate:xs,onConfirmCreation:hs}),e.jsx(Wa,{isOpen:j,onClose:ws,emptyCompanies:le.findEmptyCompanies(S),onConfirmDelete:_s}),e.jsx(Ja,{isOpen:R,onClose:Cs,billingData:S,onApplyDeadlines:bs})]})})}function or(){const l=ee(2025,"Alcald√≠a de Palmira"),t=ee(2025,"Alcald√≠a de Tulu√°"),s=ee(2025,"Gobernaci√≥n del Valle del Cauca"),r=ee(2025,"Infibagu√©"),n=ee(2024,"Alcald√≠a de Palmira"),a=ee(2024,"Alcald√≠a de Tulu√°"),i=ee(2024,"Gobernaci√≥n del Valle del Cauca"),o=ee(2024,"Infibagu√©"),c=ee(2023,"Alcald√≠a de Palmira"),m=ee(2023,"Alcald√≠a de Tulu√°"),u=ee(2023,"Gobernaci√≥n del Valle del Cauca"),g=ee(2023,"Infibagu√©"),d=x.useMemo(()=>{const f={},j=[{entity:"Alcald√≠a de Palmira",data:l},{entity:"Alcald√≠a de Tulu√°",data:t},{entity:"Gobernaci√≥n del Valle del Cauca",data:s},{entity:"Infibagu√©",data:r}].filter(({data:E})=>!E.error&&E.billingData&&Object.keys(E.billingData).length>0);j.length>0&&(f[2025]=j);const _=[{entity:"Alcald√≠a de Palmira",data:n},{entity:"Alcald√≠a de Tulu√°",data:a},{entity:"Gobernaci√≥n del Valle del Cauca",data:i},{entity:"Infibagu√©",data:o}].filter(({data:E})=>!E.error&&E.billingData&&Object.keys(E.billingData).length>0);_.length>0&&(f[2024]=_);const R=[{entity:"Alcald√≠a de Palmira",data:c},{entity:"Alcald√≠a de Tulu√°",data:m},{entity:"Gobernaci√≥n del Valle del Cauca",data:u},{entity:"Infibagu√©",data:g}].filter(({data:E})=>!E.error&&E.billingData&&Object.keys(E.billingData).length>0);return R.length>0&&(f[2023]=R),f},[l,t,s,r,n,a,i,o,c,m,u,g]),h=x.useMemo(()=>[l,t,s,r,n,a,i,o,c,m,u,g].some(j=>j.isLoading),[l,t,s,r,n,a,i,o,c,m,u,g]),y=x.useMemo(()=>[l,t,s,r,n,a,i,o,c,m,u,g].map(j=>j.error).filter(j=>j&&!j.includes("No se pudo cargar")&&!j.includes("Failed to load")),[l,t,s,r,n,a,i,o,c,m,u,g]),C=x.useMemo(()=>Object.keys(d).map(f=>parseInt(f)).sort((f,j)=>j-f),[d]),p=x.useMemo(()=>{const f=new Set;return Object.values(d).forEach(j=>{j.forEach(({entity:_})=>f.add(_))}),Array.from(f)},[d]);return{entityDataByYear:d,isLoading:h,criticalErrors:y,availableYears:C,availableEntities:p}}function cr(){const[l,t]=x.useState("all"),[s,r]=x.useState(2025),[n,a]=x.useState(""),[i,o]=x.useState("all"),c=or(),m=ee(s==="all"?2025:s,"Alcald√≠a de Palmira"),u=ee(s==="all"?2025:s,"Alcald√≠a de Tulu√°"),g=ee(s==="all"?2025:s,"Gobernaci√≥n del Valle del Cauca"),d=ee(s==="all"?2025:s,"Infibagu√©"),h=x.useMemo(()=>{if(s==="all"){const E=[];return Object.values(c.entityDataByYear).forEach(v=>{v.forEach(({entity:b,data:S})=>{E.find(w=>w.key===b)||E.push({key:b,data:S})})}),E}else{const E=[];return!m.error&&m.billingData&&Object.keys(m.billingData).length>0&&E.push({key:"Alcald√≠a de Palmira",data:m}),!u.error&&u.billingData&&Object.keys(u.billingData).length>0&&E.push({key:"Alcald√≠a de Tulu√°",data:u}),!g.error&&g.billingData&&Object.keys(g.billingData).length>0&&E.push({key:"Gobernaci√≥n del Valle del Cauca",data:g}),!d.error&&d.billingData&&Object.keys(d.billingData).length>0&&E.push({key:"Infibagu√©",data:d}),E}},[s,c.entityDataByYear,m,u,g,d]),y=x.useMemo(()=>{const E=[],v=(b,S,D)=>{b&&Object.entries(b).forEach(([w,A])=>{A&&Object.entries(A).forEach(([T,M])=>{if(T==="_metadata"||!M||typeof M!="object")return;const z=M;z.estado&&z.estado!=="Closed"&&z.estado!=="Sin Solicitud"&&E.push({...z,entityName:S,companyName:w,monthName:T,year:D})})})};return s==="all"?Object.entries(c.entityDataByYear).forEach(([b,S])=>{const D=parseInt(b);S.forEach(({entity:w,data:A})=>{v(A.billingData,w,D)})}):h.forEach(({key:b,data:S})=>{v(S.billingData,b,s)}),E},[s,h,c.entityDataByYear]),C=x.useMemo(()=>y.filter(E=>{if(l!=="all"&&E.entityName!==l||i!=="all"&&E.estado!==i)return!1;if(n){const v=n.toLowerCase();return E.companyName.toLowerCase().includes(v)||E.entityName.toLowerCase().includes(v)||E.monthName.toLowerCase().includes(v)||E.notas&&E.notas.toLowerCase().includes(v)||E.workItemId&&E.workItemId.toString().includes(v)}return!0}),[y,l,i,n]),p=x.useMemo(()=>{const E=new Map;return C.forEach(v=>{const b=`${v.companyName}|${v.entityName}`;E.has(b)||E.set(b,{entityName:v.entityName,companyName:v.companyName,periods:[],pendingCount:0});const S=E.get(b);S.periods.push({monthName:v.monthName,year:v.year,estado:v.estado,fechaRecibido:v.fechaRecibido,fechaCerrado:v.fechaCerrado,diasProcesamiento:v.diasProcesamiento,notas:v.notas,workItemId:v.workItemId}),S.pendingCount=S.periods.length}),Array.from(E.values()).sort((v,b)=>{if(v.pendingCount!==b.pendingCount)return b.pendingCount-v.pendingCount;const S=v.entityName.localeCompare(b.entityName);return S!==0?S:v.companyName.localeCompare(b.companyName)})},[C]),f=x.useMemo(()=>{const E={"Sin Solicitud":0,New:0,Refinement:0,Ready:0,Active:0,"Validaci√≥n y aprobaci√≥n de Tributaria - Anal√≠tica":0,"Cargue Archivo Staging":0,"Validaci√≥n Tributaria Staging":0,"Cargue Archivo PROD":0,"Validaci√≥n y Aprobaci√≥n de Tributaria - PROD":0,"Facturaci√≥n en PROD":0,"Validaci√≥n Tributaria de Facturaci√≥n":0,"Dispersi√≥n en BD":0,"Generar Reportes":0,"QA Certification":0,"Gestion Tributaria":0,Impediment:0,Paused:0,"Peer Review":0,"Third Party":0,Staging:0,Production:0,Closed:0,Removed:0},v={},b={},S={};C.forEach(w=>{E[w.estado]=(E[w.estado]||0)+1,v[w.entityName]=(v[w.entityName]||0)+1,b[w.companyName]=(b[w.companyName]||0)+1,S[w.year]=(S[w.year]||0)+1});const D={total:C.length,byStatus:E,byEntity:v,byCompany:b};return s==="all"&&(D.byYear=S),D},[C,s]),j=x.useMemo(()=>s==="all"?c.isLoading:m.isLoading||u.isLoading||g.isLoading||d.isLoading,[s,c.isLoading,m.isLoading,u.isLoading,g.isLoading,d.isLoading]),_=x.useMemo(()=>s==="all"?c.criticalErrors:[m.error,u.error,g.error,d.error].filter(E=>E&&!E.includes("No se pudo cargar")&&!E.includes("Failed to load")),[s,c.criticalErrors,m.error,u.error,g.error,d.error]),R=x.useMemo(()=>s==="all"?c.availableEntities:h.map(E=>E.key),[s,c.availableEntities,h]);return{requests:C,groupedRequests:p,stats:f,selectedEntity:l,setSelectedEntity:t,selectedYear:s,setSelectedYear:r,searchTerm:n,setSearchTerm:a,statusFilter:i,setStatusFilter:o,isLoading:j,error:_.length>0?_.join("; "):null,entities:R,allEntities:ce,years:s==="all"?c.availableYears:[2017,2018,2019,2020,2021,2022,2023,2024,2025],availableYears:c.availableYears,statuses:["New","Refinement","Ready","Active","QA Certification","Gestion Tributaria","Impediment","Paused","Peer Review","Third Party","Staging","Production"]}}const fe=x.forwardRef(({className:l,...t},s)=>e.jsx("div",{ref:s,className:W("rounded-lg border bg-card text-card-foreground shadow-sm",l),...t}));fe.displayName="Card";const _e=x.forwardRef(({className:l,...t},s)=>e.jsx("div",{ref:s,className:W("flex flex-col space-y-1.5 p-6",l),...t}));_e.displayName="CardHeader";const Ie=x.forwardRef(({className:l,...t},s)=>e.jsx("h3",{ref:s,className:W("text-2xl font-semibold leading-none tracking-tight",l),...t}));Ie.displayName="CardTitle";const dr=x.forwardRef(({className:l,...t},s)=>e.jsx("p",{ref:s,className:W("text-sm text-muted-foreground",l),...t}));dr.displayName="CardDescription";const be=x.forwardRef(({className:l,...t},s)=>e.jsx("div",{ref:s,className:W("p-6 pt-0",l),...t}));be.displayName="CardContent";const mr=x.forwardRef(({className:l,...t},s)=>e.jsx("div",{ref:s,className:W("flex items-center p-6 pt-0",l),...t}));mr.displayName="CardFooter";const ur=Lt("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Kt({className:l,variant:t,...s}){return e.jsx("div",{className:W(ur({variant:t}),l),...s})}function es({size:l="md",className:t}){const s={sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8"};return e.jsx("div",{className:W("animate-spin rounded-full border-2 border-gray-300 border-t-blue-600",s[l],t)})}function xr({stats:l,isLoading:t}){if(t)return e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[1,2,3,4].map(i=>e.jsx(fe,{children:e.jsx(be,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(es,{size:"md"})})})},i))});const s=Object.entries(l.byEntity).sort(([,i],[,o])=>o-i).slice(0,3),r=Object.entries(l.byCompany).sort(([,i],[,o])=>o-i).slice(0,3),n=l.byYear&&Object.keys(l.byYear).length>0;return e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(fe,{children:[e.jsxs(_e,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Ie,{className:"text-sm font-medium",children:"Total Pendientes"}),e.jsx(ke,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(be,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Solicitudes no cerradas"})]})]}),e.jsxs(fe,{children:[e.jsxs(_e,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Ie,{className:"text-sm font-medium",children:"Por Estado"}),e.jsx(Ne,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(be,{children:e.jsx("div",{className:"space-y-2",children:Object.entries(l.byStatus).filter(([,i])=>i>0).map(([i,o])=>{const c=ye(i),m=bt[i]||i;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Kt,{variant:"outline",className:`text-xs ${c.bg} ${c.text} border-current`,children:m}),e.jsx("span",{className:"text-sm font-medium",children:o})]},i)})})})]}),e.jsxs(fe,{children:[e.jsxs(_e,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Ie,{className:"text-sm font-medium",children:"Por Entidad"}),e.jsx(H,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(be,{children:e.jsx("div",{className:"space-y-2",children:s.length>0?s.map(([i,o])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:i}),e.jsx("span",{className:"text-sm font-medium",children:o})]},i)):e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sin datos"})})})]}),e.jsxs(fe,{children:[e.jsxs(_e,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Ie,{className:"text-sm font-medium",children:"Top Empresas"}),e.jsx(ze,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(be,{children:e.jsx("div",{className:"space-y-2",children:r.length>0?r.map(([i,o])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:i.length>15?`${i.substring(0,15)}...`:i}),e.jsx("span",{className:"text-sm font-medium",children:o})]},i)):e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sin datos"})})})]}),n&&e.jsxs(fe,{children:[e.jsxs(_e,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Ie,{className:"text-sm font-medium",children:"Por A√±o"}),e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(be,{children:e.jsxs("div",{className:"space-y-2",children:[Object.entries(l.byYear).sort(([i],[o])=>parseInt(o)-parseInt(i)).slice(0,3).map(([i,o])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:i}),e.jsx("span",{className:"text-sm font-medium",children:o})]},i)),Object.keys(l.byYear).length>3&&e.jsxs("div",{className:"text-xs text-muted-foreground text-center pt-1",children:["+",Object.keys(l.byYear).length-3," m√°s"]})]})})]})]})}const ts=x.forwardRef(({className:l,type:t,...s},r)=>e.jsx("input",{type:t,className:W("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",l),ref:r,...s}));ts.displayName="Input";const tt=oa,st=ca,Ue=x.forwardRef(({className:l,children:t,...s},r)=>e.jsxs(Bt,{ref:r,className:W("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",l),...s,children:[t,e.jsx(aa,{asChild:!0,children:e.jsx(Ge,{className:"h-4 w-4 opacity-50"})})]}));Ue.displayName=Bt.displayName;const ss=x.forwardRef(({className:l,...t},s)=>e.jsx(Yt,{ref:s,className:W("flex cursor-default items-center justify-center py-1",l),...t,children:e.jsx(Gs,{className:"h-4 w-4"})}));ss.displayName=Yt.displayName;const as=x.forwardRef(({className:l,...t},s)=>e.jsx(Ut,{ref:s,className:W("flex cursor-default items-center justify-center py-1",l),...t,children:e.jsx(Ge,{className:"h-4 w-4"})}));as.displayName=Ut.displayName;const We=x.forwardRef(({className:l,children:t,position:s="popper",...r},n)=>e.jsx(ra,{children:e.jsxs(Wt,{ref:n,className:W("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",l),position:s,...r,children:[e.jsx(ss,{}),e.jsx(na,{className:W("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(as,{})]})}));We.displayName=Wt.displayName;const hr=x.forwardRef(({className:l,...t},s)=>e.jsx(qt,{ref:s,className:W("py-1.5 pl-8 pr-2 text-sm font-semibold",l),...t}));hr.displayName=qt.displayName;const Ee=x.forwardRef(({className:l,children:t,...s},r)=>e.jsxs(Gt,{ref:r,className:W("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",l),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(la,{children:e.jsx(Hs,{className:"h-4 w-4"})})}),e.jsx(ia,{children:t})]}));Ee.displayName=Gt.displayName;const gr=x.forwardRef(({className:l,...t},s)=>e.jsx(Ht,{ref:s,className:W("-mx-1 my-1 h-px bg-muted",l),...t}));gr.displayName=Ht.displayName;function pr({selectedEntity:l,setSelectedEntity:t,selectedYear:s,setSelectedYear:r,searchTerm:n,setSearchTerm:a,statusFilter:i,setStatusFilter:o,entities:c,years:m,availableYears:u,statuses:g}){return e.jsx(fe,{children:e.jsx(be,{className:"p-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ht,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(ts,{placeholder:"Buscar empresa, entidad, mes...",value:n,onChange:d=>a(d.target.value),className:"pl-10"})]}),e.jsxs(tt,{value:l,onValueChange:t,children:[e.jsx(Ue,{children:e.jsx(st,{placeholder:"Todas las entidades"})}),e.jsxs(We,{children:[e.jsxs(Ee,{value:"all",children:["Todas las entidades (",c.length,")"]}),c.map(d=>e.jsx(Ee,{value:d,children:d},d))]})]}),e.jsxs(tt,{value:s.toString(),onValueChange:d=>r(d==="all"?"all":parseInt(d)),children:[e.jsx(Ue,{children:e.jsx(st,{})}),e.jsxs(We,{children:[e.jsxs(Ee,{value:"all",children:["Todos los a√±os ",u&&u.length>0&&`(${u.length})`]}),m.map(d=>e.jsx(Ee,{value:d.toString(),children:d},d))]})]}),e.jsxs(tt,{value:i,onValueChange:d=>o(d),children:[e.jsx(Ue,{children:e.jsx(st,{placeholder:"Todos los estados"})}),e.jsxs(We,{children:[e.jsx(Ee,{value:"all",children:"Todos los estados"}),g.map(d=>e.jsx(Ee,{value:d,children:d},d))]})]})]})})})}const fr=da,_t=ma,kt=ua,ct=x.forwardRef(({className:l,sideOffset:t=4,...s},r)=>e.jsx(Jt,{ref:r,sideOffset:t,className:W("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",l),...s}));ct.displayName=Jt.displayName;function br({groupedRequest:l}){const t=[...l.periods].sort((i,o)=>{const c=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];return i.year!==o.year?i.year-o.year:c.indexOf(i.monthName)-c.indexOf(o.monthName)}),s=l.periods.some(i=>i.workItemId),r=ja(l.entityName),a=`/${t.length>0?t[0].year:2025}/${r}?search=${encodeURIComponent(l.companyName)}`;return e.jsx(fr,{children:e.jsxs(fe,{className:"hover:shadow-md transition-shadow",children:[e.jsx(_e,{className:"pb-2",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"space-y-1 min-w-0 flex-1",children:[e.jsx(de,{to:a,className:"font-semibold text-sm leading-tight text-blue-600 hover:text-blue-800 hover:underline block",title:`Ver detalles de ${l.companyName}`,children:l.companyName}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(H,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:l.entityName})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(Kt,{variant:"outline",className:"text-xs bg-blue-50 text-blue-700 border-blue-200 whitespace-nowrap",children:[l.pendingCount," per√≠odo",l.pendingCount!==1?"s":""]}),s&&e.jsxs(_t,{children:[e.jsx(kt,{asChild:!0,children:e.jsx("div",{className:"p-1",children:e.jsx(ke,{className:"h-3 w-3 text-blue-600"})})}),e.jsx(ct,{children:e.jsx("p",{children:"Contiene Work Items"})})]})]})]})}),e.jsx(be,{className:"space-y-2 pt-0",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-gray-700",children:[e.jsx(q,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{children:"Per√≠odos pendientes"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.map(i=>{const o=ye(i.estado),c=Te(i.estado),m=bt[i.estado]||i.estado;return e.jsxs(_t,{children:[e.jsx(kt,{asChild:!0,children:e.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-md text-xs ${o.bg} ${o.text} border cursor-default`,children:[e.jsx("span",{className:"text-xs",children:c}),e.jsx("span",{className:"font-medium",children:i.monthName}),e.jsx("span",{className:"text-xs opacity-75",children:i.year})]})}),e.jsx(ct,{children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"font-medium",children:[i.monthName," ",i.year]}),e.jsxs("p",{className:"text-xs",children:["Estado: ",m]})]})})]},`${i.year}-${i.monthName}`)})})]})})]})})}const jr=Lt("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),dt=x.forwardRef(({className:l,variant:t,...s},r)=>e.jsx("div",{ref:r,role:"alert",className:W(jr({variant:t}),l),...s}));dt.displayName="Alert";const yr=x.forwardRef(({className:l,...t},s)=>e.jsx("h5",{ref:s,className:W("mb-1 font-medium leading-none tracking-tight",l),...t}));yr.displayName="AlertTitle";const mt=x.forwardRef(({className:l,...t},s)=>e.jsx("div",{ref:s,className:W("text-sm [&_p]:leading-relaxed",l),...t}));mt.displayName="AlertDescription";function At(){const{groupedRequests:l,stats:t,selectedEntity:s,setSelectedEntity:r,selectedYear:n,setSelectedYear:a,searchTerm:i,setSearchTerm:o,statusFilter:c,setStatusFilter:m,isLoading:u,error:g,entities:d,allEntities:h,years:y,availableYears:C,statuses:p}=cr();return g?e.jsx("div",{className:"p-6",children:e.jsxs(dt,{variant:"destructive",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsxs(mt,{children:["Error al cargar los datos: ",g]})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Solicitudes Pendientes"}),e.jsx("p",{className:"text-gray-600",children:"Vista consolidada de todas las solicitudes no cerradas"}),d.length<h.length&&e.jsxs("p",{className:"text-sm text-amber-600 mt-1",children:["Mostrando datos de ",d.length," de ",h.length," entidades",n==="all"?` para ${C.length} a√±os`:` para el a√±o ${n}`]})]})}),!u&&d.length===0&&e.jsxs(dt,{children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx(mt,{children:n==="all"?"No hay datos disponibles para ning√∫n a√±o. Verifica que existan archivos de datos para las entidades.":`No hay datos disponibles para el a√±o ${n}. Intenta seleccionar un a√±o diferente o verifica que existan archivos de datos para las entidades.`})]}),e.jsx(xr,{stats:t,isLoading:u}),e.jsx(pr,{selectedEntity:s,setSelectedEntity:r,selectedYear:n,setSelectedYear:a,searchTerm:i,setSearchTerm:o,statusFilter:c,setStatusFilter:m,entities:d,years:y,availableYears:C,statuses:p}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Empresas con Solicitudes Pendientes (",l.length,")"]})}),u?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(es,{size:"lg"})}):l.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No se encontraron solicitudes pendientes con los filtros aplicados"})}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:l.map(f=>e.jsx(br,{groupedRequest:f},`${f.entityName}-${f.companyName}`))})]})]})}function Nr(l){const[t,s]=x.useState({companyName:l,operations:[],billingHistory:[],statistics:{totalRequests:0,completedRequests:0,averageProcessingDays:0,entitiesCount:0,operatingYears:[],recentActivity:[],completionRate:0},loading:!0,error:null});return x.useEffect(()=>{if(!l)return;(async()=>{try{s(h=>({...h,loading:!0,error:null}));const n=[],a=[],i=new Set,o={"Alcald√≠a de Palmira":"alcaldia-palmira","Alcald√≠a de Tulu√°":"alcaldia-tulua","Gobernaci√≥n del Valle del Cauca":"gobernacion-valle",Infibagu√©:"infibague"};for(const h of ce){const y=o[h];if(y)for(const C of["2017","2018","2019","2020","2021","2022","2023","2024","2025"])try{const j=(await Be(Object.assign({"../data/alcaldia-palmira/2017.json":()=>N(()=>import("./2017-BVOP-Wl2.js"),[]),"../data/alcaldia-palmira/2018.json":()=>N(()=>import("./2018-DZ1DG_5X.js"),[]),"../data/alcaldia-palmira/2019.json":()=>N(()=>import("./2019-CsKsMAR0.js"),[]),"../data/alcaldia-palmira/2020.json":()=>N(()=>import("./2020-BRZ26RQl.js"),[]),"../data/alcaldia-palmira/2021.json":()=>N(()=>import("./2021-DVztz28N.js"),[]),"../data/alcaldia-palmira/2022.json":()=>N(()=>import("./2022-C7X1vzRC.js"),[]),"../data/alcaldia-palmira/2023.json":()=>N(()=>import("./2023-3iXhSLrf.js"),[]),"../data/alcaldia-palmira/2024.json":()=>N(()=>import("./2024-C1DwArZ3.js"),[]),"../data/alcaldia-palmira/2025.json":()=>N(()=>import("./2025-ChyOB8kX.js"),[]),"../data/alcaldia-tulua/2017.json":()=>N(()=>import("./2017-BECROcFg.js"),[]),"../data/alcaldia-tulua/2018.json":()=>N(()=>import("./2018-0eCO8QOx.js"),[]),"../data/alcaldia-tulua/2019.json":()=>N(()=>import("./2019-C49KecLc.js"),[]),"../data/alcaldia-tulua/2020.json":()=>N(()=>import("./2020-DMf6FYnd.js"),[]),"../data/alcaldia-tulua/2021.json":()=>N(()=>import("./2021-DvqTzZPh.js"),[]),"../data/alcaldia-tulua/2022.json":()=>N(()=>import("./2022-CIvs88wj.js"),[]),"../data/alcaldia-tulua/2023.json":()=>N(()=>import("./2023-BeRqBxTJ.js"),[]),"../data/alcaldia-tulua/2024.json":()=>N(()=>import("./2024-V3Ks7LuK.js"),[]),"../data/alcaldia-tulua/2025.json":()=>N(()=>import("./2025-BlBWJeCc.js"),[]),"../data/gobernacion-valle/2017.json":()=>N(()=>import("./2017-RHIzOR10.js"),[]),"../data/gobernacion-valle/2018.json":()=>N(()=>import("./2018-DAcL6WxD.js"),[]),"../data/gobernacion-valle/2019.json":()=>N(()=>import("./2019-KKyEHg-1.js"),[]),"../data/gobernacion-valle/2020.json":()=>N(()=>import("./2020-DLSyYBua.js"),[]),"../data/gobernacion-valle/2021.json":()=>N(()=>import("./2021-CTNt0CSD.js"),[]),"../data/gobernacion-valle/2022.json":()=>N(()=>import("./2022-CO3HVyE6.js"),[]),"../data/gobernacion-valle/2023.json":()=>N(()=>import("./2023-DpQun6Of.js"),[]),"../data/gobernacion-valle/2024.json":()=>N(()=>import("./2024-C85h5RGw.js"),[]),"../data/gobernacion-valle/2025.json":()=>N(()=>import("./2025-HUFIYlkh.js"),[]),"../data/infibague/2021.json":()=>N(()=>import("./2021-B9Xfz2lF.js"),[]),"../data/infibague/2022.json":()=>N(()=>import("./2022-D-GZ4eF1.js"),[]),"../data/infibague/2023.json":()=>N(()=>import("./2023-DyQgsWQS.js"),[]),"../data/infibague/2024.json":()=>N(()=>import("./2024-DLtBQgoW.js"),[]),"../data/infibague/2025.json":()=>N(()=>import("./2025-Ad051HOY.js"),[])}),`../data/${y}/${C}.json`,4)).default[l];if(j){i.add(C);const _=j._metadata||{};n.push({entity:h,year:C,relationshipType:_.tipoEmpresa||"Desconocido",isIncumbent:_.esIncumbente||!1,userCount:_.usuariosCount});for(const R of U){const E=j[R];E&&a.push({entity:h,year:C,month:R,workItemId:E.workItemId,estado:E.estado||"Sin Solicitud",fechaRecibido:E.fechaRecibido,fechaCerrado:E.fechaCerrado,diasProcesamiento:E.diasProcesamiento,notas:E.notas||""})}}}catch{continue}}const c=a.filter(h=>h.estado==="Closed").length,m=a.filter(h=>h.diasProcesamiento),u=m.length>0?m.reduce((h,y)=>h+(y.diasProcesamiento||0),0)/m.length:0,g=a.filter(h=>h.fechaRecibido).sort((h,y)=>new Date(y.fechaRecibido).getTime()-new Date(h.fechaRecibido).getTime()).slice(0,10),d={totalRequests:a.length,completedRequests:c,averageProcessingDays:Math.round(u),entitiesCount:new Set(n.map(h=>h.entity)).size,operatingYears:Array.from(i).sort(),recentActivity:g,completionRate:a.length>0?c/a.length*100:0};s({companyName:l,operations:n,billingHistory:a,statistics:d,loading:!1,error:null})}catch(n){s(a=>({...a,loading:!1,error:n instanceof Error?n.message:"Error loading company data"}))}})()},[l]),t}function vr(){const{companyName:l}=xt(),t=l?decodeURIComponent(l):"",s=Nr(t);if(s.loading)return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs(de,{to:"/",className:"flex items-center text-blue-600 hover:text-blue-800",children:[e.jsx(je,{className:"h-5 w-5 mr-2"}),"Volver al Dashboard"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Cargando perfil de empresa..."})]})]});if(s.error||s.operations.length===0)return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs(de,{to:"/",className:"flex items-center text-blue-600 hover:text-blue-800",children:[e.jsx(je,{className:"h-5 w-5 mr-2"}),"Volver al Dashboard"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-8 text-center",children:[e.jsx(oe,{className:"h-12 w-12 text-yellow-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Empresa no encontrada"}),e.jsxs("p",{className:"text-gray-600",children:['No se encontraron datos para la empresa "',t,'"']})]})]});const{statistics:r,operations:n}=s;return e.jsxs("div",{className:"p-6 w-full",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs(de,{to:"/",className:"flex items-center text-blue-600 hover:text-blue-800",children:[e.jsx(je,{className:"h-5 w-5 mr-2"}),"Volver al Dashboard"]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg p-8 mb-8",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(H,{className:"h-8 w-8"}),e.jsx("h1",{className:"text-3xl font-bold",children:t})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-200 text-sm",children:"Entidades"}),e.jsx("p",{className:"text-2xl font-bold",children:r.entitiesCount})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-200 text-sm",children:"A√±os Activos"}),e.jsx("p",{className:"text-2xl font-bold",children:r.operatingYears.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-200 text-sm",children:"Solicitudes Totales"}),e.jsx("p",{className:"text-2xl font-bold",children:r.totalRequests})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-200 text-sm",children:"Tasa de Completitud"}),e.jsxs("p",{className:"text-2xl font-bold",children:[r.completionRate.toFixed(1),"%"]})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(te,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Solicitudes Completadas"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:r.completedRequests})]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["de ",r.totalRequests," solicitudes totales"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(me,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Tiempo Promedio"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:r.averageProcessingDays})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"d√≠as de procesamiento"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(q,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Per√≠odo de Operaci√≥n"}),e.jsxs("p",{className:"text-xl font-bold text-purple-600",children:[r.operatingYears[0]," - ",r.operatingYears[r.operatingYears.length-1]]})]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r.operatingYears.length," a√±os activos"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border mb-8",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(zt,{className:"h-6 w-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Operaciones por Entidad"})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"grid gap-4",children:n.reduce((a,i)=>{const o=a.find(c=>c.entity===i.entity);return o?(o.years.push(i.year),i.relationshipType!=="Desconocido"&&(o.relationshipType=i.relationshipType),i.isIncumbent&&(o.isIncumbent=i.isIncumbent),i.userCount&&(o.userCount=i.userCount)):a.push({entity:i.entity,years:[i.year],relationshipType:i.relationshipType,isIncumbent:i.isIncumbent,userCount:i.userCount}),a},[]).map((a,i)=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-lg",children:a.entity}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.isIncumbent&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full font-medium",children:"Incumbente"}),e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full font-medium",children:a.relationshipType})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{children:[e.jsx(q,{className:"h-4 w-4 inline mr-1"}),"A√±os: ",a.years.sort().join(", ")]}),a.userCount&&e.jsxs("span",{children:[e.jsx(ze,{className:"h-4 w-4 inline mr-1"}),a.userCount.toLocaleString()," usuarios"]})]})]},i))})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ne,{className:"h-6 w-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Actividad Reciente"})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:r.recentActivity.slice(0,10).map((a,i)=>{const o=ye(a.estado);return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[a.month," ",a.year]}),e.jsx("p",{className:"text-sm text-gray-600",children:a.entity})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${o.bg} ${o.text}`,title:a.estado,children:yt(a.estado)})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600",children:[a.fechaRecibido&&e.jsxs("p",{children:["Recibido: ",new Date(a.fechaRecibido).toLocaleDateString()]}),a.diasProcesamiento&&e.jsxs("p",{children:["Procesado en ",a.diasProcesamiento," d√≠as"]}),a.workItemId&&e.jsxs("p",{className:"text-blue-600",children:["ID: ",a.workItemId]})]})]},i)})})})]})]})}class wr{cache=new Map;loadingPromises=new Map;TTL=300*1e3;async getData(t,s,r=!1){if(!r&&this.hasValidCache(t))return this.cache.get(t).data;if(this.loadingPromises.has(t)){const a=this.loadingPromises.get(t);if(Date.now()-a.timestamp<1e4)return a.promise;this.loadingPromises.delete(t)}const n=this.loadData(t,s);this.loadingPromises.set(t,{promise:n,timestamp:Date.now()});try{const a=await n;return this.loadingPromises.delete(t),a}catch(a){throw this.loadingPromises.delete(t),a}}async loadData(t,s){try{const r=await s();return this.cache.set(t,{data:r,timestamp:Date.now()}),r}catch(r){throw this.cache.delete(t),r}}hasValidCache(t){const s=this.cache.get(t);return s?Date.now()-s.timestamp>this.TTL?(this.cache.delete(t),!1):!0:!1}async getEntityYearData(t,s){const n={"alcaldia-palmira":"alcaldia-palmira","alcaldia-tulua":"alcaldia-tulua","gobernacion-valle":"gobernacion-valle",infibague:"infibague"}[t];if(!n)throw new Error(`Unknown entity: ${t}`);const a=`entity-${n}-${s}`;try{return await this.getData(a,async()=>{try{return(await Be(Object.assign({"../data/alcaldia-palmira/2017.json":()=>N(()=>import("./2017-BVOP-Wl2.js"),[]),"../data/alcaldia-palmira/2018.json":()=>N(()=>import("./2018-DZ1DG_5X.js"),[]),"../data/alcaldia-palmira/2019.json":()=>N(()=>import("./2019-CsKsMAR0.js"),[]),"../data/alcaldia-palmira/2020.json":()=>N(()=>import("./2020-BRZ26RQl.js"),[]),"../data/alcaldia-palmira/2021.json":()=>N(()=>import("./2021-DVztz28N.js"),[]),"../data/alcaldia-palmira/2022.json":()=>N(()=>import("./2022-C7X1vzRC.js"),[]),"../data/alcaldia-palmira/2023.json":()=>N(()=>import("./2023-3iXhSLrf.js"),[]),"../data/alcaldia-palmira/2024.json":()=>N(()=>import("./2024-C1DwArZ3.js"),[]),"../data/alcaldia-palmira/2025.json":()=>N(()=>import("./2025-ChyOB8kX.js"),[]),"../data/alcaldia-tulua/2017.json":()=>N(()=>import("./2017-BECROcFg.js"),[]),"../data/alcaldia-tulua/2018.json":()=>N(()=>import("./2018-0eCO8QOx.js"),[]),"../data/alcaldia-tulua/2019.json":()=>N(()=>import("./2019-C49KecLc.js"),[]),"../data/alcaldia-tulua/2020.json":()=>N(()=>import("./2020-DMf6FYnd.js"),[]),"../data/alcaldia-tulua/2021.json":()=>N(()=>import("./2021-DvqTzZPh.js"),[]),"../data/alcaldia-tulua/2022.json":()=>N(()=>import("./2022-CIvs88wj.js"),[]),"../data/alcaldia-tulua/2023.json":()=>N(()=>import("./2023-BeRqBxTJ.js"),[]),"../data/alcaldia-tulua/2024.json":()=>N(()=>import("./2024-V3Ks7LuK.js"),[]),"../data/alcaldia-tulua/2025.json":()=>N(()=>import("./2025-BlBWJeCc.js"),[]),"../data/gobernacion-valle/2017.json":()=>N(()=>import("./2017-RHIzOR10.js"),[]),"../data/gobernacion-valle/2018.json":()=>N(()=>import("./2018-DAcL6WxD.js"),[]),"../data/gobernacion-valle/2019.json":()=>N(()=>import("./2019-KKyEHg-1.js"),[]),"../data/gobernacion-valle/2020.json":()=>N(()=>import("./2020-DLSyYBua.js"),[]),"../data/gobernacion-valle/2021.json":()=>N(()=>import("./2021-CTNt0CSD.js"),[]),"../data/gobernacion-valle/2022.json":()=>N(()=>import("./2022-CO3HVyE6.js"),[]),"../data/gobernacion-valle/2023.json":()=>N(()=>import("./2023-DpQun6Of.js"),[]),"../data/gobernacion-valle/2024.json":()=>N(()=>import("./2024-C85h5RGw.js"),[]),"../data/gobernacion-valle/2025.json":()=>N(()=>import("./2025-HUFIYlkh.js"),[]),"../data/infibague/2021.json":()=>N(()=>import("./2021-B9Xfz2lF.js"),[]),"../data/infibague/2022.json":()=>N(()=>import("./2022-D-GZ4eF1.js"),[]),"../data/infibague/2023.json":()=>N(()=>import("./2023-DyQgsWQS.js"),[]),"../data/infibague/2024.json":()=>N(()=>import("./2024-DLtBQgoW.js"),[]),"../data/infibague/2025.json":()=>N(()=>import("./2025-Ad051HOY.js"),[])}),`../data/${n}/${s}.json`,4)).default}catch{return null}})}catch(i){return console.warn(`Failed to load ${t}/${s}:`,i),null}}async getEntityMultiYearData(t,s){const r=s.map(i=>this.getEntityYearData(t,i).then(o=>({year:i,data:o}))),n=await Promise.all(r),a=new Map;return n.forEach(({year:i,data:o})=>{o&&a.set(i,o)}),a}async getEntityAllYears(t){const s=["2017","2018","2019","2020","2021","2022","2023","2024","2025"];return this.getEntityMultiYearData(t,s)}async preloadRecentData(t){const s=["2023","2024","2025"];await this.getEntityMultiYearData(t,s)}clearCache(t){if(t)for(const s of this.cache.keys())s.includes(t)&&this.cache.delete(s);else this.cache.clear();this.loadingPromises.clear()}getCacheStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys()),hitRate:0}}async getAllCompaniesData(){const t={"Alcald√≠a de Palmira":"alcaldia-palmira","Alcald√≠a de Tulu√°":"alcaldia-tulua","Gobernaci√≥n del Valle del Cauca":"gobernacion-valle",Infibagu√©:"infibague"},r=Object.keys(t).map(async i=>{const o=t[i],c=await this.getEntityAllYears(o);return{entity:i,yearData:c}}),n=await Promise.all(r),a=new Map;return n.forEach(({entity:i,yearData:o})=>{a.set(i,o)}),a}}const rs=new wr,Rt={"alcaldia-palmira":"alcaldia-palmira","alcaldia-tulua":"alcaldia-tulua","gobernacion-valle":"gobernacion-valle",infibague:"infibague"};function Cr(l){const[t,s]=x.useState(null),[r,n]=x.useState([]),[a,i]=x.useState(new Map),[o,c]=x.useState(new Set),[m,u]=x.useState(!0),[g,d]=x.useState(null),h=x.useMemo(()=>({"alcaldia-palmira":"Alcald√≠a de Palmira","alcaldia-tulua":"Alcald√≠a de Tulu√°","gobernacion-valle":"Gobernaci√≥n del Valle del Cauca",infibague:"Infibagu√©"}),[]),y=x.useCallback(async _=>{if(!(!l||!Rt[l]))try{const R=await rs.getEntityMultiYearData(l,_);i(E=>{const v=new Map(E);return R.forEach((b,S)=>{v.set(S,b)}),v}),n(E=>{const v=_.filter(S=>R.has(S));return[...new Set([...E,...v])].sort()}),c(E=>{const v=new Set(E);return R.forEach(b=>{Object.keys(b).forEach(S=>v.add(S))}),v})}catch(R){console.error("Failed to load years data:",R)}},[l]);x.useEffect(()=>{if(!l||!Rt[l]){d("Entidad no encontrada"),u(!1);return}(async()=>{try{u(!0),d(null),await y(["2023","2024","2025"])}catch(R){d(R instanceof Error?R.message:"Error loading historical data")}finally{u(!1)}})()},[l,y]);const C=x.useCallback(async _=>{const R=_.filter(E=>!r.includes(E));R.length>0&&await y(R)},[r,y]),p=x.useMemo(()=>{if(r.length===0)return{historicalMatrix:[],missingReports:[],totalStatistics:{totalRequests:0,completedRequests:0,averageCompletionRate:0,yearsActive:0,companiesServed:0}};const _=[],R=[];let E=0,v=0;for(let S=0;S<U.length;S++){const D=[],w=U[S];for(const A of r){const T=a.get(A),M=[];let z=0,k=0,L=0;Array.from(o).forEach(F=>{const V=T?.[F]?.[w];if(V){const Z=V.estado||"Sin Solicitud",G=Z==="Closed";M.push({companyName:F,estado:Z,workItemId:V.workItemId,fechaRecibido:V.fechaRecibido,fechaCerrado:V.fechaCerrado,diasProcesamiento:V.diasProcesamiento,isMissing:!1}),E++,G?(z++,v++):Z!=="Sin Solicitud"&&k++}else M.push({companyName:F,estado:"Sin Solicitud",isMissing:!0}),L++}),L>M.length*.5?R.push({year:A,month:w,severity:"error",message:`M√°s del 50% de empresas sin reportar en ${w} ${A}`,companiesCount:L}):L>M.length*.2&&R.push({year:A,month:w,severity:"warning",message:`${L} empresas sin reportar en ${w} ${A}`,companiesCount:L}),D.push({year:A,month:w,companies:M,totalCompanies:M.length,completedCompanies:z,pendingCompanies:k,missingCompanies:L})}_.push(D)}const b=R.sort((S,D)=>S.severity==="error"&&D.severity!=="error"?-1:S.severity!=="error"&&D.severity==="error"?1:D.companiesCount-S.companiesCount);return{historicalMatrix:_,missingReports:b,totalStatistics:{totalRequests:E,completedRequests:v,averageCompletionRate:E>0?v/E*100:0,yearsActive:r.length,companiesServed:o.size}}},[r,a,o]),f=p.missingReports.filter(_=>_.severity==="error").length,j=p.missingReports.filter(_=>_.severity==="warning").length;return{entityName:h[l]||l,years:r,historicalMatrix:p.historicalMatrix,missingReports:p.missingReports,totalStatistics:p.totalStatistics,selectedPeriod:t,setSelectedPeriod:s,criticalAlertsCount:f,warningAlertsCount:j,loading:m,error:g,loadMoreYears:C,loadedYears:r}}function Dr(){const{entitySlug:l}=xt(),t=Cr(l||"");if(t.loading)return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs(de,{to:"/",className:"flex items-center text-blue-600 hover:text-blue-800",children:[e.jsx(je,{className:"h-5 w-5 mr-2"}),"Volver al Dashboard"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Cargando datos hist√≥ricos..."})]})]});if(t.error)return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs(de,{to:"/",className:"flex items-center text-blue-600 hover:text-blue-800",children:[e.jsx(je,{className:"h-5 w-5 mr-2"}),"Volver al Dashboard"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-8 text-center",children:[e.jsx(oe,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error al cargar datos"}),e.jsx("p",{className:"text-gray-600",children:t.error})]})]});const{entityName:s,years:r,historicalMatrix:n,totalStatistics:a,selectedPeriod:i,setSelectedPeriod:o,criticalAlertsCount:c,warningAlertsCount:m}=t;return e.jsxs("div",{className:"p-6 max-w-full mx-auto",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs(de,{to:"/",className:"flex items-center text-blue-600 hover:text-blue-800",children:[e.jsx(je,{className:"h-5 w-5 mr-2"}),"Volver al Dashboard"]})}),e.jsx("div",{className:"bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["Hist√≥rico - ",s]}),e.jsx("div",{className:"flex items-center gap-6 mt-2 text-sm",children:e.jsxs("span",{children:[a.yearsActive," a√±os ‚Ä¢ ",a.companiesServed," empresas ‚Ä¢ ",a.totalRequests," solicitudes"]})})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[c>0&&e.jsxs("div",{className:"flex items-center gap-2 bg-red-500/20 border border-red-300 rounded-full px-3 py-1",children:[e.jsx(ne,{className:"h-4 w-4 text-red-200"}),e.jsxs("span",{className:"text-sm font-medium",children:[c," cr√≠tico",c!==1?"s":""]})]}),m>0&&e.jsxs("div",{className:"flex items-center gap-2 bg-yellow-500/20 border border-yellow-300 rounded-full px-3 py-1",children:[e.jsx(Js,{className:"h-4 w-4 text-yellow-200"}),e.jsxs("span",{className:"text-sm font-medium",children:[m," alerta",m!==1?"s":""]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-xl font-bold",children:[a.averageCompletionRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-green-200",children:"completitud"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsx("div",{className:"xl:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ne,{className:"h-5 w-5 text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold",children:"Matriz Hist√≥rica"})]}),e.jsx("div",{className:"text-sm text-gray-500",children:i?"Click en otra celda para cambiar per√≠odo":"Click en una celda para ver detalle"})]})}),e.jsx("div",{className:"p-4 overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 border-b font-semibold bg-gray-50 sticky left-0 text-sm",children:"Mes"}),r.map(u=>e.jsx("th",{className:"text-center p-2 border-b font-semibold bg-gray-50 min-w-[100px] text-sm",children:u},u))]})}),e.jsx("tbody",{children:n.map((u,g)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 border-b font-medium sticky left-0 bg-white border-r text-sm",children:u[0]?.month||""}),u.map((d,h)=>{const y=d.totalCompanies>0?d.completedCompanies/d.totalCompanies*100:0;let C="bg-gray-100 hover:bg-gray-200";y>=80?C="bg-green-100 hover:bg-green-200":y>=60?C="bg-yellow-100 hover:bg-yellow-200":y>=40?C="bg-orange-100 hover:bg-orange-200":y>0&&(C="bg-red-100 hover:bg-red-200");const p=i?.year===r[h]&&i?.month===u[0]?.month;return e.jsx("td",{className:`p-2 border-b text-center cursor-pointer transition-colors ${C} ${p?"ring-2 ring-blue-500 ring-inset":""}`,onClick:()=>o({year:r[h],month:u[0]?.month||"",yearData:d}),children:e.jsxs("div",{className:"text-xs",children:[e.jsxs("div",{className:"font-semibold",children:[d.completedCompanies,"/",d.totalCompanies]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[y.toFixed(0),"%"]}),d.missingCompanies>0&&e.jsx(oe,{className:"h-3 w-3 text-red-500 mx-auto mt-1"})]})},h)})]},g))})]})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-100 border rounded"}),e.jsx("span",{children:"‚â•80%"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-100 border rounded"}),e.jsx("span",{children:"60-79%"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-100 border rounded"}),e.jsx("span",{children:"40-59%"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-100 border rounded"}),e.jsx("span",{children:"<40%"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-100 border rounded"}),e.jsx("span",{children:"Sin datos"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"h-3 w-3 text-red-500"}),e.jsx("span",{children:"Alertas"})]})]})})]})}),e.jsx("div",{className:"xl:col-span-1",children:e.jsx("div",{className:"bg-white rounded-lg shadow-sm border h-fit",children:i?e.jsxs("div",{children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(H,{className:"h-5 w-5 text-blue-600"}),e.jsxs("h3",{className:"text-lg font-semibold",children:[i.month," ",i.year]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-green-600",children:i.yearData.completedCompanies}),e.jsx("div",{className:"text-gray-500",children:"Completadas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-orange-600",children:i.yearData.pendingCompanies}),e.jsx("div",{className:"text-gray-500",children:"Pendientes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-red-600",children:i.yearData.missingCompanies}),e.jsx("div",{className:"text-gray-500",children:"Sin reportar"})]})]})]}),e.jsx("div",{className:"p-4 max-h-96 overflow-y-auto",children:e.jsx("div",{className:"space-y-2",children:i.yearData.companies.sort((u,g)=>u.isMissing&&!g.isMissing?1:!u.isMissing&&g.isMissing||u.estado==="Closed"&&g.estado!=="Closed"?-1:u.estado!=="Closed"&&g.estado==="Closed"?1:u.companyName.localeCompare(g.companyName)).map((u,g)=>{const d=ye(u.estado);return e.jsxs("div",{className:"border rounded p-3 hover:bg-gray-50",children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-sm truncate",title:u.companyName,children:u.companyName}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${d.bg} ${d.text}`,title:u.estado,children:yt(u.estado)}),u.workItemId&&e.jsxs("span",{className:"text-xs text-gray-500",children:["#",u.workItemId]})]})]})}),u.fechaRecibido&&e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:[e.jsxs("div",{children:["Recibido: ",new Date(u.fechaRecibido).toLocaleDateString()]}),u.fechaCerrado&&e.jsxs("div",{children:["Cerrado: ",new Date(u.fechaCerrado).toLocaleDateString()]}),u.diasProcesamiento&&e.jsxs("div",{children:["Procesado en ",u.diasProcesamiento," d√≠as"]})]}),u.isMissing&&e.jsxs("div",{className:"text-xs text-red-600 mt-2 flex items-center gap-1",children:[e.jsx(oe,{className:"h-3 w-3"}),"Sin reportar"]})]},g)})})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsx("button",{onClick:()=>o(null),className:"w-full text-sm text-gray-600 hover:text-gray-800",children:"Cerrar detalle"})})]}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(ke,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Selecciona un Per√≠odo"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Haz click en cualquier celda de la matriz para ver el detalle de empresas para ese mes y a√±o."})]})})})]})]})}function Sr(){const[l,t]=x.useState([]),[s,r]=x.useState(""),[n,a]=x.useState(""),[i,o]=x.useState("name"),[c,m]=x.useState("asc"),[u,g]=x.useState(!0),[d,h]=x.useState(null),[y,C]=x.useState(0),[p,f]=x.useState(0),[j]=x.useState(ce.length),_=x.useCallback(async()=>{try{g(!0),h(null),C(0),f(0);const v=new Map,b={"Alcald√≠a de Palmira":"alcaldia-palmira","Alcald√≠a de Tulu√°":"alcaldia-tulua","Gobernaci√≥n del Valle del Cauca":"gobernacion-valle",Infibagu√©:"infibague"};for(let D=0;D<ce.length;D++){const w=ce[D],A=b[w];if(A){try{const T=A;(await rs.getEntityAllYears(T)).forEach((z,k)=>{Object.entries(z).forEach(([L,F])=>{v.has(L)||v.set(L,{entities:new Set,years:new Set,totalRequests:0,completedRequests:0,pendingRequests:0,processingDays:[],criticalAlerts:0,warningAlerts:0,isIncumbent:!1,entityOperations:new Map});const I=v.get(L);I.entities.add(w),I.years.add(k),(F._metadata||{}).esIncumbente&&(I.isIncumbent=!0),I.entityOperations.has(w)||I.entityOperations.set(w,{years:new Set,completed:0,total:0});const Z=I.entityOperations.get(w);Z.years.add(k);let G=0,$=0,ae=0;U.forEach(ie=>{const ue=F[ie];if(ue){I.totalRequests++,$++;const xe=ue.estado||"Sin Solicitud";if(xe==="Closed"?(I.completedRequests++,G++):xe!=="Sin Solicitud"&&I.pendingRequests++,ue.diasProcesamiento&&I.processingDays.push(ue.diasProcesamiento),ue.fechaRecibido){const Ae=new Date(ue.fechaRecibido);(!I.lastActivity||Ae>new Date(I.lastActivity))&&(I.lastActivity=ue.fechaRecibido)}}else ae++}),Z.completed+=G,Z.total+=$;const re=U.length,le=ae/re*100;le>50?I.criticalAlerts++:le>20&&I.warningAlerts++})})}catch(T){console.warn(`Failed to load entity ${w}:`,T)}f(D+1),C((D+1)/ce.length*100),await new Promise(T=>setTimeout(T,0))}}const S=Array.from(v.entries()).map(([D,w])=>{const A=w.totalRequests>0?w.completedRequests/w.totalRequests*100:0,T=w.processingDays.length>0?w.processingDays.reduce((z,k)=>z+k,0)/w.processingDays.length:0,M=Array.from(w.entityOperations.entries()).map(([z,k])=>{const L=k.total>0?k.completed/k.total*100:0;let F="excellent";return L<40?F="critical":L<60?F="warning":L<80&&(F="good"),{entity:z,years:Array.from(k.years).sort(),completionRate:L,status:F}});return{name:D,entities:Array.from(w.entities),years:Array.from(w.years).sort(),totalRequests:w.totalRequests,completedRequests:w.completedRequests,completionRate:A,pendingRequests:w.pendingRequests,averageProcessingDays:Math.round(T),criticalAlertsCount:w.criticalAlerts,warningAlertsCount:w.warningAlerts,lastActivity:w.lastActivity,isIncumbent:w.isIncumbent,entityOperations:M}});t(S)}catch(v){h(v instanceof Error?v.message:"Error loading companies data")}finally{g(!1),C(100)}},[]);x.useEffect(()=>{_()},[_]);const R=x.useMemo(()=>{let v=l;return s&&(v=v.filter(b=>b.name.toLowerCase().includes(s.toLowerCase()))),n&&(v=v.filter(b=>b.entities.includes(n))),v.sort((b,S)=>{let D,w;switch(i){case"completionRate":D=b.completionRate,w=S.completionRate;break;case"totalRequests":D=b.totalRequests,w=S.totalRequests;break;case"criticalAlerts":D=b.criticalAlertsCount,w=S.criticalAlertsCount;break;default:D=b.name.toLowerCase(),w=S.name.toLowerCase()}if(typeof D=="string"&&typeof w=="string")return c==="asc"?D.localeCompare(w):w.localeCompare(D);{const A=D,T=w;return c==="asc"?A-T:T-A}}),v},[l,s,n,i,c]),E=x.useMemo(()=>{const v=l.reduce((w,A)=>w+A.totalRequests,0),b=l.reduce((w,A)=>w+A.completedRequests,0),S=l.length>0?l.reduce((w,A)=>w+A.completionRate,0)/l.length:0,D=l.filter(w=>w.criticalAlertsCount>0||w.warningAlertsCount>0).length;return{avgCompletionRate:S,totalRequests:v,totalCompletedRequests:b,companiesWithAlerts:D}},[l]);return{companies:l,filteredCompanies:R,searchTerm:s,setSearchTerm:r,selectedEntity:n,setSelectedEntity:a,sortBy:i,setSortBy:o,sortOrder:c,setSortOrder:m,totalCompanies:l.length,totalStatistics:E,loading:u,error:d,loadingProgress:y,loadedEntitiesCount:p,totalEntitiesCount:j}}function Er({company:l}){const t=r=>{switch(r){case"excellent":return e.jsx(we,{className:"h-4 w-4 text-green-500"});case"good":return e.jsx(we,{className:"h-4 w-4 text-blue-500"});case"warning":return e.jsx(oe,{className:"h-4 w-4 text-yellow-500"});case"critical":return e.jsx(ne,{className:"h-4 w-4 text-red-500"});default:return null}},s=r=>{switch(r){case"excellent":return"text-green-600 bg-green-50 border-green-200";case"good":return"text-blue-600 bg-blue-50 border-blue-200";case"warning":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"critical":return"text-red-600 bg-red-50 border-red-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}};return e.jsxs("div",{className:"bg-white rounded-lg border hover:shadow-md transition-shadow p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(H,{className:"h-5 w-5 text-blue-600 flex-shrink-0"}),e.jsx("h3",{className:"text-lg font-semibold truncate",title:l.name,children:l.name}),l.isIncumbent&&e.jsx(He,{className:"h-4 w-4 text-yellow-500 flex-shrink-0",fill:"currentColor"})]}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-4",children:[e.jsxs("span",{children:[l.entities.length," entidad",l.entities.length!==1?"es":""]}),e.jsxs("span",{children:[l.years.length," a√±o",l.years.length!==1?"s":""]}),e.jsxs("span",{children:[l.totalRequests," solicitudes"]})]})]}),e.jsxs(de,{to:`/empresa/${encodeURIComponent(l.name)}`,className:"flex items-center gap-2 px-3 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex-shrink-0",children:[e.jsx(Ve,{className:"h-4 w-4"}),"Ver Perfil"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Tasa de Completitud"}),e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:[l.completionRate.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(l.completionRate,100)}%`}})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Operaciones por Entidad"}),e.jsx("div",{className:"space-y-2",children:l.entityOperations.map((r,n)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t(r.status),e.jsx("span",{className:"truncate",children:r.entity})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs border ${s(r.status)}`,children:[r.completionRate.toFixed(0),"%"]}),e.jsxs("span",{className:"text-gray-500 text-xs",children:[r.years.length," a√±o",r.years.length!==1?"s":""]})]})]},n))})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 pt-3 border-t",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[l.criticalAlertsCount>0&&e.jsxs("span",{className:"flex items-center gap-1 text-red-600",children:[e.jsx(ne,{className:"h-4 w-4"}),l.criticalAlertsCount," cr√≠tico",l.criticalAlertsCount!==1?"s":""]}),l.warningAlertsCount>0&&e.jsxs("span",{className:"flex items-center gap-1 text-yellow-600",children:[e.jsx(oe,{className:"h-4 w-4"}),l.warningAlertsCount," alerta",l.warningAlertsCount!==1?"s":""]}),l.criticalAlertsCount===0&&l.warningAlertsCount===0&&e.jsxs("span",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(we,{className:"h-4 w-4"}),"Sin alertas"]})]}),e.jsxs("div",{className:"text-right",children:[l.averageProcessingDays>0&&e.jsxs("div",{children:[l.averageProcessingDays," d√≠as promedio"]}),l.lastActivity&&e.jsxs("div",{className:"text-xs text-gray-400",children:["√öltima actividad: ",new Date(l.lastActivity).toLocaleDateString()]})]})]})]})}function _r(){const{filteredCompanies:l,searchTerm:t,setSearchTerm:s,selectedEntity:r,setSelectedEntity:n,sortBy:a,setSortBy:i,sortOrder:o,setSortOrder:c,totalCompanies:m,totalStatistics:u,loading:g,error:d,loadingProgress:h,loadedEntitiesCount:y,totalEntitiesCount:C}=Sr(),p=f=>{a===f?c(o==="asc"?"desc":"asc"):(i(f),c("asc"))};return g?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Cargando empresas de energ√≠a..."}),e.jsxs("div",{className:"mt-6 max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 mb-2",children:[e.jsxs("span",{children:["Procesando entidades (",y,"/",C,")"]}),e.jsxs("span",{children:[Math.round(h),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${h}%`}})})]})]})}):d?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-8 text-center",children:[e.jsx(oe,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error al cargar datos"}),e.jsx("p",{className:"text-gray-600",children:d})]})}):e.jsxs("div",{className:"p-6 w-full",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(H,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Empresas de Energ√≠a"}),e.jsx("p",{className:"text-gray-600",children:"Directorio completo de empresas en el sistema"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:m}),e.jsx("div",{className:"text-sm text-gray-600",children:"Empresas totales"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ne,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[u.avgCompletionRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Completitud promedio"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(we,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:u.totalCompletedRequests.toLocaleString()}),e.jsx("div",{className:"text-sm text-gray-600",children:"Solicitudes completadas"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"h-8 w-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:u.companiesWithAlerts}),e.jsx("div",{className:"text-sm text-gray-600",children:"Con alertas"})]})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border p-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ht,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar empresas...",value:t,onChange:f=>s(f.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4 text-gray-400"}),e.jsxs("select",{value:r,onChange:f=>n(f.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todas las entidades"}),ce.map(f=>e.jsx("option",{value:f,children:f},f))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Ordenar por:"}),e.jsx("div",{className:"flex gap-1",children:[{key:"name",label:"Nombre"},{key:"completionRate",label:"Completitud"},{key:"totalRequests",label:"Solicitudes"},{key:"criticalAlerts",label:"Alertas"}].map(f=>e.jsxs("button",{onClick:()=>p(f.key),className:`px-3 py-2 text-sm rounded-lg border transition-colors flex items-center gap-1 ${a===f.key?"bg-blue-100 text-blue-700 border-blue-300":"bg-white text-gray-600 border-gray-300 hover:bg-gray-50"}`,children:[f.label,a===f.key&&(o==="asc"?e.jsx(Qs,{className:"h-3 w-3"}):e.jsx(Xs,{className:"h-3 w-3"}))]},f.key))})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t text-sm text-gray-600",children:["Mostrando ",l.length," de ",m," empresas",t&&e.jsxs("span",{className:"ml-2",children:['‚Ä¢ B√∫squeda: "',e.jsx("span",{className:"font-medium",children:t}),'"']}),r&&e.jsxs("span",{className:"ml-2",children:["‚Ä¢ Entidad: ",e.jsx("span",{className:"font-medium",children:r})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:l.map((f,j)=>e.jsx(Er,{company:f},j))}),l.length===0&&e.jsxs("div",{className:"bg-white rounded-lg border p-12 text-center",children:[e.jsx(H,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No se encontraron empresas"}),e.jsx("p",{className:"text-gray-600 mb-4",children:t||r?"Intenta ajustar los filtros de b√∫squeda.":"No hay empresas disponibles en el sistema."}),(t||r)&&e.jsx("button",{onClick:()=>{s(""),n("")},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Limpiar filtros"})]})]})}class It{static async generateDemandMetrics(t){const s=await this.loadFilteredRequests(t),r=this.calculateDateRange(s,t),n=this.calculateDailyDistribution(s),a=this.calculateMonthlyDistribution(s),i=this.calculateWeekdayDistribution(s),o=this.findPeakDays(n),c=this.calculateTrends(s,r),m=this.calculateEntityBreakdown(s),u=this.calculateCompanyBreakdown(s),g=s.length,d=this.getDaysDifference(r.start,r.end)||1,h=g/d,y=g/Math.max(1,this.getMonthsDifference(r.start,r.end));return{totalRequests:g,dateRange:r,dailyAverage:h,monthlyAverage:y,dailyDistribution:n,monthlyDistribution:a,weekdayDistribution:i,peakDays:o,trends:c,entityBreakdown:m,companyBreakdown:u}}static async generateHeatMapData(t,s,r){const a=(await this.loadFilteredRequests(r)).filter(c=>{const m=new Date(c.receivedDate);return m.getFullYear()===t&&m.getMonth()===s-1}),i=this.generateCalendarCells(t,s,a),o=Math.max(...i.map(c=>c.count),1);return{year:t,month:s,cells:i,maxCount:o,totalRequests:a.length,averagePerDay:a.length/i.length}}static AVAILABLE_FILES=new Map([["Alcald√≠a de Palmira",[2017,2018,2019,2020,2021,2022,2023,2024,2025]],["Alcald√≠a de Tulu√°",[2017,2018,2019,2020,2021,2022,2023,2024,2025]],["Gobernaci√≥n del Valle del Cauca",[2017,2018,2019,2020,2021,2022,2023,2024,2025]],["Infibagu√©",[2023,2024,2025]]]);static async loadFilteredRequests(t){const s=[],r=t.entities.length>0?t.entities:ce,n=t.years.length>0?t.years:[2017,2018,2019,2020,2021,2022,2023,2024,2025];for(const a of r){const i=this.AVAILABLE_FILES.get(a)||[],o=n.filter(c=>i.includes(c));for(const c of o)try{const m=await B.loadDataForEntityYear(a,c),u=this.extractRequestSummaries(m,a,c);s.push(...u)}catch(m){console.warn(`Failed to load ${a} ${c}:`,m)}}return this.applyFilters(s,t)}static extractRequestSummaries(t,s,r){const n=[];for(const[a,i]of Object.entries(t))for(const[o]of Object.entries(i)){if(o==="_metadata")continue;const c=B.getMonthlyBillingData(i,o);!c||!c.fechaRecibido||c.fechaRecibido.trim()===""||n.push({company:a,month:o,year:r,entity:s,state:c.estado,receivedDate:c.fechaRecibido,closedDate:c.fechaCerrado||"",processingDays:c.diasProcesamiento||null,workItemId:c.workItemId})}return n}static applyFilters(t,s){return t.filter(r=>{if(s.companies.length>0&&!s.companies.includes(r.company))return!1;if(s.months.length>0){const n=new Date(r.receivedDate).getMonth()+1;if(!s.months.includes(n))return!1}return!(s.startDate&&r.receivedDate<s.startDate||s.endDate&&r.receivedDate>s.endDate||s.states.length>0&&!s.states.includes(r.state))})}static calculateDailyDistribution(t){const s=new Map;t.forEach(a=>{const i=a.receivedDate;s.has(i)||s.set(i,[]),s.get(i).push(a)});const r=[],n=Math.max(...Array.from(s.values()).map(a=>a.length),1);for(const[a,i]of s){const o=i.length,c=o<=n*.33?"low":o<=n*.66?"medium":"high";r.push({date:a,count:o,requests:i,intensity:c})}return r.sort((a,i)=>a.date.localeCompare(i.date))}static calculateMonthlyDistribution(t){const s=new Map;t.forEach(n=>{const a=new Date(n.receivedDate),i=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`;s.has(i)||s.set(i,[]),s.get(i).push(n)});const r=[];for(const[n,a]of s){const[i,o]=n.split("-").map(Number),c=new Date(i,o,0).getDate();r.push({year:i,month:o,monthName:U[o-1],count:a.length,requests:a,averagePerDay:a.length/c})}return r.sort((n,a)=>n.year!==a.year?n.year-a.year:n.month-a.month)}static calculateWeekdayDistribution(t){const s=new Map,r=["Domingo","Lunes","Martes","Mi√©rcoles","Jueves","Viernes","S√°bado"];t.forEach(i=>{const o=new Date(i.receivedDate).getDay();s.has(o)||s.set(o,[]),s.get(o).push(i)});const n=t.length,a=[];for(let i=0;i<7;i++){const c=(s.get(i)||[]).length;a.push({dayOfWeek:i,dayName:r[i],count:c,percentage:n>0?c/n*100:0,averagePerWeek:c/Math.max(1,this.getWeeksSpanned(t))})}return a}static findPeakDays(t){if(t.length===0)return[];const s=[...t].sort((i,o)=>o.count-i.count),r=[],n=s[0];n&&r.push({date:n.date,count:n.count,type:"highest",companies:[...new Set(n.requests.map(i=>i.company))],entities:[...new Set(n.requests.map(i=>i.entity))]});const a=s[s.length-1];return a&&a.count>0&&r.push({date:a.date,count:a.count,type:"lowest",companies:[...new Set(a.requests.map(i=>i.company))],entities:[...new Set(a.requests.map(i=>i.entity))]}),r}static calculateTrends(t,s){const r=this.getDaysDifference(s.start,s.end)||1,n=t.length/r;return{daily:{period:"Diario",current:n,previous:n*.9,change:n*.1,changePercent:10,direction:"up"},weekly:{period:"Semanal",current:n*7,previous:n*7*.95,change:n*7*.05,changePercent:5,direction:"up"},monthly:{period:"Mensual",current:n*30,previous:n*30*.85,change:n*30*.15,changePercent:15,direction:"up"}}}static calculateEntityBreakdown(t){const s=new Map;t.forEach(a=>{s.has(a.entity)||s.set(a.entity,[]),s.get(a.entity).push(a)});const r=t.length,n=[];for(const[a,i]of s){const o=i.length;n.push({entity:a,count:o,percentage:r>0?o/r*100:0,requests:i,trend:{period:"Entidad",current:o,previous:o*.9,change:o*.1,changePercent:10,direction:"up"}})}return n.sort((a,i)=>i.count-a.count)}static calculateCompanyBreakdown(t){const s=new Map;t.forEach(a=>{s.has(a.company)||s.set(a.company,[]),s.get(a.company).push(a)});const r=t.length,n=[];for(const[a,i]of s){const o=i.length,c=new Set(i.map(m=>`${m.year}-${m.month}`)).size;n.push({company:a,entity:i[0]?.entity||"",count:o,percentage:r>0?o/r*100:0,requests:i,averagePerMonth:o/Math.max(1,c)})}return n.sort((a,i)=>i.count-a.count)}static generateCalendarCells(t,s,r){const n=[],a=new Date(t,s,0).getDate(),i=new Date,o=new Map;r.forEach(m=>{const u=m.receivedDate;o.has(u)||o.set(u,[]),o.get(u).push(m)});const c=Math.max(...Array.from(o.values()).map(m=>m.length),1);for(let m=1;m<=a;m++){const u=`${t}-${String(s).padStart(2,"0")}-${String(m).padStart(2,"0")}`,g=o.get(u)||[],d=g.length,h=new Date(t,s-1,m);n.push({date:u,count:d,intensity:d/c,requests:g,isToday:h.toDateString()===i.toDateString(),isWeekend:h.getDay()===0||h.getDay()===6})}return n}static calculateDateRange(t,s){if(s.startDate&&s.endDate)return{start:s.startDate,end:s.endDate};if(t.length===0){const n=new Date().toISOString().split("T")[0];return{start:n,end:n}}const r=t.map(n=>n.receivedDate).sort();return{start:s.startDate||r[0],end:s.endDate||r[r.length-1]}}static getDaysDifference(t,s){const r=new Date(t),n=new Date(s);return Math.max(1,Math.ceil((n.getTime()-r.getTime())/(1e3*60*60*24)))}static getMonthsDifference(t,s){const r=new Date(t),n=new Date(s);return Math.max(1,(n.getFullYear()-r.getFullYear())*12+(n.getMonth()-r.getMonth())+1)}static getWeeksSpanned(t){if(t.length===0)return 1;const s=t.map(a=>new Date(a.receivedDate)),r=new Date(Math.min(...s.map(a=>a.getTime()))),n=new Date(Math.max(...s.map(a=>a.getTime())));return Math.max(1,Math.ceil((n.getTime()-r.getTime())/(1e3*60*60*24*7)))}}function Nt(){const[l,t]=x.useState(null),[s,r]=x.useState(null),[n,a]=x.useState(!1),[i,o]=x.useState(null),c=x.useCallback(async g=>{a(!0),o(null);try{const d=await It.generateDemandMetrics(g);t(d)}catch(d){console.error("Error loading demand metrics:",d),o("Error al cargar las m√©tricas de demanda. Por favor, intenta nuevamente.")}finally{a(!1)}},[]),m=x.useCallback(async(g,d,h)=>{try{const y=await It.generateHeatMapData(g,d,h);r(y)}catch(y){console.error("Error loading heat map data:",y)}},[]),u=x.useCallback((g,d)=>{try{const h=kr(g),y=new Blob([h],{type:"text/csv;charset=utf-8;"}),C=document.createElement("a"),p=URL.createObjectURL(y);C.setAttribute("href",p),C.setAttribute("download",`${d}-${new Date().toISOString().split("T")[0]}.csv`),C.style.visibility="hidden",document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(p)}catch(h){console.error("Error exporting data:",h),o("Error al exportar los datos. Por favor, intenta nuevamente.")}},[]);return{demandMetrics:l,heatMapData:s,loading:n,error:i,loadDemandMetrics:c,loadHeatMapData:m,exportData:u}}function kr(l){const t=[];return t.push("Tipo,Fecha,Valor,Descripci√≥n"),t.push(`Resumen,${l.dateRange.start},${l.totalRequests},Total de solicitudes`),t.push(`Resumen,${l.dateRange.start},${l.dailyAverage.toFixed(2)},Promedio diario`),t.push(`Resumen,${l.dateRange.start},${l.monthlyAverage.toFixed(2)},Promedio mensual`),l.dailyDistribution.forEach(s=>{t.push(`Diario,${s.date},${s.count},Solicitudes del d√≠a`)}),l.monthlyDistribution.forEach(s=>{t.push(`Mensual,${s.year}-${String(s.month).padStart(2,"0")},${s.count},${s.monthName}`)}),l.weekdayDistribution.forEach(s=>{t.push(`D√≠a de semana,${s.dayName},${s.count},${s.percentage.toFixed(1)}%`)}),l.entityBreakdown.forEach(s=>{t.push(`Entidad,${s.entity},${s.count},${s.percentage.toFixed(1)}%`)}),t.join(`
`)}function Ar({metrics:l}){const t=(i,o="w-4 h-4")=>{const c=o;switch(i){case"up":return e.jsx(Ne,{className:`${c} text-green-600`});case"down":return e.jsx(ft,{className:`${c} text-red-600`});case"stable":return e.jsx(pt,{className:`${c} text-gray-600`})}},s=i=>{switch(i){case"up":return"text-green-600";case"down":return"text-red-600";case"stable":return"text-gray-600"}},r=(i,o)=>{const c=new Date(i),m=new Date(o);return`${c.toLocaleDateString("es-ES",{day:"numeric",month:"short"})} - ${m.toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})}`},n=l.entityBreakdown[0],a=l.peakDays.find(i=>i.type==="highest");return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Resumen de Demanda"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Per√≠odo: ",r(l.dateRange.start,l.dateRange.end)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:l.totalRequests}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total de solicitudes"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(q,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Promedio Diario"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.dailyAverage.toFixed(1)})]})]}),l.trends.daily&&e.jsxs("div",{className:"flex items-center gap-1",children:[t(l.trends.daily.direction),e.jsxs("span",{className:`text-sm font-medium ${s(l.trends.daily.direction)}`,children:[l.trends.daily.changePercent>0?"+":"",l.trends.daily.changePercent.toFixed(1),"%"]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(Zs,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Promedio Mensual"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.monthlyAverage.toFixed(0)})]})]}),l.trends.monthly&&e.jsxs("div",{className:"flex items-center gap-1",children:[t(l.trends.monthly.direction),e.jsxs("span",{className:`text-sm font-medium ${s(l.trends.monthly.direction)}`,children:[l.trends.monthly.changePercent>0?"+":"",l.trends.monthly.changePercent.toFixed(1),"%"]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(Ye,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"D√≠a Pico"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a?a.count:0}),a&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(a.date).toLocaleDateString("es-ES",{day:"numeric",month:"short"})})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(me,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Principal Entidad"}),e.jsxs("p",{className:"text-lg font-bold text-gray-900 truncate",title:n?.entity,children:[n?n.percentage.toFixed(0):0,"%"]}),n&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 truncate",title:n.entity,children:n.entity})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Tendencias"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t(l.trends.daily.direction,"w-5 h-5"),e.jsx("span",{className:"font-medium text-gray-900",children:"Diaria"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-lg font-bold ${s(l.trends.daily.direction)}`,children:[l.trends.daily.changePercent>0?"+":"",l.trends.daily.changePercent.toFixed(1),"%"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[l.trends.daily.current," vs ",l.trends.daily.previous]})]})]}),l.trends.weekly&&e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t(l.trends.weekly.direction,"w-5 h-5"),e.jsx("span",{className:"font-medium text-gray-900",children:"Semanal"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-lg font-bold ${s(l.trends.weekly.direction)}`,children:[l.trends.weekly.changePercent>0?"+":"",l.trends.weekly.changePercent.toFixed(1),"%"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[l.trends.weekly.current," vs ",l.trends.weekly.previous]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t(l.trends.monthly.direction,"w-5 h-5"),e.jsx("span",{className:"font-medium text-gray-900",children:"Mensual"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-lg font-bold ${s(l.trends.monthly.direction)}`,children:[l.trends.monthly.changePercent>0?"+":"",l.trends.monthly.changePercent.toFixed(1),"%"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[l.trends.monthly.current," vs ",l.trends.monthly.previous]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Rendimiento Semanal"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 rounded-lg",children:[e.jsx("span",{className:"font-medium text-green-800",children:"D√≠a m√°s activo"}),e.jsx("div",{className:"text-right",children:(()=>{const o=l.weekdayDistribution.filter(c=>c.dayOfWeek>=1&&c.dayOfWeek<=5).reduce((c,m)=>m.count>c.count?m:c);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold text-green-600",children:o.dayName}),e.jsxs("div",{className:"text-sm text-green-600",children:[o.count," solicitudes"]})]})})()})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("span",{className:"font-medium text-blue-800",children:"D√≠a menos activo (laborable)"}),e.jsx("div",{className:"text-right",children:(()=>{const o=l.weekdayDistribution.filter(c=>c.dayOfWeek>=1&&c.dayOfWeek<=5).reduce((c,m)=>m.count<c.count?m:c);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold text-blue-600",children:o.dayName}),e.jsxs("div",{className:"text-sm text-blue-600",children:[o.count," solicitudes"]})]})})()})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Distribuci√≥n por Entidad"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total de entidades"}),e.jsx("span",{className:"font-bold text-gray-900",children:l.entityBreakdown.length})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Concentraci√≥n top 3"}),e.jsxs("span",{className:"font-bold text-gray-900",children:[l.entityBreakdown.slice(0,3).reduce((i,o)=>i+o.percentage,0).toFixed(1),"%"]})]}),e.jsx("div",{className:"pt-2 space-y-2",children:l.entityBreakdown.slice(0,3).map((i,o)=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{className:"text-gray-600 truncate pr-2",title:i.entity,children:["#",o+1," ",i.entity]}),e.jsxs("span",{className:"font-medium text-gray-900 flex-shrink-0",children:[i.percentage.toFixed(1),"%"]})]},i.entity))})]})]})]})]})}function ns({heatMapData:l,selectedDate:t,onDateChange:s,loading:r=!1}){const[n,a]=x.useState(null),i=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],o=["Dom","Lun","Mar","Mi√©","Jue","Vie","S√°b"],c=d=>{const h=new Date(t);d==="prev"?h.setMonth(h.getMonth()-1):h.setMonth(h.getMonth()+1),s(h)},m=x.useMemo(()=>{if(!l)return[];const d=l.year,h=l.month-1,y=new Date(d,h,1),C=new Date(d,h+1,0),p=y.getDay(),f=C.getDate(),j=[];for(let _=0;_<p;_++)j.push(null);for(let _=1;_<=f;_++){const R=`${d}-${String(h+1).padStart(2,"0")}-${String(_).padStart(2,"0")}`,E=l.cells.find(v=>v.date===R);E?j.push(E):j.push({date:R,count:0,intensity:0,requests:[],isToday:!1,isWeekend:new Date(d,h,_).getDay()===0||new Date(d,h,_).getDay()===6})}return j},[l]),u=(d,h)=>h===0?"bg-gray-100 border-gray-200":d<=.2?"bg-green-100 border-green-200":d<=.4?"bg-green-200 border-green-300":d<=.6?"bg-yellow-200 border-yellow-300":d<=.8?"bg-orange-200 border-orange-300":"bg-red-200 border-red-300",g=(d,h)=>h===0?"text-gray-500":d<=.4?"text-green-800":d<=.6?"text-yellow-800":d<=.8?"text-orange-800":"text-red-800";return r?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(q,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Mapa de Calor"})]}),e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Generando mapa de calor..."})]})})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Mapa de Calor"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>c("prev"),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"Mes anterior",children:e.jsx(Ks,{className:"w-4 h-4 text-gray-600"})}),e.jsxs("span",{className:"font-medium text-gray-900 min-w-32 text-center",children:[i[t.getMonth()]," ",t.getFullYear()]}),e.jsx("button",{onClick:()=>c("next"),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"Mes siguiente",children:e.jsx(ea,{className:"w-4 h-4 text-gray-600"})})]})]}),l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:o.map(d=>e.jsx("div",{className:"text-center text-xs font-medium text-gray-500 py-2",children:d},d))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:m.map((d,h)=>e.jsx("div",{className:"aspect-square",children:d?e.jsx("button",{onClick:()=>a(n?.date===d.date?null:d),className:`
                        w-full h-full border rounded-lg text-xs font-medium transition-all duration-200
                        hover:scale-105 hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500
                        ${u(d.intensity,d.count)}
                        ${g(d.intensity,d.count)}
                        ${d.isToday?"ring-2 ring-blue-400":""}
                        ${n?.date===d.date?"ring-2 ring-purple-400":""}
                      `,title:`${new Date(d.date).getDate()} - ${d.count} solicitudes`,children:e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx("span",{className:"font-semibold",children:new Date(d.date).getDate()}),d.count>0&&e.jsx("span",{className:"text-xs opacity-75",children:d.count})]})}):e.jsx("div",{className:"w-full h-full"})},h))})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{children:"Menos"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-100 border border-gray-200 rounded-sm"}),e.jsx("div",{className:"w-3 h-3 bg-green-100 border border-green-200 rounded-sm"}),e.jsx("div",{className:"w-3 h-3 bg-green-200 border border-green-300 rounded-sm"}),e.jsx("div",{className:"w-3 h-3 bg-yellow-200 border border-yellow-300 rounded-sm"}),e.jsx("div",{className:"w-3 h-3 bg-orange-200 border border-orange-300 rounded-sm"}),e.jsx("div",{className:"w-3 h-3 bg-red-200 border border-red-300 rounded-sm"})]}),e.jsx("span",{children:"M√°s"})]}),l&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Total: ",e.jsx("span",{className:"font-medium",children:l.totalRequests})," solicitudes",l.averagePerDay>0&&e.jsxs("span",{className:"ml-3",children:["Promedio: ",e.jsx("span",{className:"font-medium",children:l.averagePerDay.toFixed(1)}),"/d√≠a"]})]})]})}),n&&n.count>0&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:new Date(n.date).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsxs("p",{className:"text-sm text-blue-800 mb-3",children:[e.jsx("span",{className:"font-medium",children:n.count})," solicitud(es) recibida(s)"]}),n.requests.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-medium text-blue-900",children:"Empresas:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Array.from(new Set(n.requests.map(d=>d.company))).map(d=>e.jsx("span",{className:"inline-block px-2 py-1 bg-white border border-blue-200 rounded text-xs text-blue-800",children:d},d))})]})]})]}):e.jsx("div",{className:"flex items-center justify-center h-64 bg-gray-50 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ft,{className:"w-8 h-8 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No hay datos disponibles para este mes"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Ajusta los filtros o selecciona otro per√≠odo"})]})})]})}function Tt({metrics:l,compact:t=!1}){const s=a=>{switch(a){case"up":return e.jsx(Ne,{className:"w-4 h-4 text-green-600"});case"down":return e.jsx(ft,{className:"w-4 h-4 text-red-600"});case"stable":return e.jsx(pt,{className:"w-4 h-4 text-gray-600"})}},r=a=>{switch(a){case"up":return"text-green-600";case"down":return"text-red-600";case"stable":return"text-gray-600"}},n=a=>Math.max(...a.map(i=>i.count));return t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(he,{className:"w-4 h-4 text-gray-600"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Distribuci√≥n Semanal"})]}),e.jsx("div",{className:"space-y-3",children:l.weekdayDistribution.map(a=>{const i=n(l.weekdayDistribution),o=i>0?a.count/i*100:0;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 text-xs font-medium text-gray-600 text-right",children:a.dayName.slice(0,3)}),e.jsxs("div",{className:"flex-1 bg-gray-100 rounded-full h-6 relative overflow-hidden",children:[e.jsx("div",{className:"bg-blue-500 h-full rounded-full transition-all duration-500",style:{width:`${o}%`}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-gray-700",children:a.count})})]}),e.jsxs("div",{className:"w-10 text-xs text-gray-500 text-right",children:[a.percentage.toFixed(0),"%"]})]},a.dayOfWeek)})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(he,{className:"w-4 h-4 text-gray-600"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Principales Entidades"})]}),e.jsx("div",{className:"space-y-2",children:l.entityBreakdown.slice(0,5).map((a,i)=>{const o=n(l.entityBreakdown),c=o>0?a.count/o*100:0;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 text-xs font-bold text-gray-500 text-center",children:i+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-700 truncate",children:a.entity}),e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:a.count})]}),e.jsx("div",{className:"bg-gray-100 rounded-full h-2",children:e.jsx("div",{className:"bg-indigo-500 h-full rounded-full transition-all duration-500",style:{width:`${c}%`}})})]})]},a.entity)})})]})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Tendencia Mensual"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s(l.trends.monthly.direction),e.jsxs("span",{className:`font-medium ${r(l.trends.monthly.direction)}`,children:[l.trends.monthly.changePercent>0?"+":"",l.trends.monthly.changePercent.toFixed(1),"%"]})]})]}),e.jsx("div",{className:"h-64 flex items-end gap-2 mb-4",children:l.monthlyDistribution.map(a=>{const i=n(l.monthlyDistribution),o=i>0?a.count/i*100:0;return e.jsxs("div",{className:"flex-1 flex flex-col items-center",children:[e.jsx("div",{className:"w-full flex flex-col justify-end h-48",children:e.jsx("div",{className:"bg-blue-500 hover:bg-blue-600 transition-colors rounded-t cursor-pointer relative group",style:{height:`${o}%`,minHeight:a.count>0?"8px":"2px"},title:`${a.monthName} ${a.year}: ${a.count} solicitudes`,children:e.jsx("div",{className:"absolute -top-6 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap",children:a.count})})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600 text-center",children:[e.jsx("div",{className:"font-medium",children:a.monthName.slice(0,3)}),e.jsx("div",{className:"text-gray-500",children:a.year})]})]},`${a.year}-${a.month}`)})}),e.jsxs("div",{className:"text-center text-sm text-gray-600",children:[e.jsx("span",{children:"Promedio mensual: "}),e.jsx("span",{className:"font-medium",children:l.monthlyAverage.toFixed(1)}),e.jsx("span",{children:" solicitudes"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(he,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Distribuci√≥n por D√≠a"})]}),e.jsx("div",{className:"space-y-4",children:l.weekdayDistribution.map(a=>{const i=n(l.weekdayDistribution),o=i>0?a.count/i*100:0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:a.dayName}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:a.count}),e.jsxs("span",{children:["(",a.percentage.toFixed(1),"%)"]})]})]}),e.jsx("div",{className:"bg-gray-100 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"bg-green-500 h-full rounded-full transition-all duration-700",style:{width:`${o}%`}})})]},a.dayOfWeek)})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(he,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Distribuci√≥n por Entidad"})]}),e.jsxs("div",{className:"space-y-4",children:[l.entityBreakdown.slice(0,6).map(a=>{const i=n(l.entityBreakdown),o=i>0?a.count/i*100:0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 truncate pr-2",children:a.entity}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 flex-shrink-0",children:[e.jsx("span",{className:"font-medium",children:a.count}),e.jsxs("span",{children:["(",a.percentage.toFixed(1),"%)"]})]})]}),e.jsx("div",{className:"bg-gray-100 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"bg-indigo-500 h-full rounded-full transition-all duration-700",style:{width:`${o}%`}})})]},a.entity)}),l.entityBreakdown.length>6&&e.jsx("div",{className:"text-center pt-2",children:e.jsxs("span",{className:"text-sm text-gray-500",children:["+",l.entityBreakdown.length-6," entidades m√°s"]})})]})]})]}),l.peakDays.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(he,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"D√≠as Destacados"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:l.peakDays.map(a=>e.jsxs("div",{className:`p-4 rounded-lg border-2 ${a.type==="highest"?"bg-green-50 border-green-200":"bg-blue-50 border-blue-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:`text-sm font-medium ${a.type==="highest"?"text-green-800":"text-blue-800"}`,children:a.type==="highest"?"D√≠a con m√°s solicitudes":"D√≠a con menos solicitudes"}),e.jsx("span",{className:`text-lg font-bold ${a.type==="highest"?"text-green-600":"text-blue-600"}`,children:a.count})]}),e.jsx("p",{className:`text-sm ${a.type==="highest"?"text-green-700":"text-blue-700"} mb-2`,children:new Date(a.date).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),a.entities.length>0&&e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Entidades: "}),a.entities.slice(0,2).join(", "),a.entities.length>2&&` +${a.entities.length-2} m√°s`]})]},`${a.date}-${a.type}`))})]})]})}function Rr({filters:l,onFiltersChange:t,onClose:s}){const[r,n]=x.useState(l),a=new Date().getFullYear(),i=Array.from({length:10},(j,_)=>a-_+2),o=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],c=["New","Refinement","Ready","Active","QA Certification","Gestion Tributaria","Impediment","Paused","Peer Review","Third Party","Staging","Production","Closed","Removed"],m=["Generadora","Comercializadora","Ambas"],u=j=>{const _=r.entities.includes(j)?r.entities.filter(R=>R!==j):[...r.entities,j];n({...r,entities:_})},g=j=>{const _=r.years.includes(j)?r.years.filter(R=>R!==j):[...r.years,j];n({...r,years:_})},d=j=>{const _=r.months.includes(j)?r.months.filter(R=>R!==j):[...r.months,j];n({...r,months:_})},h=j=>{const _=r.states.includes(j)?r.states.filter(R=>R!==j):[...r.states,j];n({...r,states:_})},y=j=>{const _=r.companyTypes.includes(j)?r.companyTypes.filter(R=>R!==j):[...r.companyTypes,j];n({...r,companyTypes:_})},C=()=>{t(r),s()},p=()=>{const j={entities:[],companies:[],years:[2024,2025],months:[],states:[],companyTypes:[]};n(j),t(j)},f=()=>Object.values(r).filter(j=>Array.isArray(j)?j.length>0:!!j).length;return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Pe,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Filtros de An√°lisis"}),f()>0&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 text-sm font-medium px-2 py-1 rounded-full",children:[f()," activos"]})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(se,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(zt,{className:"w-4 h-4 text-gray-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Entidades"}),r.entities.length>0&&e.jsx("span",{className:"bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded-full",children:r.entities.length})]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:ce.map(j=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-1 rounded",children:[e.jsx("input",{type:"checkbox",checked:r.entities.includes(j),onChange:()=>u(j),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700 flex-1",children:j}),r.entities.includes(j)&&e.jsx(te,{className:"w-4 h-4 text-blue-600"})]},j))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(q,{className:"w-4 h-4 text-gray-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"A√±os"}),r.years.length>0&&e.jsx("span",{className:"bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded-full",children:r.years.length})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:i.map(j=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:r.years.includes(j),onChange:()=>g(j),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:j})]},j))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(q,{className:"w-4 h-4 text-gray-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Meses"}),r.months.length>0&&e.jsx("span",{className:"bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded-full",children:r.months.length})]}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:o.map((j,_)=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-1 rounded",children:[e.jsx("input",{type:"checkbox",checked:r.months.includes(_+1),onChange:()=>d(_+1),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-xs text-gray-700",children:j.slice(0,3)})]},j))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(te,{className:"w-4 h-4 text-gray-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Estados"}),r.states.length>0&&e.jsx("span",{className:"bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded-full",children:r.states.length})]}),e.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:c.map(j=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-1 rounded",children:[e.jsx("input",{type:"checkbox",checked:r.states.includes(j),onChange:()=>h(j),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-xs text-gray-700",children:bt[j]||j})]},j))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ta,{className:"w-4 h-4 text-gray-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Tipos de Empresa"}),r.companyTypes.length>0&&e.jsx("span",{className:"bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded-full",children:r.companyTypes.length})]}),e.jsx("div",{className:"space-y-2",children:m.map(j=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:r.companyTypes.includes(j),onChange:()=>y(j),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:j}),r.companyTypes.includes(j)&&e.jsx(te,{className:"w-4 h-4 text-blue-600"})]},j))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Rango de Fechas"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Fecha Inicio"}),e.jsx("input",{type:"date",value:r.startDate||"",onChange:j=>n({...r,startDate:j.target.value||void 0}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Fecha Fin"}),e.jsx("input",{type:"date",value:r.endDate||"",onChange:j=>n({...r,endDate:j.target.value||void 0}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-6 mt-6 border-t border-gray-200",children:[e.jsx("button",{onClick:p,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors",children:"Limpiar Filtros"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:C,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors",children:"Aplicar Filtros"})]})]})]})}function ls({title:l="Solicitudes por Mes",filters:t={},compact:s=!1,showTrends:r=!0}){const{demandMetrics:n,loading:a,error:i,loadDemandMetrics:o}=Nt(),c=x.useMemo(()=>({entities:[],companies:[],years:[2017,2018,2019,2020,2021,2022,2023,2024,2025],months:[],states:[],companyTypes:[],...t}),[t]);x.useEffect(()=>{(async()=>{try{await o(c)}catch(h){console.warn("Failed to load demand metrics for MonthlyRequestsChart:",h)}})()},[c]);const m=d=>{switch(d){case"up":return e.jsx(Ne,{className:"w-4 h-4 text-green-600"});case"down":return e.jsx(ft,{className:"w-4 h-4 text-red-600"});case"stable":return e.jsx(pt,{className:"w-4 h-4 text-gray-600"})}},u=d=>{switch(d){case"up":return"text-green-600";case"down":return"text-red-600";case"stable":return"text-gray-600"}};if(a)return e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})});if(i||!n)return e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500",children:"Error al cargar los datos del gr√°fico"})});const g=d=>Math.max(...d.map(h=>h.count));return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:`${s?"text-base":"text-lg"} font-semibold text-gray-900`,children:l})]}),r&&n.trends?.monthly&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[m(n.trends.monthly.direction),e.jsxs("span",{className:`font-medium ${u(n.trends.monthly.direction)}`,children:[n.trends.monthly.changePercent>0?"+":"",n.trends.monthly.changePercent.toFixed(1),"%"]})]})]}),e.jsx("div",{className:`${s?"h-48":"h-64"} flex items-end gap-2 mb-4`,children:n.monthlyDistribution.map(d=>{const h=g(n.monthlyDistribution),y=h>0?d.count/h*100:0;return e.jsxs("div",{className:"flex-1 flex flex-col items-center",children:[e.jsx("div",{className:"w-full flex flex-col justify-end",style:{height:s?"12rem":"16rem"},children:e.jsx("div",{className:"bg-blue-500 hover:bg-blue-600 transition-colors rounded-t cursor-pointer relative group",style:{height:`${y}%`,minHeight:d.count>0?"8px":"2px"},title:`${d.monthName} ${d.year}: ${d.count} solicitudes`,children:e.jsx("div",{className:"absolute -top-6 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-10",children:d.count})})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600 text-center",children:[e.jsx("div",{className:"font-medium",children:d.monthName.slice(0,3)}),e.jsx("div",{className:"text-gray-500",children:d.year})]})]},`${d.year}-${d.month}`)})}),e.jsxs("div",{className:"text-center text-sm text-gray-600",children:[e.jsx("span",{children:"Total: "}),e.jsx("span",{className:"font-medium",children:n.totalRequests}),e.jsx("span",{children:" solicitudes ‚Ä¢ Promedio mensual: "}),e.jsx("span",{className:"font-medium",children:n.monthlyAverage.toFixed(1)})]})]})}function Ir(){const[l,t]=x.useState(!1),[s,r]=x.useState(new Date),[n,a]=x.useState({entities:[],companies:[],years:[2024,2025],months:[],states:[],companyTypes:[]}),{demandMetrics:i,heatMapData:o,loading:c,error:m,loadDemandMetrics:u,loadHeatMapData:g,exportData:d}=Nt();x.useEffect(()=>{u(n),g(s.getFullYear(),s.getMonth()+1,n)},[n,s,u,g]);const h=x.useCallback(p=>{a(p)},[]),y=x.useCallback(p=>{r(p)},[]),C=x.useCallback(()=>{i&&d(i,"demand-analytics")},[i,d]);return c&&!i?e.jsx("div",{className:"min-h-screen bg-gray-50 p-4 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Analizando patrones de demanda..."})]})}):m?e.jsx("div",{className:"min-h-screen bg-gray-50 p-4 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:[e.jsx("h3",{className:"font-bold",children:"Error en el an√°lisis"}),e.jsx("p",{children:m})]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Intentar nuevamente"})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-6",children:e.jsxs("div",{className:"w-full px-2 sm:px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(de,{to:"/",className:"flex items-center gap-2 text-gray-600 hover:text-blue-600 transition-colors",children:[e.jsx(je,{className:"w-5 h-5"}),e.jsx("span",{children:"Volver al Dashboard"})]}),e.jsx("div",{className:"border-l border-gray-300 h-6 mx-4"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ne,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"An√°lisis de Demanda"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Patrones temporales de solicitudes de facturaci√≥n"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>t(!l),className:`flex items-center gap-2 px-4 py-2 border rounded-lg transition-colors ${l||Object.values(n).some(p=>Array.isArray(p)?p.length>0:!!p)?"bg-blue-50 text-blue-700 border-blue-200 hover:bg-blue-100":"bg-white text-gray-700 border-gray-200 hover:bg-gray-50"}`,children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{children:"Filtros"}),Object.values(n).some(p=>Array.isArray(p)?p.length>0:!!p)&&e.jsx("span",{className:"bg-blue-600 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:Object.values(n).filter(p=>Array.isArray(p)?p.length>0:!!p).length})]}),i&&e.jsxs("button",{onClick:C,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(gt,{className:"w-4 h-4"}),e.jsx("span",{children:"Exportar"})]})]})]}),l&&e.jsx("div",{className:"mt-6",children:e.jsx(Rr,{filters:n,onFiltersChange:h,onClose:()=>t(!1)})})]}),i&&e.jsxs("div",{className:"space-y-8",children:[e.jsx(Ar,{metrics:i}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[e.jsx("div",{className:"xl:col-span-1",children:e.jsx(ns,{heatMapData:o,selectedDate:s,onDateChange:y,loading:c})}),e.jsx("div",{className:"xl:col-span-2",children:e.jsx(Tt,{metrics:i,compact:!0})})]}),e.jsx("div",{className:"mt-8",children:e.jsx(ls,{title:"Solicitudes por Mes",filters:n,compact:!1,showTrends:!0})}),e.jsx("div",{className:"mt-8",children:e.jsx(Tt,{metrics:i,compact:!1})})]}),!i&&!c&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(q,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Configura los filtros para comenzar"}),e.jsx("p",{className:"text-gray-600",children:"Selecciona los par√°metros de an√°lisis para generar insights sobre los patrones de demanda."})]})]})})}class Tr{static getDeadlinesForReport(t,s){const r=[];U.forEach(i=>{const o=Y.getCompaniesDeadlineInfo(t,i);r.push(...o)});const n=r.filter(i=>Y.shouldShowDeadline(i.estado)),a=this.filterByDaysRange(n,s);if(s.selectedEntities.length>0){const i=new Set(s.selectedEntities);return a.filter(o=>{const c=t[o.company][o.month];return i.has(c?.entidad||"")})}return a}static filterByDaysRange(t,s){return t.filter(r=>{const n=r.daysUntilSLADeadline;if(n===null)return!1;const a=n<0,i=n>=0&&n<=s.daysRange;return!!(s.showOverdue&&a||s.showUpcoming&&i)})}static groupByEntity(t,s){const r=new Map;t.forEach(a=>{const o=s[a.company][a.month]?.entidad||"Sin Entidad";r.has(o)||r.set(o,[]),r.get(o).push(a)});const n=[];return r.forEach((a,i)=>{const o=this.groupByMonth(a);let c=0,m=0;a.forEach(u=>{const g=u.daysUntilSLADeadline??0;g<0?c++:g<=20&&m++}),n.push({entityName:i,deadlinesByMonth:o,totalCount:a.length,overdueCount:c,upcomingCount:m})}),n.sort((a,i)=>i.overdueCount-a.overdueCount)}static groupByMonth(t){const s={};return t.forEach(r=>{s[r.month]||(s[r.month]=[]),s[r.month].push(r)}),Object.keys(s).forEach(r=>{s[r].sort((n,a)=>{const i=n.daysUntilSLADeadline??Number.MAX_VALUE,o=a.daysUntilSLADeadline??Number.MAX_VALUE;return i-o})}),s}static generateReport(t,s){const r=this.getDeadlinesForReport(t,s),n=this.groupByEntity(r,t);let a=0,i=0,o=0;return r.forEach(c=>{const m=c.daysUntilSLADeadline??0;m<0?a++:m<=20?i++:o++}),{entitiesData:n,globalMetrics:{totalDeadlines:r.length,overdueCount:a,upcomingCount:i,normalCount:o}}}static getOverdueDeadlines(t){return t.filter(s=>(s.daysUntilSLADeadline??0)<0)}static getUpcomingDeadlines(t,s){return t.filter(r=>{const n=r.daysUntilSLADeadline??Number.MAX_VALUE;return n>=0&&n<=s})}}function Pr({billingData:l}){const[t,s]=x.useState(!0),[r,n]=x.useState(!0),[a]=x.useState(20),[i,o]=x.useState([]),[c,m]=x.useState(!1),u=x.useMemo(()=>({showOverdue:t,showUpcoming:r,daysRange:a,selectedEntities:i}),[t,r,a,i]),g=x.useMemo(()=>Tr.generateReport(l,u),[l,u]),d=()=>s(j=>!j),h=()=>n(j=>!j),y=()=>m(j=>!j),C=j=>{o(_=>_.includes(j)?_.filter(R=>R!==j):[..._,j])},p=()=>o([]),f=g.globalMetrics.totalDeadlines>0;return{reportData:g,hasData:f,showOverdue:t,showUpcoming:r,daysRange:a,selectedEntities:i,captureMode:c,toggleOverdue:d,toggleUpcoming:h,toggleCaptureMode:y,selectEntity:C,clearEntityFilters:p}}function Lr({showOverdue:l,showUpcoming:t,daysRange:s,captureMode:r,onToggleOverdue:n,onToggleUpcoming:a,onToggleCaptureMode:i}){return r?null:e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filtros:"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:n,className:"w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Vencidos (d√≠as < 0)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:a,className:"w-4 h-4 text-yellow-600 border-gray-300 rounded focus:ring-yellow-500"}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Pr√≥ximos ",s," d√≠as"]})]})]}),e.jsxs("button",{onClick:i,className:"flex items-center gap-2 px-4 py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition-colors font-medium text-sm",children:[e.jsx(sa,{className:"w-4 h-4"}),e.jsx("span",{children:"Activar Modo Captura"})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-500",children:[e.jsx("strong",{children:"Modo Captura:"})," Oculta controles y optimiza el dise√±o para tomar screenshots limpios por entidad."]})})]})}function Mr({entityName:l,deadlinesByMonth:t,totalCount:s,overdueCount:r,upcomingCount:n}){const a=U.filter(i=>t[i]);return s===0?null:e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden mb-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-blue-100 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:l}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s," ",s===1?"deadline":"deadlines"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[r>0&&e.jsxs("div",{className:"flex items-center gap-2 bg-red-100 text-red-800 px-3 py-1.5 rounded-full",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium text-sm",children:[r," vencidos"]})]}),n>0&&e.jsxs("div",{className:"flex items-center gap-2 bg-yellow-100 text-yellow-800 px-3 py-1.5 rounded-full",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium text-sm",children:[n," pr√≥ximos"]})]})]})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:a.map(i=>{const o=t[i];return!o||o.length===0?null:e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full"}),e.jsx("h4",{className:"font-semibold text-gray-900",children:i}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",o.length," ",o.length===1?"empresa":"empresas",")"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-gray-50",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium text-gray-700",children:"Empresa"}),e.jsx("th",{className:"text-left py-2 px-3 font-medium text-gray-700",children:"Estado"}),e.jsx("th",{className:"text-left py-2 px-3 font-medium text-gray-700",children:"Fecha Solicitud"}),e.jsx("th",{className:"text-left py-2 px-3 font-medium text-gray-700",children:"Deadline SLA"})]})}),e.jsx("tbody",{children:o.map((c,m)=>{const u=c.daysUntilSLADeadline,g=Y.getUrgencyLevel(u),d=Y.getUrgencyIcon(g),h=Y.formatDaysRemaining(u),y=c.fechaRecibido&&c.fechaRecibido.trim()!=="",C=y?c.fechaRecibido:"-",p=y?Y.calculateDaysElapsed(c.fechaRecibido):null,f=Y.formatDaysElapsed(p),j=c.deadlines?.fechaLimiteSLA||"-";return e.jsxs("tr",{className:`border-b border-gray-100 last:border-b-0 ${g==="critical"?"bg-red-50/50":""}`,children:[e.jsx("td",{className:"py-3 px-3 font-medium text-gray-900",children:c.company}),e.jsx("td",{className:"py-3 px-3",children:e.jsx("span",{className:"text-gray-700 text-xs bg-gray-100 px-2 py-1 rounded",children:c.estado})}),e.jsx("td",{className:"py-3 px-3",children:y?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 text-sm",children:C}),e.jsx("span",{className:"text-xs text-gray-500",children:f})]}):e.jsx("span",{className:"text-gray-700",children:C})}),e.jsx("td",{className:"py-3 px-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",title:`Urgencia: ${g}`,children:d}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 text-sm",children:j}),e.jsx("span",{className:`text-xs font-bold ${g==="critical"?"text-red-700":g==="warning"?"text-yellow-700":"text-green-700"}`,children:h})]})]})})]},`${c.company}-${m}`)})})]})})]},i)})})]})}function Or(){const[l,t]=x.useState("Alcald√≠a de Palmira"),{billingData:s}=ee(2025,l),r=Pr({billingData:s}),n=new Date().toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"});return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:`max-w-7xl mx-auto ${r.captureMode?"p-0":"p-4 lg:p-6"}`,children:[!r.captureMode&&e.jsx("div",{className:"mb-6",children:e.jsxs(de,{to:"/",className:"inline-flex items-center gap-2 text-blue-600 hover:text-blue-700 transition-colors mb-4",children:[e.jsx(je,{className:"w-4 h-4"}),"Volver al Dashboard"]})}),e.jsxs("div",{className:`bg-white rounded-lg border border-gray-200 shadow-sm ${r.captureMode?"p-6":"p-6 mb-6"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Reporte de Vencimientos"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Empresas de Energ√≠a - Facturaci√≥n"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(q,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:n})]})]}),!r.captureMode&&e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-200",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Entidad:"}),e.jsx("select",{value:l,onChange:a=>t(a.target.value),className:"w-full max-w-md px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900",children:ce.map(a=>e.jsx("option",{value:a,children:a},a))})]}),r.captureMode&&e.jsx("div",{className:"mb-4 pb-4 border-b border-gray-200",children:e.jsxs("p",{className:"text-sm font-medium text-gray-700",children:["Entidad: ",e.jsx("span",{className:"text-blue-600",children:l})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mt-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-red-100 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ne,{className:"w-5 h-5 text-red-700"}),e.jsx("span",{className:"text-xs font-medium text-red-700 uppercase tracking-wide",children:"Vencidos"})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-red-800",children:r.reportData.globalMetrics.overdueCount}),e.jsx("span",{className:"text-sm text-red-600",children:"deadlines"})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(me,{className:"w-5 h-5 text-yellow-700"}),e.jsxs("span",{className:"text-xs font-medium text-yellow-700 uppercase tracking-wide",children:["Pr√≥ximos ",r.daysRange," d√≠as"]})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-yellow-800",children:r.reportData.globalMetrics.upcomingCount}),e.jsx("span",{className:"text-sm text-yellow-600",children:"deadlines"})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(te,{className:"w-5 h-5 text-blue-700"}),e.jsx("span",{className:"text-xs font-medium text-blue-700 uppercase tracking-wide",children:"Total"})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-blue-800",children:r.reportData.globalMetrics.totalDeadlines}),e.jsx("span",{className:"text-sm text-blue-600",children:"deadlines"})]})]})]}),r.captureMode&&e.jsxs("div",{className:"mt-4 bg-purple-100 border border-purple-200 rounded-lg p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-700",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Modo Captura Activo - Optimizado para Screenshots"})]}),e.jsxs("button",{onClick:r.toggleCaptureMode,className:"flex items-center gap-1 text-purple-700 hover:text-purple-800 transition-colors",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Desactivar"})]})]})]}),e.jsx(Lr,{showOverdue:r.showOverdue,showUpcoming:r.showUpcoming,daysRange:r.daysRange,captureMode:r.captureMode,onToggleOverdue:r.toggleOverdue,onToggleUpcoming:r.toggleUpcoming,onToggleCaptureMode:r.toggleCaptureMode}),r.hasData?e.jsx("div",{className:"space-y-6",children:r.reportData.entitiesData.map(a=>e.jsx(Mr,{entityName:a.entityName,deadlinesByMonth:a.deadlinesByMonth,totalCount:a.totalCount,overdueCount:a.overdueCount,upcomingCount:a.upcomingCount},a.entityName))}):e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-12 text-center",children:[e.jsx(te,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay vencimientos que mostrar"}),e.jsx("p",{className:"text-gray-500",children:!r.showOverdue&&!r.showUpcoming?"Activa al menos un filtro para ver los deadlines.":"No hay deadlines que cumplan con los filtros seleccionados."})]}),!r.captureMode&&r.hasData&&e.jsx("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm text-blue-800",children:e.jsxs("p",{children:[e.jsx("strong",{children:"üí° Tip:"}),' Activa el "Modo Captura" para ocultar controles y tomar screenshots limpios de cada entidad. Ideal para enviar reportes a Tributaria.']})})]})})}class at{static normalizeEntityName(t){return{"Gobernaci√≥n del Valle":"Gobernaci√≥n del Valle del Cauca","Gobernaci√≥n del Valle del Cauca":"Gobernaci√≥n del Valle del Cauca","Alcald√≠a de Palmira":"Alcald√≠a de Palmira","Alcald√≠a de Tulu√°":"Alcald√≠a de Tulu√°",Infibagu√©:"Infibagu√©"}[t]||t}static async generateReportData(t,s="month"){const r=[];for(const g of ce)for(const d of[2017,2018,2019,2020,2021,2022,2023,2024,2025])try{const h=await B.loadDataForEntityYear(g,d),y=this.extractRequestSummaries(h,g,d);r.push(...y)}catch{console.warn(`No data found for ${g} ${d}`)}const n=this.filterByDateRange(r,t),a=n.length,i=this.calculateStateStatistics(n),o=this.calculateEntityStatistics(n),c=this.calculateEntityStatisticsWithProgress(n),m=this.calculateAverageResolutionTime(n),u=this.generateTimeSeriesData(n,s,t);return{totalRequests:a,stateStatistics:i,entityStatistics:o,entityStatisticsWithProgress:c,averageResolutionTime:m,timeSeriesData:u,requestSummaries:n}}static extractRequestSummaries(t,s,r){const n=[];for(const[a,i]of Object.entries(t))for(const[o]of Object.entries(i)){if(o==="_metadata")continue;const c=B.getMonthlyBillingData(i,o);c&&(!c.fechaRecibido||c.fechaRecibido.trim()===""||n.push({company:a,month:o,year:r,entity:this.normalizeEntityName(c.entidad||s),state:c.estado,receivedDate:c.fechaRecibido,closedDate:c.fechaCerrado||"",processingDays:c.diasProcesamiento||null,workItemId:c.workItemId||null}))}return n}static filterByDateRange(t,s){const r=new Date(s.startDate),n=new Date(s.endDate);return t.filter(a=>{if(!a.receivedDate)return!1;const i=new Date(a.receivedDate);return i>=r&&i<=n})}static calculateStateStatistics(t){const s={};return t.forEach(r=>{const n=r.state;s[n]=(s[n]||0)+1}),s}static calculateEntityStatistics(t){const s={};return t.forEach(r=>{s[r.entity]=(s[r.entity]||0)+1}),s}static calculateEntityStatisticsWithProgress(t){const s={};return t.forEach(r=>{const n=r.entity,a=r.state;s[n]||(s[n]={total:0,completed:0,inProgress:0,ready:0,blocked:0,removed:0,completionPercentage:0,progressPercentage:0}),s[n].total+=1,a==="Closed"?s[n].completed+=1:a==="Ready"?s[n].ready+=1:a==="Paused"||a==="Impediment"?s[n].blocked+=1:a==="Removed"?s[n].removed+=1:s[n].inProgress+=1}),Object.keys(s).forEach(r=>{const n=s[r];n.total>0?(n.completionPercentage=Math.round(n.completed/n.total*100),n.progressPercentage=Math.round((n.completed+n.inProgress)/n.total*100)):(n.completionPercentage=0,n.progressPercentage=0)}),s}static calculateAverageResolutionTime(t){const s=t.filter(n=>n.closedDate&&n.closedDate.trim()!==""&&n.processingDays!==null);if(s.length===0)return 0;const r=s.reduce((n,a)=>n+(a.processingDays||0),0);return Math.round(r/s.length*100)/100}static generateTimeSeriesData(t,s,r){const n=new Map,a=new Date(r.startDate),i=new Date(r.endDate),o=new Date(a);for(;o<=i;){const c=this.formatDateForPeriod(o,s);switch(n.set(c,0),s){case"day":o.setDate(o.getDate()+1);break;case"week":o.setDate(o.getDate()+7);break;case"month":o.setMonth(o.getMonth()+1);break}}return t.forEach(c=>{if(!c.receivedDate)return;const m=new Date(c.receivedDate),u=this.formatDateForPeriod(m,s);n.has(u)&&n.set(u,(n.get(u)||0)+1)}),Array.from(n.entries()).map(([c,m])=>({date:c,count:m})).sort((c,m)=>c.date.localeCompare(m.date))}static formatDateForPeriod(t,s){const r=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");switch(s){case"day":return`${r}-${n}-${a}`;case"week":const i=new Date(t);i.setDate(t.getDate()-t.getDay()+1);const o=String(i.getMonth()+1).padStart(2,"0"),c=String(i.getDate()).padStart(2,"0");return`${i.getFullYear()}-${o}-${c}`;case"month":return`${r}-${n}`;default:return`${r}-${n}`}}static exportToCSV(t){const s=["empresa","vigencia","periodo","entidad","estado","fecha_recibido","fecha_cerrado","dias_procesamiento","id_azure"],r=t.requestSummaries.map(a=>[a.company,a.year.toString(),a.month,a.entity,a.state,a.receivedDate,a.closedDate,a.processingDays?.toString()||"",a.workItemId?.toString()||""]);return[s,...r].map(a=>a.map(i=>`"${i}"`).join(",")).join(`
`)}static downloadCSV(t,s="reporte-solicitudes.csv"){const r=new Blob([t],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");if(n.download!==void 0){const a=URL.createObjectURL(r);n.setAttribute("href",a),n.setAttribute("download",s),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}}function $r(){const[l,t]=x.useState(null),[s,r]=x.useState(!1),[n,a]=x.useState(null),[i,o]=x.useState(()=>{const y=new Date,C=new Date(y.getFullYear(),y.getMonth(),1),p=new Date(y.getFullYear(),y.getMonth()+1,0);return{startDate:C.toISOString().split("T")[0],endDate:p.toISOString().split("T")[0]}}),[c,m]=x.useState("month"),u=x.useCallback(async()=>{r(!0),a(null);try{const y=await at.generateReportData(i,c);t(y)}catch(y){console.error("Error generating report:",y),a("Error al generar el reporte. Por favor, intenta nuevamente.")}finally{r(!1)}},[i,c]),g=x.useCallback(y=>{o(y)},[]),d=x.useCallback(y=>{m(y)},[]),h=x.useCallback(()=>{if(l)try{const y=at.exportToCSV(l),p=`reporte-solicitudes-${new Date().toISOString().split("T")[0]}.csv`;at.downloadCSV(y,p)}catch(y){console.error("Error exporting CSV:",y),a("Error al exportar los datos. Por favor, intenta nuevamente.")}},[l]);return x.useEffect(()=>{u()},[u]),{reportData:l,loading:s,error:n,dateRange:i,period:c,updateDateRange:g,updatePeriod:d,generateReport:u,exportToCSV:h}}function Fr({dateRange:l,onDateRangeChange:t,period:s,onPeriodChange:r,onExport:n,loading:a=!1}){const i=m=>{t({...l,startDate:m})},o=m=>{t({...l,endDate:m})},c=m=>{const u=new Date,g=new Date;g.setDate(u.getDate()-m),t({startDate:g.toISOString().split("T")[0],endDate:u.toISOString().split("T")[0]})};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-gray-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Filtros de Reporte"})]}),e.jsxs("button",{onClick:n,disabled:a,className:"flex items-center gap-2 bg-green-50 text-green-700 px-4 py-2 rounded-lg hover:bg-green-100 transition-colors border border-green-200 disabled:opacity-50",children:[e.jsx(gt,{className:"w-4 h-4"}),"Exportar CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[e.jsx(q,{className:"w-4 h-4 inline mr-1"}),"Fecha Inicio"]}),e.jsx("input",{type:"date",value:l.startDate,onChange:m=>i(m.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[e.jsx(q,{className:"w-4 h-4 inline mr-1"}),"Fecha Fin"]}),e.jsx("input",{type:"date",value:l.endDate,onChange:m=>o(m.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Agrupaci√≥n"}),e.jsxs("select",{value:s,onChange:m=>r(m.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"day",children:"Por D√≠a"}),e.jsx("option",{value:"week",children:"Por Semana"}),e.jsx("option",{value:"month",children:"Por Mes"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Rangos R√°pidos"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>c(30),className:"px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors",children:"30 d√≠as"}),e.jsx("button",{onClick:()=>c(90),className:"px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors",children:"90 d√≠as"}),e.jsx("button",{onClick:()=>c(365),className:"px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors",children:"1 a√±o"})]})]})]})]})}function Vr({totalRequests:l,stateStatistics:t,entityStatisticsWithProgress:s,averageResolutionTime:r}){return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(he,{className:"w-6 h-6 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Resumen General"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Total de Solicitudes:"}),e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:l})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Tiempo Promedio de Resoluci√≥n:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"w-4 h-4 text-orange-500"}),e.jsxs("span",{className:"text-xl font-bold text-orange-600",children:[r," d√≠as"]})]})]}),e.jsx("div",{className:"pt-2 border-t border-gray-100",children:e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Solicitudes Cerradas:"}),e.jsxs("span",{className:"font-medium text-green-600",children:[t.Closed||0," (",Math.round((t.Closed||0)/l*100),"%)"]})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(te,{className:"w-6 h-6 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Estados de Solicitudes"})]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:Object.entries(t).sort(([,n],[,a])=>a-n).map(([n,a])=>{const i=Math.round(a/l*100),c=ye(n).bg.replace("bg-","").replace("-100","-600");return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:Te(n)}),e.jsx("span",{className:"text-sm font-medium text-gray-700 truncate max-w-32",title:n,children:n})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-gray-900",children:a}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",i,"%)"]})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`bg-${c} h-2 rounded-full transition-all duration-300`,style:{width:`${i}%`}})})]},n)})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(H,{className:"w-6 h-6 text-purple-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Solicitudes por Entidad"})]}),e.jsx("div",{className:"space-y-4",children:Object.entries(s).sort(([,n],[,a])=>a.total-n.total).map(([n,a])=>{const i=Math.round(a.total/l*100);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 truncate",title:n,children:n}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs text-green-600 font-medium",children:[a.completed," completadas"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-sm font-bold text-gray-900",children:a.total}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",i,"%)"]})]})]})]}),e.jsx("div",{className:"w-full bg-gray-100 rounded-full h-4 relative overflow-hidden",children:(()=>{const o=a.completed/a.total*100,c=a.inProgress/a.total*100,m=a.ready/a.total*100,u=a.blocked/a.total*100,g=a.removed/a.total*100,h=o+c,y=h+m,C=y+u,p=C+g;return e.jsxs(e.Fragment,{children:[a.completed>0&&e.jsx("div",{className:"bg-green-600 h-full absolute top-0 left-0 transition-all duration-500",style:{width:`${o}%`,borderRadius:"9999px 0 0 9999px"},title:`${a.completed} completadas`}),a.inProgress>0&&e.jsx("div",{className:"bg-blue-500 h-full absolute top-0 transition-all duration-500",style:{left:`${o}%`,width:`${c}%`},title:`${a.inProgress} en progreso`}),a.ready>0&&e.jsx("div",{className:"bg-gray-300 h-full absolute top-0 transition-all duration-500",style:{left:`${h}%`,width:`${m}%`},title:`${a.ready} por iniciar`}),a.blocked>0&&e.jsx("div",{className:"bg-red-500 h-full absolute top-0 transition-all duration-500",style:{left:`${y}%`,width:`${u}%`},title:`${a.blocked} pausadas/bloqueadas`}),a.removed>0&&e.jsx("div",{className:"bg-gray-600 h-full absolute top-0 transition-all duration-500",style:{left:`${C}%`,width:`${g}%`,borderRadius:p>=99.9?"0 9999px 9999px 0":"0"},title:`${a.removed} removidas`})]})})()}),e.jsxs("div",{className:"text-xs text-gray-600",children:[a.completed>0&&e.jsxs("span",{className:"text-green-600 font-medium",children:[a.completed," completadas"]}),a.inProgress>0&&e.jsxs("span",{children:[a.completed>0?", ":"",e.jsxs("span",{className:"text-blue-600 font-medium",children:[a.inProgress," en progreso"]})]}),a.ready>0&&e.jsxs("span",{children:[a.completed>0||a.inProgress>0?", ":"",e.jsxs("span",{className:"text-gray-600 font-medium",children:[a.ready," por iniciar"]})]}),a.blocked>0&&e.jsxs("span",{children:[a.completed>0||a.inProgress>0||a.ready>0?", ":"",e.jsxs("span",{className:"text-red-600 font-medium",children:[a.blocked," pausadas"]})]}),a.removed>0&&e.jsxs("span",{children:[a.completed>0||a.inProgress>0||a.ready>0||a.blocked>0?", ":"",e.jsxs("span",{className:"text-gray-600 font-medium",children:[a.removed," removidas"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"Progreso por categor√≠as"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-green-600 rounded-full"}),e.jsx("span",{children:"Completadas"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{children:"En progreso"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full"}),e.jsx("span",{children:"Por iniciar"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),e.jsx("span",{children:"Pausadas"})]})]})]})]},n)})})]})]})}function zr(){const[l,t]=x.useState(new Date),{reportData:s,loading:r,error:n,dateRange:a,period:i,updateDateRange:o,updatePeriod:c,exportToCSV:m}=$r(),{heatMapData:u,loading:g,loadHeatMapData:d}=Nt();return x.useEffect(()=>{const h={entities:[],companies:[],years:[2025],months:[],states:[],companyTypes:[]};d(l.getFullYear(),l.getMonth()+1,h)},[l,d]),r&&!s?e.jsx("div",{className:"min-h-screen bg-gray-50 p-4 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Generando reporte..."})]})}):n?e.jsx("div",{className:"min-h-screen bg-gray-50 p-4 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:[e.jsx("h3",{className:"font-bold",children:"Error al generar reporte"}),e.jsx("p",{children:n})]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Intentar nuevamente"})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-4",children:e.jsxs(de,{to:"/",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 transition-colors",children:[e.jsx(je,{className:"w-4 h-4"}),"Volver al Dashboard"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Reportes de Solicitudes"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"An√°lisis y estad√≠sticas de las solicitudes de facturaci√≥n"})]})]})]}),e.jsx(Fr,{dateRange:a,onDateRangeChange:o,period:i,onPeriodChange:c,onExport:m,loading:r}),s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsx(Vr,{totalRequests:s.totalRequests,stateStatistics:s.stateStatistics,entityStatisticsWithProgress:s.entityStatisticsWithProgress,averageResolutionTime:s.averageResolutionTime})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6 mb-6",children:[e.jsx("div",{className:"xl:col-span-1",children:e.jsx(ns,{heatMapData:u,selectedDate:l,onDateChange:t,loading:g})}),e.jsx("div",{className:"xl:col-span-2",children:e.jsx(ls,{title:"Solicitudes por Mes - 2025",filters:{entities:[],companies:[],years:[2025],months:[],states:[],companyTypes:[]},compact:!1,showTrends:!0})})]}),s.requestSummaries.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Detalle de Solicitudes (",s.requestSummaries.length,")"]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Empresa"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Mes"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"A√±o"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Entidad"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Estado"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Fecha Recibido"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Fecha Cerrado"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"D√≠as Proc."})]})}),e.jsx("tbody",{children:s.requestSummaries.sort((h,y)=>!h.receivedDate&&!y.receivedDate?0:h.receivedDate?y.receivedDate?y.receivedDate.localeCompare(h.receivedDate):-1:1).slice(0,100).map((h,y)=>e.jsxs("tr",{className:y%2===0?"bg-gray-50":"bg-white",children:[e.jsx("td",{className:"py-3 px-4 text-gray-900 font-medium",children:h.company}),e.jsx("td",{className:"py-3 px-4 text-gray-700",children:h.month}),e.jsx("td",{className:"py-3 px-4 text-gray-700",children:h.year}),e.jsx("td",{className:"py-3 px-4 text-gray-700",children:h.entity}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("span",{className:`px-2 py-1 text-xs rounded-full max-w-32 truncate inline-flex items-center gap-1 ${ye(h.state).bg} ${ye(h.state).text}`,title:h.state,children:[e.jsx("span",{className:"text-xs",children:Te(h.state)}),e.jsx("span",{className:"truncate",children:h.state})]})}),e.jsx("td",{className:"py-3 px-4 text-gray-700",children:h.receivedDate?new Date(h.receivedDate).toLocaleDateString("es-ES"):"-"}),e.jsx("td",{className:"py-3 px-4 text-gray-700",children:h.closedDate?new Date(h.closedDate).toLocaleDateString("es-ES"):"-"}),e.jsx("td",{className:"py-3 px-4 text-gray-700",children:h.processingDays!==null?`${h.processingDays} d√≠as`:"-"})]},`${h.company}-${h.month}-${h.year}-${h.entity}-${h.workItemId||y}`))})]}),s.requestSummaries.length>100&&e.jsxs("div",{className:"mt-4 text-center text-gray-500 text-sm",children:["Mostrando las primeras 100 solicitudes de ",s.requestSummaries.length," total. Exporta el CSV para ver todos los datos."]})]})]}),s.totalRequests===0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-12 text-center",children:[e.jsx(he,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay solicitudes en el per√≠odo seleccionado"}),e.jsx("p",{className:"text-gray-500",children:"Intenta ajustar el rango de fechas para ver m√°s datos."})]})]}):null,r&&s&&e.jsxs("div",{className:"fixed bottom-4 right-4 bg-white rounded-lg shadow-lg border p-4 flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Actualizando reporte..."})]})]})})}const Br=Ps([{path:"/",element:e.jsx(pe,{children:e.jsx(Et,{})})},{path:"/pendientes",element:e.jsx(pe,{children:e.jsx(At,{})})},{path:"/resumen",element:e.jsx(pe,{children:e.jsx(At,{})})},{path:"/reportes",element:e.jsx(pe,{children:e.jsx(zr,{})})},{path:"/reportes/vencimientos",element:e.jsx(pe,{children:e.jsx(Or,{})})},{path:"/empresas",element:e.jsx(pe,{children:e.jsx(_r,{})})},{path:"/empresa/:companyName",element:e.jsx(pe,{children:e.jsx(vr,{})})},{path:"/analisis-demanda",element:e.jsx(pe,{children:e.jsx(Ir,{})})},{path:"/entidad/:entitySlug/historico",element:e.jsx(pe,{children:e.jsx(Dr,{})})},{path:"/:year/:entity",element:e.jsx(pe,{children:e.jsx(Et,{})})}]);As.createRoot(document.getElementById("root")).render(e.jsxs(Rs.StrictMode,{children:[e.jsx(ga,{}),e.jsx(Ls,{router:Br})]}));
