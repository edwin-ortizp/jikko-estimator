<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Facturación - Jikkosoft</title>
  <script>
    /**
     * GitHub Pages SPA Redirect Fix
     *
     * Cuando GitHub Pages recibe una petición a una ruta que no existe como archivo físico
     * (ej: /jikko-estimator/facturacion/2025/Alcaldía%20de%20Palmira),
     * retorna este archivo 404.html.
     *
     * Este script captura la URL solicitada y la guarda en sessionStorage,
     * luego redirige al index.html que manejará la ruta con React Router.
     */
    (function() {
      var l = window.location;

      // Basename de la aplicación: /jikko-estimator/facturacion/
      // Esto equivale a 3 segmentos: ['', 'jikko-estimator', 'facturacion']
      var pathSegmentsToKeep = 2; // Mantener jikko-estimator y facturacion

      // Construir el path base: /jikko-estimator/facturacion/
      var segments = l.pathname.split('/').filter(function(s) { return s; }); // Eliminar strings vacíos
      var basePath = '/' + segments.slice(0, pathSegmentsToKeep).join('/') + '/';

      // Extraer la ruta después del basename
      // Ejemplo: /jikko-estimator/facturacion/2025/Alcaldía de Palmira
      // basePath = /jikko-estimator/facturacion/
      // redirect = /2025/Alcaldía de Palmira
      var redirect = l.pathname.substring(basePath.length - 1); // -1 para incluir el / inicial

      // Si no hay redirect (estamos en el root), usar /
      if (!redirect || redirect === '/') {
        redirect = '/';
      }

      // Agregar search y hash
      var fullRedirect = redirect + l.search + l.hash;

      // Debug info (comentar en producción)
      console.log('404 Debug:', {
        pathname: l.pathname,
        basePath: basePath,
        redirect: redirect,
        fullRedirect: fullRedirect
      });

      // Guardar en sessionStorage para que index.html lo recupere
      sessionStorage.setItem('redirect', fullRedirect);

      // Redirigir al index.html del basename
      l.replace(
        l.protocol + '//' + l.hostname + (l.port ? ':' + l.port : '') +
        basePath +
        '?p=' + encodeURIComponent(fullRedirect)
      );
    })();
  </script>
</head>
<body>
  <!-- Pantalla de carga mientras redirige -->
  <div style="
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
    font-family: system-ui, -apple-system, sans-serif;
    background-color: #f9fafb;
  ">
    <div style="text-align: center;">
      <div style="
        width: 48px;
        height: 48px;
        border: 4px solid #e5e7eb;
        border-top-color: #2563eb;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 16px;
      "></div>
      <p style="color: #6b7280; margin: 0;">Cargando...</p>
    </div>
  </div>
  <style>
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</body>
</html>
